<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è…¾è®¯äº‘è¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .loading { background: #fff3cd; color: #856404; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª è…¾è®¯äº‘è¿æ¥æµ‹è¯•</h1>
    
    <div class="test-box">
        <h3>ğŸ“¡ è¿æ¥çŠ¶æ€</h3>
        <div id="connection-status" class="status loading">æ­£åœ¨æ£€æŸ¥è¿æ¥...</div>
        <button onclick="testConnection()">ğŸ”„ é‡æ–°æµ‹è¯•</button>
    </div>

    <div class="test-box">
        <h3>ğŸ”§ æ‰‹åŠ¨æµ‹è¯•</h3>
        <button onclick="testLocalSDK()">ğŸ“¦ æµ‹è¯•æœ¬åœ°SDK</button>
        <button onclick="testSDKLoad()">ğŸŒ æµ‹è¯•CDN SDK</button>
        <button onclick="testCloudbaseInit()">ğŸš€ æµ‹è¯•äº‘å¼€å‘åˆå§‹åŒ–</button>
        <button onclick="testDatabase()">ğŸ—„ï¸ æµ‹è¯•æ•°æ®åº“è¿æ¥</button>
        <button onclick="testNetwork()">ğŸŒ ç½‘ç»œè¯Šæ–­</button>
    </div>

    <div class="test-box">
        <h3>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h3>
        <div id="test-log" class="log">ç­‰å¾…æµ‹è¯•...</div>
        <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('test-log').textContent = '';
        }

        function updateStatus(message, type) {
            const statusDiv = document.getElementById('connection-status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // æµ‹è¯•æœ¬åœ°SDK
        async function testLocalSDK() {
            log('å¼€å§‹æµ‹è¯•æœ¬åœ°SDK...');
            
            try {
                if (typeof cloudbase !== 'undefined') {
                    log('âœ… æœ¬åœ°SDKå·²åŠ è½½');
                    return true;
                } else {
                    log('âŒ æœ¬åœ°SDKæœªåŠ è½½');
                    return false;
                }
            } catch (error) {
                log('âŒ æœ¬åœ°SDKæµ‹è¯•å¤±è´¥: ' + error.message);
                return false;
            }
        }

        // æµ‹è¯•CDN SDKåŠ è½½
        async function testSDKLoad() {
            log('å¼€å§‹æµ‹è¯•SDKåŠ è½½...');
            
            // å¤šä¸ªCDNæºä½œä¸ºå¤‡ç”¨
            const cdnSources = [
                'https://unpkg.com/@cloudbase/js-sdk@latest/dist/index.min.js',
                'https://cdn.jsdelivr.net/npm/@cloudbase/js-sdk@latest/dist/index.min.js',
                'https://cdnjs.cloudflare.com/ajax/libs/cloudbase-js-sdk/latest/index.min.js'
            ];
            
            for (let i = 0; i < cdnSources.length; i++) {
                const cdnUrl = cdnSources[i];
                log(`å°è¯•CDNæº ${i + 1}: ${cdnUrl}`);
                
                try {
                    const script = document.createElement('script');
                    script.src = cdnUrl;
                    
                    await new Promise((resolve, reject) => {
                        script.onload = () => {
                            log(`âœ… SDKåŠ è½½æˆåŠŸ (CDNæº ${i + 1})`);
                            resolve();
                        };
                        script.onerror = () => {
                            log(`âŒ CDNæº ${i + 1} åŠ è½½å¤±è´¥`);
                            reject(new Error(`CDNæº ${i + 1} åŠ è½½å¤±è´¥`));
                        };
                        document.head.appendChild(script);
                    });
                    
                    log('SDKå·²æ·»åŠ åˆ°é¡µé¢');
                    return true;
                    
                } catch (error) {
                    log(`CDNæº ${i + 1} å¤±è´¥: ${error.message}`);
                    if (i === cdnSources.length - 1) {
                        log('âŒ æ‰€æœ‰CDNæºéƒ½å¤±è´¥äº†');
                        return false;
                    }
                    // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªCDNæº
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            
            return false;
        }

        // æµ‹è¯•äº‘å¼€å‘åˆå§‹åŒ–
        async function testCloudbaseInit() {
            log('å¼€å§‹æµ‹è¯•äº‘å¼€å‘åˆå§‹åŒ–...');
            
            if (typeof cloudbase === 'undefined') {
                log('âŒ cloudbaseå¯¹è±¡æœªå®šä¹‰ï¼Œè¯·å…ˆåŠ è½½SDK');
                return false;
            }
            
            try {
                const app = cloudbase.init({
                    env: 'cloud1-9ghdf1i93f8fb2b9'
                });
                log('âœ… äº‘å¼€å‘åˆå§‹åŒ–æˆåŠŸ');
                log('åº”ç”¨å¯¹è±¡: ' + (app ? 'å·²åˆ›å»º' : 'åˆ›å»ºå¤±è´¥'));
                return true;
            } catch (error) {
                log('âŒ äº‘å¼€å‘åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                return false;
            }
        }

        // æµ‹è¯•æ•°æ®åº“è¿æ¥
        async function testDatabase() {
            log('å¼€å§‹æµ‹è¯•æ•°æ®åº“è¿æ¥...');
            
            if (typeof cloudbase === 'undefined') {
                log('âŒ cloudbaseå¯¹è±¡æœªå®šä¹‰');
                return false;
            }
            
            try {
                const app = cloudbase.init({
                    env: 'cloud1-9ghdf1i93f8fb2b9'
                });
                
                const db = app.database();
                log('âœ… æ•°æ®åº“å¯¹è±¡åˆ›å»ºæˆåŠŸ');
                
                // å°è¯•è·å–é›†åˆåˆ—è¡¨
                try {
                    const collections = await db.listCollections();
                    log('âœ… æ•°æ®åº“è¿æ¥æˆåŠŸï¼Œé›†åˆæ•°é‡: ' + collections.data.length);
                    return true;
                } catch (dbError) {
                    log('âš ï¸ æ•°æ®åº“è¿æ¥æˆåŠŸï¼Œä½†è·å–é›†åˆå¤±è´¥: ' + dbError.message);
                    return true; // è¿æ¥æˆåŠŸï¼Œåªæ˜¯æƒé™é—®é¢˜
                }
                
            } catch (error) {
                log('âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: ' + error.message);
                return false;
            }
        }

        // å®Œæ•´è¿æ¥æµ‹è¯•
        async function testConnection() {
            log('ğŸš€ å¼€å§‹å®Œæ•´è¿æ¥æµ‹è¯•...');
            updateStatus('æ­£åœ¨æµ‹è¯•è¿æ¥...', 'loading');
            
            try {
                // æ­¥éª¤1: æµ‹è¯•SDKåŠ è½½
                log('æ­¥éª¤1: æµ‹è¯•SDKåŠ è½½');
                const sdkLoaded = await testSDKLoad();
                if (!sdkLoaded) {
                    throw new Error('SDKåŠ è½½å¤±è´¥');
                }
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ­¥éª¤2: æµ‹è¯•äº‘å¼€å‘åˆå§‹åŒ–
                log('æ­¥éª¤2: æµ‹è¯•äº‘å¼€å‘åˆå§‹åŒ–');
                const initSuccess = await testCloudbaseInit();
                if (!initSuccess) {
                    throw new Error('äº‘å¼€å‘åˆå§‹åŒ–å¤±è´¥');
                }
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ­¥éª¤3: æµ‹è¯•æ•°æ®åº“è¿æ¥
                log('æ­¥éª¤3: æµ‹è¯•æ•°æ®åº“è¿æ¥');
                const dbSuccess = await testDatabase();
                if (!dbSuccess) {
                    throw new Error('æ•°æ®åº“è¿æ¥å¤±è´¥');
                }
                
                log('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼è…¾è®¯äº‘è¿æ¥æ­£å¸¸');
                updateStatus('âœ… è¿æ¥æˆåŠŸï¼è…¾è®¯äº‘æœåŠ¡æ­£å¸¸', 'success');
                
            } catch (error) {
                log('âŒ è¿æ¥æµ‹è¯•å¤±è´¥: ' + error.message);
                updateStatus('âŒ è¿æ¥å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ç½‘ç»œè¯Šæ–­
        async function testNetwork() {
            log('ğŸŒ å¼€å§‹ç½‘ç»œè¯Šæ–­...');
            
            // æµ‹è¯•åŸºæœ¬ç½‘ç»œè¿æ¥
            try {
                const response = await fetch('https://www.baidu.com/favicon.ico', { mode: 'no-cors' });
                log('âœ… åŸºæœ¬ç½‘ç»œè¿æ¥æ­£å¸¸');
            } catch (error) {
                log('âŒ åŸºæœ¬ç½‘ç»œè¿æ¥å¤±è´¥: ' + error.message);
            }
            
            // æµ‹è¯•CDNè¿æ¥
            const testUrls = [
                'https://unpkg.com',
                'https://cdn.jsdelivr.net',
                'https://cdnjs.cloudflare.com'
            ];
            
            for (const url of testUrls) {
                try {
                    const response = await fetch(url, { mode: 'no-cors' });
                    log(`âœ… ${url} å¯è®¿é—®`);
                } catch (error) {
                    log(`âŒ ${url} ä¸å¯è®¿é—®: ${error.message}`);
                }
            }
            
            // æµ‹è¯•è…¾è®¯äº‘è¿æ¥
            try {
                const response = await fetch('https://console.cloud.tencent.com', { mode: 'no-cors' });
                log('âœ… è…¾è®¯äº‘æ§åˆ¶å°å¯è®¿é—®');
            } catch (error) {
                log('âŒ è…¾è®¯äº‘æ§åˆ¶å°ä¸å¯è®¿é—®: ' + error.message);
            }
            
            log('ğŸŒ ç½‘ç»œè¯Šæ–­å®Œæˆ');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æµ‹è¯•
        window.addEventListener('load', function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
            setTimeout(testConnection, 1000);
        });
    </script>
    
    <!-- è…¾è®¯äº‘äº‘å¼€å‘ç›¸å…³è„šæœ¬ -->
    <script src="cloudbase-config.js"></script>
    <script src="cloudbase-sdk.js"></script>
    <script src="cloudbase-core.js"></script>
</body>
</html>
