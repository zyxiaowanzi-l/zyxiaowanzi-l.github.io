<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>我们的云端恋爱日记 |xxx &xxx</title>
    <style>
        :root {
            /* 主色调系统 */
            --primary: #ff6b9e;
            --primary-light: #ff8fab;
            --primary-dark: #e55a8a;
            --secondary: #6bd5ff;
            --secondary-light: #8de0ff;
            --secondary-dark: #4bc0e6;
            --accent: #ffd56b;
            --accent-light: #ffe085;
            --accent-dark: #f4c23d;
            
            /* 扩展色彩系统 */
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --purple: #9e6bff;
            --green: #baffc9;
            
            /* 文字色彩系统 */
            --text: #2c3e50;
            --text-secondary: #6c757d;
            --text-muted: #95a5a6;
            --text-light: #ecf0f1;
            --text-primary: var(--text);
            
            /* 背景色彩系统 */
            --bg: #fef6f9;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --bg-dark: #343a40;
            --card: white;
            
            /* 阴影系统 */
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 20px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.15);
            --shadow-xl: 0 20px 60px rgba(0,0,0,0.2);
            --shadow-primary: 0 4px 20px rgba(255, 107, 158, 0.2);
            --shadow-secondary: 0 4px 20px rgba(107, 213, 255, 0.2);
            
            /* 圆角系统 */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;
            
            /* 间距系统 */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* 字体系统 */
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            
            /* 动画系统 */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            --transition-bounce: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            
            /* 层级系统 */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-loading: 9999;
            --z-base: 1;
            
            /* 性能优化变量 */
            --will-change-transform: transform;
            --will-change-opacity: opacity;
            --backface-visibility: hidden;
            --transform-style: preserve-3d;
        }
        /* 隐私保护模糊遮罩层样式 */
        .privacy-mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 9998;
            display: none;
            opacity: 0;
            transition: all 0.5s ease;
            cursor: pointer;
        }
        
        .privacy-mask.show {
            opacity: 1;
        }
        
        .privacy-mask-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .privacy-mask-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }
        
        .privacy-mask-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .privacy-mask-hint {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* 隐私遮罩层移动端适配 */
        @media (max-width: 768px) {
            .privacy-mask-content {
                padding: 1.5rem;
                border-radius: 15px;
                margin: 20px;
                width: calc(100% - 40px);
                max-width: 300px;
            }
            
            .privacy-mask-icon {
                font-size: 2.5rem;
                margin-bottom: 0.8rem;
            }
            
            .privacy-mask-text {
                font-size: 1.1rem;
                margin-bottom: 0.4rem;
            }
            
            .privacy-mask-hint {
                font-size: 0.8rem;
            }
        }
        
        @media (max-width: 480px) {
            .privacy-mask-content {
                padding: 1rem;
                border-radius: 12px;
                margin: 15px;
                width: calc(100% - 30px);
                max-width: 250px;
            }
            
            .privacy-mask-icon {
                font-size: 2rem;
                margin-bottom: 0.6rem;
            }
            
            .privacy-mask-text {
                font-size: 1rem;
                margin-bottom: 0.3rem;
            }
            
            .privacy-mask-hint {
                font-size: 0.75rem;
            }
        }
        
        /* 隐私遮罩样式（已移除功能，仅保留样式以防后续需要） */
        .privacy-mask-old, .privacy-mask-old * {
            color: transparent !important;
            text-shadow: 0 0 8px #888, 0 0 12px #ccc;
            user-select: none !important;
            cursor: not-allowed !important;
        }
        .privacy-mask-old input, .privacy-mask-old textarea {
            background: #eee !important;
            color: transparent !important;
        }
        
        /* 基础动画系统 */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-30px,0); }
            70% { transform: translate3d(0,-15px,0); }
            90% { transform: translate3d(0,-4px,0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }
        
        /* 动画工具类 */
        .animate-fade-in { animation: fadeIn 0.6s ease-out; }
        .animate-fade-in-up { animation: fadeInUp 0.6s ease-out; }
        .animate-fade-in-down { animation: fadeInDown 0.6s ease-out; }
        .animate-slide-in-left { animation: slideInLeft 0.6s ease-out; }
        .animate-slide-in-right { animation: slideInRight 0.6s ease-out; }
        .animate-scale-in { animation: scaleIn 0.6s ease-out; }
        .animate-bounce { animation: bounce 1s ease-in-out; }
        .animate-pulse { animation: pulse 2s infinite; }
        .animate-shimmer { 
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            background-size: 200px 100%;
            animation: shimmer 1.5s infinite;
        }
        
        /* 图片模态框样式 - 升级版 */
        .image-modal {
            display: none;
            position: fixed;
            z-index: var(--z-modal);
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            opacity: 0;
            transition: all var(--transition-normal);
        }
        
        .image-modal.show {
            opacity: 1;
        }
        
        .image-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: auto;
            height: auto;
            max-width: 90%;
            max-height: 90%;
            transition: all var(--transition-bounce);
            border-radius: var(--radius-lg);
            overflow: visible;
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-modal.show .image-modal-content {
            transform: translate(-50%, -50%) scale(1);
        }
        
        .image-modal img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            border-radius: var(--radius-lg);
            display: block;
            transition: transform var(--transition-normal);
            object-fit: contain;
            object-position: center;
            min-width: auto;
            min-height: auto;
        }
        
        .image-modal img:hover {
            transform: scale(1.02);
        }
        
        .image-modal-close {
            position: absolute;
            top: var(--spacing-lg);
            right: var(--spacing-lg);
            color: white;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all var(--transition-normal);
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        
        .image-modal-close:hover {
            color: var(--primary);
            background: rgba(255, 255, 255, 0.9);
            transform: scale(1.1) rotate(90deg);
        }
        
        /* 图片导航控制 */
        .image-modal-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: var(--spacing-md);
            cursor: pointer;
            border-radius: var(--radius-full);
            backdrop-filter: blur(10px);
            transition: all var(--transition-normal);
            font-size: 1.5rem;
        }
        
        .image-modal-nav:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }
        
        .image-modal-nav.prev {
            left: var(--spacing-lg);
        }
        
        .image-modal-nav.next {
            right: var(--spacing-lg);
        }
        
        /* 响应式图片显示优化 */
        @media (max-width: 768px) {
            .image-modal-content {
                max-width: 98%;
                max-height: 98%;
                padding: 10px;
            }
            
            .image-modal img {
                max-width: 100%;
                max-height: 90vh;
                object-fit: contain;
            }
        }
        
        @media (max-width: 480px) {
            .image-modal-content {
                max-width: 100%;
                max-height: 100%;
                padding: 5px;
            }
            
            .image-modal img {
                max-width: 100%;
                max-height: 85vh;
                object-fit: contain;
            }
        }
        
        /* 手机端按钮优化 */
        @media (max-width: 768px) {
            #start-camera-btn,
            #capture-face-btn,
            #return-management-btn,
            #close-permission-btn {
                width: 100% !important;
                max-width: 100% !important;
                margin: 0.5rem 0;
                padding: 1rem 1rem;
                font-size: 1rem;
                border-radius: 10px;
            }
            
            /* 手机端按钮组布局 */
            .camera-button-group {
                flex-direction: column;
                gap: 0.8rem;
                margin-bottom: 1rem;
            }
            
            /* 手机端间距调整 */
            .mobile-spacing {
                margin-top: 1rem;
                margin-bottom: 1rem;
            }
        }
        
        /* 超小屏幕优化 */
        @media (max-width: 480px) {
            #start-camera-btn,
            #capture-face-btn,
            #return-management-btn,
            #close-permission-btn {
                padding: 0.8rem 0.8rem;
                font-size: 0.95rem;
                border-radius: 8px;
            }
            
            .camera-button-group {
                gap: 0.6rem;
            }
        }
        
        /* 确保图片完整显示 */
        .image-modal img {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        /* 现代化按钮样式系统 */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            border-radius: var(--radius-md);
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            user-select: none;
            white-space: nowrap;
        }
        
        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left var(--transition-slow);
        }
        
        .btn:hover:before {
            left: 100%;
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* 按钮尺寸变体 */
        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-md);
            font-size: var(--font-size-sm);
        }
        
        .btn-lg {
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-lg);
        }
        
        .btn-xl {
            padding: var(--spacing-lg) var(--spacing-2xl);
            font-size: var(--font-size-xl);
        }
        
        /* 按钮颜色变体 */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, var(--secondary-dark), var(--secondary));
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: var(--text-primary);
            box-shadow: var(--shadow-md);
        }
        
        .btn-accent:hover {
            background: linear-gradient(135deg, var(--accent-dark), var(--accent));
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }
        
        .btn-ghost:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        
        /* 按钮组 */
        .btn-group {
            display: inline-flex;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        
        .btn-group .btn {
            border-radius: 0;
            border-right: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn-group .btn:first-child {
            border-top-left-radius: var(--radius-md);
            border-bottom-left-radius: var(--radius-md);
        }
        
        .btn-group .btn:last-child {
            border-top-right-radius: var(--radius-md);
            border-bottom-right-radius: var(--radius-md);
            border-right: none;
        }
        
        /* 浮动操作按钮 */
        .fab {
            position: fixed;
            bottom: var(--spacing-xl);
            right: var(--spacing-xl);
            width: 56px;
            height: 56px;
            border-radius: var(--radius-full);
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-normal);
            z-index: var(--z-fixed);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .fab:hover {
            transform: scale(1.1) rotate(180deg);
            box-shadow: var(--shadow-xl);
        }
        
        /* 人脸识别模态框样式 - 升级版 */
        .face-recognition-modal {
            display: none;
            position: fixed;
            z-index: var(--z-modal);
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0.85));
            backdrop-filter: blur(15px);
            opacity: 0;
            transition: all var(--transition-normal);
        }
        
        .face-recognition-modal.show {
            opacity: 1;
        }
        
        .face-recognition-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 90%;
            max-width: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .face-recognition-modal.show .face-recognition-content {
            transform: translate(-50%, -50%) scale(1);
        }
        
        /* 人脸识别模态框移动端适配 */
        @media (max-width: 768px) {
            .face-recognition-content {
                width: 95%;
                max-width: none;
                margin: 20px;
                border-radius: 15px;
            }
            
            .face-recognition-header {
                padding: 1rem;
            }
            
            .face-recognition-header h3 {
                font-size: 1.1rem;
            }
            
            .face-recognition-body {
                padding: 1.5rem;
            }
            
            .camera-container {
                height: 250px;
                margin-bottom: 1rem;
            }
            
            .recognition-controls {
                flex-direction: column;
                gap: 0.8rem;
            }
            
            .capture-btn,
            .retry-btn {
                width: 100%;
                padding: 1rem;
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .face-recognition-content {
                width: 98%;
                margin: 10px;
                border-radius: 12px;
            }
            
            .face-recognition-header {
                padding: 0.8rem;
            }
            
            .face-recognition-header h3 {
                font-size: 1rem;
            }
            
            .face-recognition-body {
                padding: 1rem;
            }
            
            .camera-container {
                height: 200px;
            }
            
            .recognition-status {
                margin-bottom: 1rem;
            }
            
            #status-text {
                font-size: 0.9rem;
            }
            
            .confidence-bar {
                height: 8px;
            }
            
            #confidence-text {
                font-size: 0.8rem;
            }
        }
        
        .face-recognition-header {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .face-recognition-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }
        
        .face-modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .face-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .face-recognition-body {
            padding: 2rem;
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            height: 300px;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        
        #camera-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .face-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 3px solid #6c5ce7;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(108, 92, 231, 0.5);
        }
        
        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #6c5ce7, transparent);
            animation: scan 2s linear infinite;
        }
        
        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }
        
        .recognition-status {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        #status-text {
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 1rem;
        }
        
        .confidence-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #6c5ce7);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        #confidence-text {
            font-size: 0.9rem;
            color: #666;
        }
        
        .recognition-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        .capture-btn, .retry-btn {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .capture-btn:hover, .retry-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
        }
        
        .retry-btn {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        }
        
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: var(--text);
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            background-image: radial-gradient(circle at 10% 20%, rgba(255, 200, 239, 0.2) 0%, rgba(255, 255, 255, 0) 50%);
        }
        
        /* 全局平滑过渡效果 */
        .memory-counter, .media-grid, .media-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* 防止页面闪动的缓冲样式 */
        .page-buffer {
            min-height: 100px;
            background: linear-gradient(135deg, rgba(255, 107, 158, 0.02), rgba(255, 142, 171, 0.02));
            border-radius: 8px;
            margin: 0.5rem 0;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        
        .page-buffer.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* 现代化头部样式系统 */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            background-size: 300% 300%;
            color: white;
            text-align: center;
            padding: var(--spacing-2xl) var(--spacing-lg);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            animation: gradientShift 8s ease-in-out infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* 头部装饰元素 */
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="g" cx="50%" cy="50%"><stop offset="0%" stop-color="rgba(255,255,255,0.1)"/><stop offset="100%" stop-color="transparent"/></radialGradient></defs><circle cx="50" cy="50" r="2" fill="url(%23g)"/></svg>') repeat;
            background-size: 50px 50px;
            opacity: 0.3;
            animation: float 20s linear infinite;
        }
        
        header::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }
        
        /* 现代化爱心动画系统 */
        .hearts {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            overflow: hidden;
        }
        
        .heart {
            position: absolute;
            opacity: 0;
            font-size: clamp(1rem, 3vw, 2rem);
            animation: heartFloat 8s ease-in infinite;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));
            transition: all var(--transition-normal);
        }
        
        .heart:nth-child(odd) {
            animation-delay: 0s;
            animation-duration: 6s;
        }
        
        .heart:nth-child(even) {
            animation-delay: 2s;
            animation-duration: 8s;
        }
        
        .heart:nth-child(3n) {
            animation-delay: 4s;
            animation-duration: 10s;
        }
        
        @keyframes heartFloat {
            0% {
                transform: translateY(100vh) rotate(0deg) scale(0.5);
                opacity: 0;
            }
            10% {
                opacity: 1;
                transform: translateY(90vh) rotate(36deg) scale(0.8);
            }
            50% {
                opacity: 0.8;
                transform: translateY(50vh) rotate(180deg) scale(1.2);
            }
            90% {
                opacity: 0.6;
                transform: translateY(10vh) rotate(324deg) scale(0.9);
            }
            100% {
                transform: translateY(-10vh) rotate(360deg) scale(0.5);
                opacity: 0;
            }
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* 现代化标题系统 */
        h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            margin: 0;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 0.05em;
            background: linear-gradient(45deg, #fff, #f0f8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes titleGlow {
            from { filter: drop-shadow(0 0 10px rgba(255,255,255,0.5)); }
            to { filter: drop-shadow(0 0 20px rgba(255,255,255,0.8)); }
        }
        
        @keyframes fadeOut {
            from { 
                opacity: 1; 
                transform: translateY(0); 
            }
            to { 
                opacity: 0; 
                transform: translateY(-20px); 
            }
        }
        
        .subtitle {
            font-size: clamp(1rem, 2.5vw, 1.4rem);
            opacity: 0.95;
            margin-top: var(--spacing-md);
            position: relative;
            z-index: 1;
            font-weight: 400;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            background: linear-gradient(45deg, #f0f8ff, #e6f3ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* 实时时钟样式 */
        .real-time-clock {
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            margin-top: var(--spacing-md);
            position: relative;
            z-index: 1;
            opacity: 0.9;
            font-family: 'Courier New', monospace;
            background: rgba(255,255,255,0.1);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            display: inline-block;
            transition: all var(--transition-normal);
        }
        
        .real-time-clock:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }
        
        /* 现代化容器和布局系统 */
        .container {
            max-width: min(1200px, 95vw);
            margin: 0 auto;
            padding: var(--spacing-xl);
            box-sizing: border-box;
            position: relative;
        }
        
        /* 响应式网格系统 */
        .grid {
            display: grid;
            gap: var(--spacing-lg);
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
        
        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        
        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        
        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
        
        /* 弹性布局系统 */
        .flex {
            display: flex;
        }
        
        .flex-col {
            flex-direction: column;
        }
        
        .flex-wrap {
            flex-wrap: wrap;
        }
        
        .items-center {
            align-items: center;
        }
        
        .justify-center {
            justify-content: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .gap-sm { gap: var(--spacing-sm); }
        .gap-md { gap: var(--spacing-md); }
        .gap-lg { gap: var(--spacing-lg); }
        .gap-xl { gap: var(--spacing-xl); }
        
        /* 现代化记忆计数器样式 */
        .memory-counter {
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            background-size: 200% 200%;
            color: white;
            padding: var(--spacing-xl);
            border-radius: var(--radius-lg);
            text-align: center;
            margin: var(--spacing-xl) 0;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            box-shadow: var(--shadow-lg);
            animation: gradientShift 6s ease-in-out infinite;
            backdrop-filter: blur(10px);
        }
        
        .memory-counter::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            pointer-events: none;
        }
        
        .memory-counter h2 {
            position: relative;
            z-index: 1;
            font-size: clamp(1.5rem, 3vw, 2rem);
            font-weight: 600;
            margin-bottom: var(--spacing-lg);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        /* 现代化卡片样式系统 */
        .card {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: var(--spacing-lg);
            margin: var(--spacing-md) 0;
            transition: all var(--transition-normal);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--bg-tertiary);
        }
        
        .card-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        
        .card-subtitle {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin: 0;
        }
        
        .card-content {
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .card-footer {
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-sm);
            border-top: 1px solid var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        /* 卡片变体 */
        .card-primary {
            border-left: 4px solid var(--primary);
        }
        
        .card-secondary {
            border-left: 4px solid var(--secondary);
        }
        
        .card-accent {
            border-left: 4px solid var(--accent);
        }
        
        .card-success {
            border-left: 4px solid var(--success);
        }
        
        .card-warning {
            border-left: 4px solid var(--warning);
        }
        
        .card-danger {
            border-left: 4px solid var(--danger);
        }
        
        /* 现代化恋爱动态区域样式 */
        .love-feed-section {
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin: var(--spacing-xl) 0;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 107, 158, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .love-feed-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 107, 158, 0.02), transparent);
            pointer-events: none;
        }
        
        .love-feed-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            position: relative;
            z-index: 1;
        }
        
        .love-feed-header h2 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--spacing-sm);
        }
        
        .love-feed-header .subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
            opacity: 0.8;
        }
        
        /* 现代化添加按钮 */
        .add-love-feed-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            margin: var(--spacing-lg) auto;
            display: block;
        }
        
        .add-love-feed-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-xl);
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }
        
        .add-love-feed-btn:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        .add-love-feed-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .add-love-feed-btn:hover::before {
            left: 100%;
        }
        
        /* 现代化表单样式 */
        .love-feed-form {
            background: linear-gradient(135deg, rgba(255, 246, 250, 0.95), rgba(255, 238, 248, 0.95));
            border: 2px solid var(--primary);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            box-shadow: var(--shadow-lg);
            position: relative;
            opacity: 0;
            transform: translateY(-20px);
            transition: all var(--transition-bounce);
            max-height: 0;
            overflow: hidden;
            pointer-events: none;
            backdrop-filter: blur(10px);
        }
        
        .love-feed-form.show {
            opacity: 1;
            transform: translateY(0);
            max-height: 1000px;
            pointer-events: all;
        }
        
        .love-feed-form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid rgba(255, 107, 158, 0.2);
        }
        
        .love-feed-form-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .love-feed-form-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--primary);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
            position: relative;
        }
        
        .love-feed-form-close:hover {
            background: rgba(255, 107, 158, 0.1);
            color: var(--primary-dark);
            transform: rotate(90deg);
        }
        
        .love-feed-form-close::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--primary);
            border-radius: var(--radius-full);
            transition: all var(--transition-normal);
            transform: translate(-50%, -50%);
        }
        
        .love-feed-form-close:hover::before {
            width: 100%;
            height: 100%;
            opacity: 0.1;
        }
        
        /* 现代化表单输入字段样式 */
        .form-group {
            margin-bottom: var(--spacing-lg);
            position: relative;
        }
        
        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            color: var(--text-primary);
            font-weight: 600;
            font-size: var(--font-size-base);
            position: relative;
        }
        
        .form-label.required::after {
            content: ' *';
            color: var(--danger);
            font-weight: bold;
        }
        
        .form-input {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--bg-tertiary);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-family: var(--font-family);
            outline: none;
            transition: all var(--transition-normal);
            background: var(--bg-primary);
            color: var(--text-primary);
            box-sizing: border-box;
        }
        
        .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 158, 0.1);
            background: var(--bg-primary);
        }
        
        .form-input:focus + .form-focus-border {
            transform: scaleX(1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }
        
        .form-focus-border {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform var(--transition-normal);
            transform-origin: left;
        }
        
        /* 图片上传区域样式 */
        .image-upload-area {
            border: 2px dashed var(--primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            text-align: center;
            background: rgba(255, 107, 158, 0.05);
            margin-bottom: var(--spacing-md);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }
        
        .image-upload-area:hover {
            border-color: var(--primary-dark);
            background: rgba(255, 107, 158, 0.08);
            transform: translateY(-2px);
        }
        
        .image-upload-area.dragover {
            border-color: var(--secondary);
            background: rgba(107, 213, 255, 0.1);
            transform: scale(1.02);
        }
        
        .image-upload-text {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .image-upload-hint {
            color: var(--text-muted);
            font-size: var(--font-size-sm);
            opacity: 0.8;
        }
        
        /* 图片预览网格 */
        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }
        
        .image-preview-item {
            position: relative;
            border-radius: var(--radius-md);
            overflow: hidden;
            aspect-ratio: 1;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            transition: all var(--transition-normal);
        }
        
        .image-preview-item:hover {
            transform: scale(1.05);
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all var(--transition-normal);
        }
        
        .image-preview-item:hover img {
            transform: scale(1.1);
        }
        
        .image-preview-remove {
            position: absolute;
            top: var(--spacing-xs);
            right: var(--spacing-xs);
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: var(--radius-full);
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
            backdrop-filter: blur(10px);
        }
        
        .image-preview-remove:hover {
            background: var(--danger);
            transform: scale(1.2);
        }
        
        /* 表单提交按钮 */
        .form-submit-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-md) var(--spacing-2xl);
            font-size: var(--font-size-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            width: 100%;
            margin-top: var(--spacing-lg);
        }
        
        .form-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }
        
        .form-submit-btn:active {
            transform: translateY(0);
        }
        
        .form-submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .form-submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .form-submit-btn:hover::before {
            left: 100%;
        }
        
        /* 现代化恋爱动态展示样式 */
        .love-feed-list {
            margin-top: var(--spacing-xl);
        }
        
        .love-feed-item {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }
        
        .love-feed-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(255, 107, 158, 0.2);
        }
        
        .love-feed-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            transition: all var(--transition-normal);
        }
        
        .love-feed-item:hover::before {
            width: 8px;
            box-shadow: 0 0 20px rgba(255, 107, 158, 0.5);
        }
        
        .love-feed-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--bg-tertiary);
        }
        
        .love-feed-date {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }
        
        .love-feed-actions {
            display: flex;
            gap: var(--spacing-sm);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }
        
        .love-feed-item:hover .love-feed-actions {
            opacity: 1;
        }
        
        .love-feed-action-btn {
            background: none;
            border: none;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-normal);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }
        
        .love-feed-action-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            transform: scale(1.1);
        }
        
        .love-feed-action-btn.delete {
            color: var(--danger);
        }
        
        .love-feed-action-btn.delete:hover {
            background: rgba(220, 53, 69, 0.1);
        }
        
        .love-feed-content {
            color: var(--text-primary);
            line-height: 1.7;
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-base);
        }
        
        .love-feed-media {
            margin-top: var(--spacing-md);
        }
        
        .love-feed-media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-sm);
        }
        
        .love-feed-media-item {
            position: relative;
            border-radius: var(--radius-md);
            overflow: hidden;
            aspect-ratio: 1;
            background: var(--bg-tertiary);
            cursor: pointer;
            transition: all var(--transition-normal);
            border: 2px solid transparent;
        }
        
        .love-feed-media-item:hover {
            transform: scale(1.05);
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }
        
        .love-feed-media-item img,
        .love-feed-media-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all var(--transition-normal);
        }
        
        .love-feed-media-item:hover img,
        .love-feed-media-item:hover video {
            transform: scale(1.1);
        }
        
        .love-feed-media-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity var(--transition-normal);
            color: white;
            font-size: 2rem;
        }
        
        .love-feed-media-item:hover .love-feed-media-overlay {
            opacity: 1;
        }
        
        /* 空状态样式 */
        .love-feed-empty {
            text-align: center;
            padding: var(--spacing-2xl);
            color: var(--text-muted);
        }
        
        .love-feed-empty-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
            opacity: 0.5;
        }
        
        .love-feed-empty-text {
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-md);
            color: var(--text-secondary);
        }
        
        .love-feed-empty-hint {
            font-size: var(--font-size-base);
            opacity: 0.8;
        }
        
        /* 现代化时间轴样式 */
        .timeline {
            position: relative;
            padding: var(--spacing-xl) 0;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, var(--primary), var(--secondary), var(--accent));
            transform: translateX(-50%);
            border-radius: var(--radius-full);
            box-shadow: 0 0 20px rgba(255, 107, 158, 0.3);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: var(--spacing-xl);
            width: 100%;
        }
        
        .timeline-item:nth-child(odd) .timeline-content {
            margin-left: 0;
            margin-right: calc(50% + var(--spacing-lg));
            text-align: right;
        }
        
        .timeline-item:nth-child(even) .timeline-content {
            margin-left: calc(50% + var(--spacing-lg));
            margin-right: 0;
            text-align: left;
        }
        
        .timeline-item:nth-child(odd) .timeline-content::before {
            left: 100%;
            border-left-color: var(--primary);
        }
        
        .timeline-item:nth-child(even) .timeline-content::before {
            right: 100%;
            border-right-color: var(--secondary);
        }
        
        .timeline-content {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            transition: all var(--transition-normal);
            max-width: 400px;
        }
        
        .timeline-content:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(255, 107, 158, 0.2);
        }
        
        .timeline-content::before {
            content: '';
            position: absolute;
            top: 20px;
            width: 0;
            height: 0;
            border: 10px solid transparent;
        }
        
        .timeline-date {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: 600;
            display: inline-block;
            margin-bottom: var(--spacing-sm);
            box-shadow: var(--shadow-sm);
            position: absolute;
            top: 0;
            z-index: 3;
            white-space: nowrap;
        }
        
        .timeline-item:nth-child(odd) .timeline-date {
            right: calc(100% + var(--spacing-lg));
            transform: translateX(50%);
        }
        
        .timeline-item:nth-child(even) .timeline-date {
            left: calc(100% + var(--spacing-lg));
            transform: translateX(-50%);
        }
        
        .timeline-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }
        
        .timeline-description {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: var(--spacing-sm);
        }
        
        .timeline-marker {
            position: absolute;
            left: 50%;
            top: 20px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius-full);
            transform: translateX(-50%);
            box-shadow: 0 0 20px rgba(255, 107, 158, 0.5);
            border: 3px solid white;
            z-index: 2;
        }
        
        .timeline-marker::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 8px;
            background: white;
            border-radius: var(--radius-full);
            transform: translate(-50%, -50%);
        }
        
        /* 响应式时间轴 */
        @media (max-width: 768px) {
            .timeline::before {
                left: var(--spacing-lg);
            }
            
            .timeline-item:nth-child(odd) .timeline-content,
            .timeline-item:nth-child(even) .timeline-content {
                margin-left: calc(var(--spacing-lg) * 2 + 20px);
                margin-right: 0;
                text-align: left;
            }
            
            .timeline-item:nth-child(odd) .timeline-content::before,
            .timeline-item:nth-child(even) .timeline-content::before {
                left: -20px;
                border-left-color: var(--primary);
                border-right-color: transparent;
            }
            
            .timeline-marker {
                left: var(--spacing-lg);
            }
            
            .timeline-date {
                position: absolute;
                left: 0;
                top: 0;
                transform: translateX(-100%);
                margin-right: var(--spacing-sm);
                white-space: nowrap;
                z-index: 3;
            }
        }
        
        /* 现代化互动功能区域样式 */
        .interactive-section {
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin: var(--spacing-xl) 0;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(107, 213, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .interactive-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(107, 213, 255, 0.02), transparent);
            pointer-events: none;
        }
        
        .interactive-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            position: relative;
            z-index: 1;
        }
        
        .interactive-header h2 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--spacing-sm);
        }
        
        .interactive-header .subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
            opacity: 0.8;
        }
        
        /* 表白墙样式 */
        .confession-wall {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .confession-wall::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--accent), var(--primary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .confession-input {
            width: 100%;
            min-height: 120px;
            padding: var(--spacing-md);
            border: 2px solid var(--bg-tertiary);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-family: var(--font-family);
            outline: none;
            transition: all var(--transition-normal);
            background: var(--bg-primary);
            color: var(--text-primary);
            resize: vertical;
            margin-bottom: var(--spacing-md);
        }
        
        .confession-input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(107, 213, 255, 0.1);
        }
        
        .confession-submit {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }
        
        .confession-submit:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--secondary-dark), var(--secondary));
        }
        
        .confession-submit::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .confession-submit:hover::before {
            left: 100%;
        }
        
        .confession-list {
            margin-top: var(--spacing-lg);
        }
        
        .confession-item {
            background: linear-gradient(135deg, rgba(107, 213, 255, 0.05), rgba(255, 214, 107, 0.05));
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-left: 4px solid var(--secondary);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }
        
        .confession-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-md);
            background: linear-gradient(135deg, rgba(107, 213, 255, 0.1), rgba(255, 214, 107, 0.1));
        }
        
        .confession-text {
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: var(--spacing-sm);
            font-style: italic;
        }
        
        .confession-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: var(--font-size-sm);
            color: var(--text-muted);
        }
        
        .confession-time {
            background: rgba(107, 213, 255, 0.1);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            color: var(--secondary);
        }
        
        /* 爱情问答系统样式 */
        .love-quiz-section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .love-quiz-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--primary), var(--secondary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .quiz-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--bg-tertiary);
        }
        
        .quiz-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--accent);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .quiz-progress {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-sm);
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }
        
        .quiz-progress-bar {
            width: 200px;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
        }
        
        .quiz-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            border-radius: var(--radius-full);
            transition: width var(--transition-normal);
            position: relative;
        }
        
        .quiz-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        .quiz-question {
            background: linear-gradient(135deg, rgba(255, 214, 107, 0.05), rgba(255, 107, 158, 0.05));
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            border: 2px solid rgba(255, 214, 107, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .quiz-question::before {
            content: '💭';
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            font-size: 2rem;
            opacity: 0.3;
        }
        
        .quiz-question-text {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-lg);
            line-height: 1.6;
            text-align: center;
        }
        
        .quiz-options {
            display: grid;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }
        
        .quiz-option {
            background: var(--bg-primary);
            border: 2px solid var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            text-align: left;
        }
        
        .quiz-option:hover {
            border-color: var(--accent);
            background: rgba(255, 214, 107, 0.05);
            transform: translateX(5px);
        }
        
        .quiz-option.selected {
            border-color: var(--primary);
            background: rgba(255, 107, 158, 0.1);
            transform: translateX(10px);
        }
        
        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(40, 167, 69, 0.1);
            animation: pulse 0.6s ease-in-out;
        }
        
        .quiz-option.incorrect {
            border-color: var(--danger);
            background: rgba(220, 53, 69, 0.1);
            animation: shake 0.6s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .quiz-option-text {
            font-size: var(--font-size-base);
            color: var(--text-primary);
            font-weight: 500;
            margin: 0;
        }
        
        .quiz-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .quiz-action-btn {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: var(--text-primary);
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }
        
        .quiz-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--accent-dark), var(--accent));
        }
        
        .quiz-action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .quiz-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .quiz-action-btn:hover::before {
            left: 100%;
        }
        
        /* 幸运抽签系统样式 */
        .lucky-draw-section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .lucky-draw-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--purple), var(--accent), var(--primary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .lucky-draw-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--bg-tertiary);
        }
        
        .lucky-draw-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--purple);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .lucky-draw-description {
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            line-height: 1.6;
            margin-bottom: var(--spacing-md);
        }
        
        .lucky-draw-area {
            background: linear-gradient(135deg, rgba(158, 107, 255, 0.05), rgba(255, 214, 107, 0.05));
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            border: 2px dashed rgba(158, 107, 255, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all var(--transition-normal);
        }
        
        .lucky-draw-area:hover {
            border-color: var(--purple);
            background: linear-gradient(135deg, rgba(158, 107, 255, 0.1), rgba(255, 214, 107, 0.1));
            transform: translateY(-2px);
        }
        
        .lucky-draw-area::before {
            content: '🎯';
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            font-size: 2rem;
            opacity: 0.3;
        }
        
        .lucky-draw-btn {
            background: linear-gradient(135deg, var(--purple), var(--purple-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-lg) var(--spacing-2xl);
            font-size: var(--font-size-xl);
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
            margin: var(--spacing-lg) auto;
            display: block;
            min-width: 200px;
        }
        
        .lucky-draw-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-xl);
            background: linear-gradient(135deg, var(--purple-dark), var(--purple));
        }
        
        .lucky-draw-btn:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        .lucky-draw-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .lucky-draw-btn:hover::before {
            left: 100%;
        }
        
        .lucky-draw-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .lucky-draw-result {
            background: linear-gradient(135deg, rgba(255, 214, 107, 0.1), rgba(158, 107, 255, 0.1));
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            border: 2px solid var(--accent);
            text-align: center;
            opacity: 0;
            transform: scale(0.8);
            transition: all var(--transition-bounce);
        }
        
        .lucky-draw-result.show {
            opacity: 1;
            transform: scale(1);
        }
        
        .lucky-draw-result-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            animation: bounce 1s ease-in-out;
        }
        
        .lucky-draw-result-text {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
            line-height: 1.6;
        }
        
        .lucky-draw-result-description {
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            line-height: 1.6;
        }
        
        /* 每日一句样式 */
        .daily-quote-section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .daily-quote-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--green), var(--accent), var(--primary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .daily-quote-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--bg-tertiary);
        }
        
        .daily-quote-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--green);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .daily-quote-content {
            background: linear-gradient(135deg, rgba(186, 255, 201, 0.05), rgba(255, 214, 107, 0.05));
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            border: 2px solid rgba(186, 255, 201, 0.2);
            position: relative;
            overflow: hidden;
            text-align: center;
        }
        
        .daily-quote-content::before {
            content: '💬';
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            font-size: 2rem;
            opacity: 0.3;
        }
        
        .daily-quote-text {
            font-size: var(--font-size-lg);
            font-style: italic;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            line-height: 1.8;
            font-weight: 500;
        }
        
        .daily-quote-author {
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            font-weight: 600;
        }
        
        .daily-quote-actions {
            text-align: center;
            margin-top: var(--spacing-lg);
        }
        
        .daily-quote-btn {
            background: linear-gradient(135deg, var(--green), var(--green-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            margin: 0 var(--spacing-sm);
        }
        
        .daily-quote-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--green-dark), var(--green));
        }
        
        .daily-quote-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .daily-quote-btn:hover::before {
            left: 100%;
        }
        

        
        /* 音乐播放系统样式 */
        .music-section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .music-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--info), var(--secondary), var(--accent));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .music-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--bg-tertiary);
        }
        
        .music-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--info);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .music-controls {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin: var(--spacing-lg) 0;
        }
        
        .music-control-btn {
            background: linear-gradient(135deg, var(--info), var(--info-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-md);
            font-size: var(--font-size-lg);
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .music-control-btn:hover {
            transform: translateY(-2px) scale(1.1);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--info-dark), var(--info));
        }
        
        .music-control-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .music-control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .music-control-btn:hover::before {
            left: 100%;
        }
        
        .music-info {
            text-align: center;
            margin-top: var(--spacing-lg);
            padding: var(--spacing-md);
            background: rgba(23, 162, 184, 0.05);
            border-radius: var(--radius-md);
            border: 1px solid rgba(23, 162, 184, 0.1);
        }
        
        .music-title-text {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }
        
        .music-artist {
            color: var(--text-secondary);
            font-size: var(--font-size-base);
        }
        
        /* 现代化开发者面板样式 */
        .developer-panel {
            background: linear-gradient(135deg, var(--bg-dark), var(--bg-primary));
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin: var(--spacing-xl) 0;
            box-shadow: var(--shadow-xl);
            border: 2px solid rgba(255, 107, 158, 0.2);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        
        .developer-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 107, 158, 0.05), transparent);
            pointer-events: none;
        }
        
        .developer-panel::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            background: radial-gradient(circle, rgba(255, 107, 158, 0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
            pointer-events: none;
        }
        
        .developer-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            position: relative;
            z-index: 1;
        }
        
        .developer-header h2 {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, #ff6b9e, #9e6bff, #6bd5ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--spacing-sm);
            text-shadow: 0 0 30px rgba(255, 107, 158, 0.5);
        }
        
        .developer-header .subtitle {
            color: var(--text-light);
            font-size: var(--font-size-lg);
            opacity: 0.9;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        
        .developer-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-xl) 0;
            position: relative;
            z-index: 1;
        }
        
        .developer-control-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .developer-control-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 107, 158, 0.5);
            box-shadow: 0 10px 30px rgba(255, 107, 158, 0.3);
        }
        
        .developer-control-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .developer-control-icon {
            font-size: 2.5rem;
            margin-bottom: var(--spacing-md);
            display: block;
            text-align: center;
        }
        
        .developer-control-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: var(--spacing-sm);
            text-align: center;
        }
        
        .developer-control-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: var(--font-size-sm);
            line-height: 1.6;
            margin-bottom: var(--spacing-md);
            text-align: center;
        }
        
        .developer-control-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            width: 100%;
        }
        
        .developer-control-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }
        
        .developer-control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .developer-control-btn:hover::before {
            left: 100%;
        }
        
        .developer-control-btn.danger {
            background: linear-gradient(135deg, var(--danger), #c82333);
        }
        
        .developer-control-btn.danger:hover {
            background: linear-gradient(135deg, #c82333, var(--danger));
        }
        
        .developer-control-btn.warning {
            background: linear-gradient(135deg, var(--warning), #e0a800);
        }
        
        .developer-control-btn.warning:hover {
            background: linear-gradient(135deg, #e0a800, var(--warning));
        }
        
        .developer-control-btn.success {
            background: linear-gradient(135deg, var(--success), #1e7e34);
        }
        
        .developer-control-btn.success:hover {
            background: linear-gradient(135deg, #1e7e34, var(--success));
        }
        
        /* 开发者模式切换按钮 */
        .developer-mode-toggle {
            position: fixed;
            top: var(--spacing-lg);
            right: var(--spacing-lg);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: var(--font-size-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-fixed);
            backdrop-filter: blur(10px);
        }
        
        .developer-mode-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }
        
        .developer-mode-toggle.active {
            background: linear-gradient(135deg, var(--success), var(--success-dark));
            animation: pulse 2s infinite;
        }
        
        .developer-mode-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .developer-mode-toggle:hover::before {
            left: 100%;
        }
        
        /* 现代化用户管理系统样式 */
        .user-management-section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .user-management-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--info), var(--secondary), var(--primary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .user-management-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--bg-tertiary);
        }
        
        .user-management-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--info);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .user-management-description {
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            line-height: 1.6;
        }
        
        .user-list {
            margin: var(--spacing-lg) 0;
        }
        
        .user-item {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border: 1px solid var(--bg-tertiary);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }
        
        .user-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-md);
            border-color: var(--info);
        }
        
        .user-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--info);
            transition: all var(--transition-normal);
        }
        
        .user-item:hover::before {
            width: 8px;
            box-shadow: 0 0 20px rgba(23, 162, 184, 0.5);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
        }
        
        .user-details {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--font-size-lg);
            font-weight: 600;
        }
        
        .user-text-info {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }
        
        .user-name {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .user-role {
            background: var(--info);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-sm);
            font-weight: 600;
        }
        
        .user-role.admin {
            background: var(--danger);
        }
        
        .user-role.partner {
            background: var(--success);
        }
        
        .user-role.guest {
            background: var(--warning);
        }
        
        .user-actions {
            display: flex;
            gap: var(--spacing-sm);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }
        
        .user-item:hover .user-actions {
            opacity: 1;
        }
        
        .user-action-btn {
            background: none;
            border: none;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-normal);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }
        
        .user-action-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transform: scale(1.1);
        }
        
        .user-action-btn.delete {
            color: var(--danger);
        }
        
        .user-action-btn.delete:hover {
            background: rgba(220, 53, 69, 0.1);
        }
        
        .user-action-btn.edit {
            color: var(--info);
        }
        
        .user-action-btn.edit:hover {
            background: rgba(23, 162, 184, 0.1);
        }
        
        .user-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--bg-tertiary);
        }
        
        .user-stat {
            text-align: center;
            padding: var(--spacing-sm);
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
        }
        
        .user-stat-value {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }
        
        .user-stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }
        
        /* 用户注册/登录表单 */
        .user-auth-form {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            border: 2px solid var(--info);
            position: relative;
            overflow: hidden;
        }
        
        .user-auth-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--info), var(--secondary), var(--primary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .user-auth-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
        }
        
        .user-auth-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--info);
            margin-bottom: var(--spacing-sm);
        }
        
        .user-auth-description {
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            line-height: 1.6;
        }
        
        .user-auth-fields {
            display: grid;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }
        
        .user-auth-field {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }
        
        .user-auth-label {
            font-size: var(--font-size-base);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .user-auth-input {
            padding: var(--spacing-md);
            border: 2px solid var(--bg-tertiary);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            transition: all var(--transition-normal);
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .user-auth-input:focus {
            border-color: var(--info);
            box-shadow: 0 0 0 3px rgba(23, 162, 184, 0.1);
            outline: none;
        }
        
        .user-auth-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .user-auth-btn {
            background: linear-gradient(135deg, var(--info), var(--info-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }
        
        .user-auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--info-dark), var(--info));
        }
        
        .user-auth-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .user-auth-btn:hover::before {
            left: 100%;
        }
        
        /* 现代化人脸识别系统样式 */
        .face-recognition-section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .face-recognition-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--warning), var(--accent), var(--primary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .face-recognition-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--bg-tertiary);
        }
        
        .face-recognition-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--warning);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .face-recognition-description {
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            line-height: 1.6;
        }
        
        .face-recognition-area {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.05), rgba(255, 214, 107, 0.05));
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            border: 2px dashed rgba(255, 193, 7, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all var(--transition-normal);
        }
        
        .face-recognition-area:hover {
            border-color: var(--warning);
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 214, 107, 0.1));
            transform: translateY(-2px);
        }
        
        .face-recognition-area::before {
            content: '📷';
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            font-size: 2rem;
            opacity: 0.3;
        }
        
        .face-recognition-video {
            width: 100%;
            max-width: 400px;
            height: 300px;
            border-radius: var(--radius-lg);
            background: var(--bg-tertiary);
            border: 2px solid var(--bg-tertiary);
            margin: var(--spacing-lg) auto;
            display: block;
            transition: all var(--transition-normal);
        }
        
        .face-recognition-video:hover {
            border-color: var(--warning);
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.3);
        }
        
        .face-recognition-canvas {
            width: 100%;
            max-width: 400px;
            height: 300px;
            border-radius: var(--radius-lg);
            background: var(--bg-tertiary);
            border: 2px solid var(--bg-tertiary);
            margin: var(--spacing-lg) auto;
            display: none;
            transition: all var(--transition-normal);
        }
        
        .face-recognition-canvas.show {
            display: block;
        }
        
        .face-recognition-controls {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin: var(--spacing-lg) 0;
        }
        
        .face-recognition-btn {
            background: linear-gradient(135deg, var(--warning), var(--warning-dark));
            color: var(--text-primary);
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            min-width: 120px;
        }
        
        .face-recognition-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--warning-dark), var(--warning));
        }
        
        .face-recognition-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .face-recognition-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .face-recognition-btn:hover::before {
            left: 100%;
        }
        
        .face-recognition-status {
            background: rgba(255, 193, 7, 0.1);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-lg) 0;
            border: 1px solid rgba(255, 193, 7, 0.2);
            text-align: center;
            transition: all var(--transition-normal);
        }
        
        .face-recognition-status.success {
            background: rgba(40, 167, 69, 0.1);
            border-color: var(--success);
        }
        
        .face-recognition-status.error {
            background: rgba(220, 53, 69, 0.1);
            border-color: var(--danger);
        }
        
        .face-recognition-status-text {
            font-size: var(--font-size-base);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }
        
        .face-recognition-status-description {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            line-height: 1.6;
        }
        
        /* 人脸识别结果展示 */
        .face-recognition-result {
            background: linear-gradient(135deg, rgba(255, 214, 107, 0.1), rgba(255, 193, 7, 0.1));
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            border: 2px solid var(--accent);
            text-align: center;
            opacity: 0;
            transform: scale(0.8);
            transition: all var(--transition-bounce);
        }
        
        .face-recognition-result.show {
            opacity: 1;
            transform: scale(1);
        }
        
        .face-recognition-result-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            animation: bounce 1s ease-in-out;
        }
        
        .face-recognition-result-text {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
            line-height: 1.6;
        }
        
        .face-recognition-result-description {
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            line-height: 1.6;
        }
        
        .face-recognition-result-user {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-top: var(--spacing-md);
            border: 1px solid var(--bg-tertiary);
        }
        
        .face-recognition-result-user-name {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }
        
        .face-recognition-result-user-role {
            background: var(--success);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-sm);
            font-weight: 600;
            display: inline-block;
        }
        
        /* 独立互动游戏区域样式 */
        .mini-games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }
        
        .mini-game-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-sm);
            min-height: 120px;
            justify-content: center;
        }
        
        .mini-game-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-xl);
        }
        
        .mini-game-btn:active {
            transform: translateY(-2px) scale(1.01);
        }
        
        .mini-game-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left var(--transition-slow);
        }
        
        .mini-game-btn:hover::before {
            left: 100%;
        }
        
        .mini-game-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }
        
        .mini-game-btn.secondary {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
        }
        
        .mini-game-btn.accent {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
        }
        
        .game-icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: var(--spacing-xs);
        }
        
        .game-text {
            font-size: var(--font-size-base);
            font-weight: 600;
            text-align: center;
        }
        

        
        /* 游戏统计样式 */
        .game-stats {
            display: flex;
            justify-content: space-between;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--bg-tertiary);
        }
        
        .stat-item {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            text-align: center;
            border: 1px solid var(--bg-tertiary);
            transition: all var(--transition-normal);
        }
        
        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }
        
        .stat-icon {
            font-size: 1.5rem;
            display: block;
            margin-bottom: var(--spacing-xs);
        }
        
        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            display: block;
            margin-bottom: var(--spacing-xs);
        }
        
        .stat-value {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--text-primary);
            display: block;
        }
        
        /* 现代化系统设置面板样式 */
        .system-settings-panel {
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin: var(--spacing-xl) 0;
            box-shadow: var(--shadow-xl);
            border: 2px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .system-settings-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--info), var(--secondary), var(--primary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .system-settings-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--bg-tertiary);
            position: relative;
        }
        
        .system-settings-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--info);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .system-settings-subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
            line-height: 1.6;
            opacity: 0.9;
        }
        
        .system-settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-xl) 0;
        }
        
        .system-settings-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .system-settings-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--info);
            box-shadow: 0 10px 30px rgba(23, 162, 184, 0.2);
        }
        
        .system-settings-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--info), var(--secondary), var(--primary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .system-settings-card-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .system-settings-card-icon {
            font-size: 2rem;
            color: var(--info);
            width: 50px;
            height: 50px;
            background: rgba(23, 162, 184, 0.1);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .system-settings-card-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-light);
            margin: 0;
        }
        
        .system-settings-card-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: var(--font-size-base);
            line-height: 1.6;
            margin-bottom: var(--spacing-lg);
        }
        
        .system-settings-controls {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }
        
        .system-settings-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition-normal);
        }
        
        .system-settings-control:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--info);
        }
        
        .system-settings-control-label {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--text-light);
            font-weight: 500;
        }
        
        .system-settings-control-icon {
            font-size: 1.2rem;
            color: var(--info);
        }
        
        .system-settings-control-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            color: var(--text-light);
            font-size: var(--font-size-base);
            transition: all var(--transition-normal);
        }
        
        .system-settings-control-input:focus {
            outline: none;
            border-color: var(--info);
            box-shadow: 0 0 0 3px rgba(23, 162, 184, 0.1);
        }
        
        .system-settings-toggle {
            position: relative;
            width: 50px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-normal);
        }
        
        .system-settings-toggle.active {
            background: var(--info);
        }
        
        .system-settings-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: var(--radius-full);
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-sm);
        }
        
        .system-settings-toggle.active::after {
            transform: translateX(26px);
        }
        
        .system-settings-btn {
            background: linear-gradient(135deg, var(--info), var(--info-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            width: 100%;
            margin-top: var(--spacing-md);
        }
        
        .system-settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--info-dark), var(--info));
        }
        
        .system-settings-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .system-settings-btn:hover::before {
            left: 100%;
        }
        
        /* 现代化数据管理面板样式 */
        .data-management-panel {
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin: var(--spacing-xl) 0;
            box-shadow: var(--shadow-xl);
            border: 2px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .data-management-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--success), var(--accent), var(--primary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .data-management-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--bg-tertiary);
            position: relative;
        }
        
        .data-management-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--success);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .data-management-subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
            line-height: 1.6;
            opacity: 0.9;
        }
        
        .data-management-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-xl) 0;
        }
        
        .data-stat-card {
            background: rgba(40, 167, 69, 0.1);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 2px solid rgba(40, 167, 69, 0.2);
            text-align: center;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }
        
        .data-stat-card:hover {
            transform: translateY(-5px);
            background: rgba(40, 167, 69, 0.15);
            border-color: var(--success);
            box-shadow: 0 10px 30px rgba(40, 167, 69, 0.2);
        }
        
        .data-action-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--success), var(--accent), var(--primary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .data-action-icon {
            font-size: 2.5rem;
            color: var(--success);
            margin-bottom: var(--spacing-md);
            display: block;
        }
        
        .data-action-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: var(--spacing-sm);
        }
        
        .data-action-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: var(--font-size-base);
            line-height: 1.6;
            margin-bottom: var(--spacing-lg);
        }
        
        .data-action-btn {
            background: linear-gradient(135deg, var(--success), var(--success-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            width: 100%;
        }
        
        .data-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--success-dark), var(--success));
        }
        
        .data-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .data-action-btn:hover::before {
            left: 100%;
        }
        
        .data-action-btn.danger {
            background: linear-gradient(135deg, var(--danger), var(--danger-dark));
        }
        
        .data-action-btn.danger:hover {
            background: linear-gradient(135deg, var(--danger-dark), var(--danger));
        }
        
        .data-action-btn.warning {
            background: linear-gradient(135deg, var(--warning), var(--warning-dark));
        }
        
        .data-action-btn.warning:hover {
            background: linear-gradient(135deg, var(--warning-dark), var(--warning));
        }
        
        /* 现代化性能优化面板样式 */
        .performance-panel {
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin: var(--spacing-xl) 0;
            box-shadow: var(--shadow-xl);
            border: 2px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .performance-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--primary), var(--secondary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .performance-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--bg-tertiary);
            position: relative;
        }
        
        .performance-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--accent);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .performance-subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
            line-height: 1.6;
            opacity: 0.9;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-xl) 0;
        }
        
        .performance-metric {
            background: rgba(108, 92, 231, 0.1);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 2px solid rgba(108, 92, 231, 0.2);
            text-align: center;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }
        
        .performance-metric:hover {
            transform: translateY(-5px);
            background: rgba(108, 92, 231, 0.15);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(108, 92, 231, 0.2);
        }
        
        .performance-metric::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(108, 92, 231, 0.05), transparent);
            pointer-events: none;
        }
        
        .performance-metric-icon {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: var(--spacing-md);
            display: block;
        }
        
        .performance-metric-value {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
            display: block;
        }
        
        .performance-metric-label {
            font-size: var(--font-size-base);
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: var(--spacing-sm);
        }
        
        .performance-metric-status {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-sm);
            font-weight: 600;
        }
        
        .performance-metric-status.good {
            background: rgba(40, 167, 69, 0.2);
            color: var(--success);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }
        
        .performance-metric-status.warning {
            background: rgba(255, 193, 7, 0.2);
            color: var(--warning);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .performance-metric-status.poor {
            background: rgba(220, 53, 69, 0.2);
            color: var(--danger);
            border: 1px solid rgba(220, 53, 69, 0.3);
        }
        
        .performance-optimizations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-xl) 0;
        }
        
        .performance-optimization {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .performance-optimization:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(108, 92, 231, 0.2);
        }
        
        .performance-optimization::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--accent), var(--primary), var(--secondary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .performance-optimization-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .performance-optimization-icon {
            font-size: 2rem;
            color: var(--accent);
            width: 50px;
            height: 50px;
            background: rgba(108, 92, 231, 0.1);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .performance-optimization-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-light);
            margin: 0;
        }
        
        .performance-optimization-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: var(--font-size-base);
            line-height: 1.6;
            margin-bottom: var(--spacing-lg);
        }
        
        .performance-optimization-progress {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            height: 8px;
            margin-bottom: var(--spacing-md);
            overflow: hidden;
            position: relative;
        }
        
        .performance-optimization-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            border-radius: var(--radius-full);
            transition: width var(--transition-slow);
            position: relative;
            overflow: hidden;
        }
        
        .performance-optimization-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        .performance-optimization-actions {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }
        
        .performance-optimization-btn {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: var(--font-size-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            flex: 1;
            min-width: 120px;
        }
        
        .performance-optimization-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--accent-dark), var(--accent));
        }
        
        .performance-optimization-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .performance-optimization-btn:hover::before {
            left: 100%;
        }
        
        /* 移动端响应式设计系统 */
        @media (max-width: 768px) {
            /* 移动端基础布局调整 */
            .container {
                padding: var(--spacing-md);
                margin: var(--spacing-sm);
            }
            
            /* 移动端标题系统 */
            h1 {
                font-size: clamp(1.8rem, 6vw, 2.5rem);
                line-height: 1.2;
                margin-bottom: var(--spacing-md);
            }
            
            .subtitle {
                font-size: var(--font-size-base);
                line-height: 1.4;
            }
            
            /* 移动端卡片系统 */
            .card {
                padding: var(--spacing-md);
                margin: var(--spacing-md) 0;
                border-radius: var(--radius-lg);
            }
            
            .card-header {
                flex-direction: column;
                gap: var(--spacing-sm);
                text-align: center;
            }
            
            .header-icon {
                margin: 0 auto var(--spacing-sm);
            }
            
            /* 移动端时间轴系统 */
            .timeline-item {
                margin: var(--spacing-md) 0;
            }
            
            .timeline-date {
                font-size: var(--font-size-sm);
                padding: var(--spacing-xs) var(--spacing-sm);
                border-radius: var(--radius-sm);
            }
            
            .timeline-content {
                padding: var(--spacing-md);
                margin-left: var(--spacing-md);
            }
            
            .timeline-title {
                font-size: var(--font-size-lg);
                margin-bottom: var(--spacing-sm);
            }
            
            /* 移动端恋爱动态系统 */
            .love-feed-section {
                padding: var(--spacing-lg);
                margin: var(--spacing-lg) 0;
            }
            
            .love-feed-header h2 {
                font-size: clamp(1.5rem, 5vw, 2rem);
            }
            
            .love-feed-form {
                padding: var(--spacing-lg);
            }
            
            .form-group {
                margin-bottom: var(--spacing-md);
            }
            
            .form-input, .form-textarea {
                padding: var(--spacing-md);
                font-size: var(--font-size-base);
            }
            
            /* 移动端图片上传系统 */
            .image-upload-area {
                padding: var(--spacing-lg);
                margin: var(--spacing-md) 0;
            }
            
            .image-preview-list {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: var(--spacing-sm);
            }
            
            .image-preview-item {
                aspect-ratio: 1;
            }
            
            /* 移动端互动游戏系统 */
            .mini-games-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .mini-game-btn {
                padding: var(--spacing-lg);
                min-height: 100px;
            }
            
            .game-icon {
                font-size: 2rem;
            }
            
            .game-stats {
                display: flex;
                justify-content: space-between;
                gap: var(--spacing-sm);
            }
            
            .stat-item {
                flex: 1;
                min-width: 0;
            }
            
            .stat-item {
                padding: var(--spacing-sm);
            }
            
            .stat-value {
                font-size: var(--font-size-lg);
            }
            
            /* 移动端开发者面板 */
            .developer-panel {
                padding: var(--spacing-lg);
                margin: var(--spacing-lg) 0;
            }
            
            .developer-controls {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .developer-control-card {
                padding: var(--spacing-md);
            }
            
            .developer-control-icon {
                font-size: 2rem;
            }
            
            /* 移动端用户管理系统 */
            .user-management-section {
                padding: var(--spacing-md);
                margin: var(--spacing-md) 0;
            }
            
            .user-list {
                margin: var(--spacing-md) 0;
            }
            
            .user-item {
                padding: var(--spacing-md);
            }
            
            .user-info {
                flex-direction: column;
                gap: var(--spacing-sm);
                text-align: center;
            }
            
            .user-actions {
                justify-content: center;
                margin-top: var(--spacing-sm);
            }
            
            /* 移动端人脸识别系统 */
            .face-recognition-section {
                padding: var(--spacing-md);
                margin: var(--spacing-md) 0;
            }
            
            .face-recognition-video,
            .face-recognition-canvas {
                max-width: 100%;
                height: 250px;
            }
            
            .face-recognition-controls {
                flex-direction: column;
                gap: var(--spacing-sm);
            }
            
            .face-recognition-btn {
                width: 100%;
                min-width: auto;
            }
            
            /* 移动端系统设置面板 */
            .system-settings-panel {
                padding: var(--spacing-lg);
                margin: var(--spacing-lg) 0;
            }
            
            .system-settings-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .system-settings-card {
                padding: var(--spacing-md);
            }
            
            /* 移动端数据管理面板 */
            .data-management-panel {
                padding: var(--spacing-lg);
                margin: var(--spacing-lg) 0;
            }
            
            .data-management-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--spacing-md);
            }
            
            .data-management-actions {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            /* 移动端性能优化面板 */
            .performance-panel {
                padding: var(--spacing-lg);
                margin: var(--spacing-lg) 0;
            }
            
            .performance-metrics {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .performance-optimizations {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            /* 移动端按钮系统 */
            .btn {
                padding: var(--spacing-md) var(--spacing-lg);
                font-size: var(--font-size-base);
                width: 100%;
                margin: var(--spacing-sm) 0;
            }
            
            .interactive-btn {
                padding: var(--spacing-md) var(--spacing-lg);
                font-size: var(--font-size-base);
                width: 100%;
                margin: var(--spacing-sm) 0;
            }
            
            /* 移动端弹窗系统 */
            .modal {
                padding: var(--spacing-md);
            }
            
            .modal-content {
                width: 95%;
                max-width: none;
                margin: var(--spacing-md);
            }
            
            .modal-header {
                padding: var(--spacing-md);
            }
            
            .modal-body {
                padding: var(--spacing-md);
            }
            
            .modal-footer {
                padding: var(--spacing-md);
                flex-direction: column;
                gap: var(--spacing-sm);
            }
            
            .modal-btn {
                width: 100%;
                margin: var(--spacing-xs) 0;
            }
        }
        
        /* 超小屏幕适配 */
        @media (max-width: 480px) {
            .container {
                padding: var(--spacing-sm);
                margin: var(--spacing-xs);
            }
            
            .card {
                padding: var(--spacing-sm);
                margin: var(--spacing-sm) 0;
            }
            
            .timeline-content {
                padding: var(--spacing-sm);
                margin-left: var(--spacing-sm);
            }
            
            .love-feed-section {
                padding: var(--spacing-md);
            }
            
            .love-feed-form {
                padding: var(--spacing-md);
            }
            
            .mini-game-btn {
                padding: var(--spacing-md);
                min-height: 80px;
            }
            
            .game-icon {
                font-size: 1.5rem;
            }
            
            .game-stats {
                display: flex;
                justify-content: space-between;
                gap: var(--spacing-sm);
            }
            
            .stat-item {
                flex: 1;
                min-width: 0;
            }
            
            .developer-controls {
                gap: var(--spacing-sm);
            }
            
            .system-settings-grid {
                gap: var(--spacing-sm);
            }
            
            .data-management-stats {
                grid-template-columns: 1fr;
            }
            
            .performance-metrics {
                gap: var(--spacing-sm);
            }
        }
        
        /* 平板端适配 */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                padding: var(--spacing-lg);
                margin: var(--spacing-md);
            }
            
            .mini-games-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .developer-controls {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .system-settings-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .data-management-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .performance-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* 触摸设备优化 */
        @media (hover: none) and (pointer: coarse) {
            /* 触摸友好的按钮尺寸 */
            .btn, .interactive-btn, .mini-game-btn {
                min-height: 44px;
                padding: var(--spacing-md) var(--spacing-lg);
            }
            
            /* 触摸友好的输入框 */
            .form-input, .form-textarea {
                min-height: 44px;
                padding: var(--spacing-md);
            }
            
            /* 触摸友好的开关 */
            .system-settings-toggle {
                width: 60px;
                height: 30px;
            }
            
            .system-settings-toggle::after {
                width: 26px;
                height: 26px;
            }
            
            /* 触摸友好的进度条 */
            .performance-optimization-progress {
                height: 12px;
            }
            
            /* 触摸友好的统计卡片 */
            .stat-item, .data-stat-card, .performance-metric {
                min-height: 80px;
                padding: var(--spacing-md);
            }
            
            /* 触摸设备照片管理优化 */
            .photo-delete-btn {
                opacity: 1 !important;
            }
            
            .media-item:hover .image-overlay {
                opacity: 1 !important;
            }
        }
        
        /* 手机端照片管理优化 */
        @media (max-width: 768px) {
            /* 甜蜜相册标题区域在手机端垂直排列 */
            #sweet-photo-section > div:first-child {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            /* 照片管理按钮在手机端垂直排列 */
            #photo-management-buttons {
                flex-direction: column;
                gap: 0.5rem;
                align-items: stretch;
                width: 100%;
            }
            
            #photo-management-buttons button {
                margin-right: 0 !important;
                margin-bottom: 0.5rem;
                width: 100%;
                justify-content: center;
            }
            
            /* 照片网格在手机端单列显示 */
            .media-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            
            /* 照片删除按钮在手机端始终可见 */
            .photo-delete-btn {
                opacity: 1 !important;
                width: 28px !important;
                height: 28px !important;
                font-size: 14px !important;
            }
            
            /* 模态框动画效果 */
            @keyframes modalFadeIn {
                from {
                    opacity: 0;
                    transform: scale(0.9);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }
            
            /* 模态框在手机端全屏显示 */
            #photo-upload-modal > div,
            #photo-management-modal > div {
                width: 95vw !important;
                max-width: 95vw !important;
                max-height: 95vh !important;
                border-radius: 15px !important;
                padding: 1rem !important;
            }
            
            /* 照片管理列表在手机端单列显示 */
            #photo-management-list {
                grid-template-columns: 1fr !important;
                gap: 0.6rem !important;
            }
            
            /* 照片管理项目在手机端更大 */
            #photo-management-list > div {
                padding: 1rem !important;
            }
            
            #photo-management-list > div > div:first-child {
                width: 100px !important;
                height: 100px !important;
                font-size: 2rem !important;
            }
        }
        
        /* 触摸手势支持系统 */
        .touch-gesture-area {
            position: relative;
            overflow: hidden;
            touch-action: pan-y pinch-zoom;
        }
        
        .touch-gesture-area.swipeable {
            cursor: grab;
        }
        
        .touch-gesture-area.swipeable:active {
            cursor: grabbing;
        }
        
        .touch-gesture-area.swipeable .swipe-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-primary);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            opacity: 0;
            transition: opacity var(--transition-normal);
            pointer-events: none;
            z-index: var(--z-tooltip);
        }
        
        .touch-gesture-area.swipeable:hover .swipe-indicator {
            opacity: 1;
        }
        
        /* 触摸反馈效果 */
        .touch-feedback {
            position: relative;
            overflow: hidden;
        }
        
        .touch-feedback::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all var(--transition-fast);
            pointer-events: none;
        }
        
        .touch-feedback:active::after {
            width: 200px;
            height: 200px;
            opacity: 0;
        }
        
        /* 触摸滑动指示器 */
        .swipe-hint {
            position: absolute;
            bottom: var(--spacing-md);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            opacity: 0;
            transition: opacity var(--transition-normal);
            pointer-events: none;
        }
        
        /* 对话框关闭按钮样式 */
        .dialog-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            background: #f0f0f0;
            border: none;
            color: #666;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            line-height: 1;
            font-weight: bold;
            z-index: 1000;
            display: block;
            visibility: visible;
            opacity: 1;
            transition: all 0.2s ease;
        }
        
        .dialog-close-btn:hover {
            background: #e0e0e0;
            color: #333;
        }
        
        .dialog-close-btn.hidden {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        /* 卡片关闭按钮样式 */
        .card-close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 107, 158, 0.2);
            border-radius: 50%;
            color: #ff6b9e;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            backdrop-filter: blur(5px);
            box-shadow: 0 1px 4px rgba(255, 107, 158, 0.15);
            z-index: 10;
        }
        
        .card-close-btn:hover {
            background: rgba(255, 107, 158, 0.1);
            border-color: rgba(255, 107, 158, 0.4);
            transform: scale(1.1);
        }
        
        .card-close-btn.love-quiz {
            border-color: rgba(255, 139, 171, 0.2);
            color: #ff8fab;
            box-shadow: 0 1px 4px rgba(255, 139, 171, 0.15);
        }
        
        .card-close-btn.love-quiz:hover {
            background: rgba(255, 139, 171, 0.1);
            border-color: rgba(255, 139, 171, 0.4);
        }
        
        #custom-dialog-close:hover {
            background: #e0e0e0 !important;
            color: #333 !important;
        }
        
        /* 对话框关闭按钮移动端适配 */
        @media (max-width: 768px) {
            #custom-dialog-close {
                top: 6px !important;
                right: 10px !important;
                width: 36px !important;
                height: 36px !important;
                font-size: 28px !important;
            }
        }
        
        @media (max-width: 480px) {
            #custom-dialog-close {
                top: 5px !important;
                right: 8px !important;
                width: 40px !important;
                height: 40px !important;
                font-size: 32px !important;
            }
        }
        
        /* 移动端触摸优化 */
        @media (max-width: 768px) {
            /* 触摸目标大小优化 */
            button, 
            .btn, 
            .interactive-btn,
            input[type="button"],
            input[type="submit"] {
                min-height: 44px !important;
                min-width: 44px !important;
                touch-action: manipulation !important;
            }
            
            /* 触摸反馈优化 */
            button:active,
            .btn:active,
            .interactive-btn:active {
                transform: scale(0.95) !important;
                transition: transform 0.1s ease !important;
            }
            
            /* 滚动优化 */
            * {
                -webkit-overflow-scrolling: touch !important;
                scroll-behavior: smooth !important;
            }
            
            /* 防止双击缩放 */
            * {
                touch-action: manipulation !important;
            }
            
            /* 移动端字体大小优化 */
            body {
                font-size: 16px !important; /* 防止iOS缩放 */
            }
            
            /* 移动端间距优化 */
            .section,
            .memory-counter,
            .timeline-item {
                margin: 1rem 0 !important;
                padding: 1rem !important;
            }
            
            /* 移动端图片优化 */
            img {
                max-width: 100% !important;
                height: auto !important;
                object-fit: cover !important;
            }
            
            /* 移动端表单优化 */
            input, textarea, select {
                font-size: 16px !important; /* 防止iOS缩放 */
                padding: 0.8rem !important;
                border-radius: 8px !important;
            }
            
            /* 移动端链接优化 */
            a {
                padding: 0.5rem !important;
                min-height: 44px !important;
                display: inline-flex !important;
                align-items: center !important;
            }
        }
        
        /* 超小屏幕额外优化 */
        @media (max-width: 480px) {
            /* 更紧凑的布局 */
            .section,
            .memory-counter,
            .timeline-item {
                margin: 0.5rem 0 !important;
                padding: 0.8rem !important;
            }
            
            /* 更小的字体 */
            h1 { font-size: 1.5rem !important; }
            h2 { font-size: 1.3rem !important; }
            h3 { font-size: 1.1rem !important; }
            p { font-size: 0.9rem !important; }
            
            /* 更紧凑的按钮 */
            button, .btn, .interactive-btn {
                padding: 0.7rem 1rem !important;
                font-size: 0.9rem !important;
            }
        }
        
        /* 横屏模式优化 */
        @media (max-width: 768px) and (orientation: landscape) {
            .face-recognition-content,
            #photo-management-modal > div,
            #permission-panel {
                max-height: 90vh !important;
                overflow-y: auto !important;
            }
            
            .camera-container {
                height: 180px !important;
            }
            
            .recognition-controls {
                flex-direction: row !important;
                gap: 1rem !important;
            }
            
            .capture-btn,
            .retry-btn {
                width: auto !important;
                min-width: 120px !important;
            }
        }
        
        /* 权限面板移动端适配 */
        @media (max-width: 768px) {
            #permission-panel {
                padding: 1rem !important;
                margin: 1rem !important;
                border-radius: 15px !important;
            }
            
            #permission-panel h3 {
                font-size: 1.2rem !important;
                margin-bottom: 1rem !important;
            }
            
            #permission-panel .permission-info {
                flex-direction: column !important;
                gap: 1rem !important;
                align-items: flex-start !important;
            }
            
            #permission-panel .permission-level {
                font-size: 1.1rem !important;
            }
            
            #permission-panel .permission-desc {
                font-size: 0.9rem !important;
                line-height: 1.4 !important;
            }
            
            #permission-panel button {
                width: 100% !important;
                margin: 0.5rem 0 !important;
                padding: 1rem !important;
                font-size: 1rem !important;
            }
        }
        
        @media (max-width: 480px) {
            #permission-panel {
                padding: 0.8rem !important;
                margin: 0.5rem !important;
                border-radius: 12px !important;
            }
            
            #permission-panel h3 {
                font-size: 1.1rem !important;
            }
            
            #permission-panel .permission-level {
                font-size: 1rem !important;
            }
            
            #permission-panel .permission-desc {
                font-size: 0.85rem !important;
            }
            
            #permission-panel button {
                padding: 0.8rem !important;
                font-size: 0.95rem !important;
            }
        }
        
        .swipe-hint {
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-sm);
            opacity: 0;
            transition: opacity var(--transition-normal);
            pointer-events: none;
            z-index: var(--z-tooltip);
        }
        
        .swipe-hint.show {
            opacity: 1;
        }
        
        .swipe-hint::before {
            content: '👆';
            margin-right: var(--spacing-xs);
        }
        
        /* 触摸滚动优化 */
        .touch-scroll {
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }
        
        .touch-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .touch-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
        }
        
        .touch-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-sm);
        }
        
        .touch-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        /* 触摸选择优化 */
        .touch-select {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* 移动端性能优化 */
        @media (max-width: 768px) {
            /* 减少动画复杂度 */
            * {
                animation-duration: 0.3s !important;
                transition-duration: 0.3s !important;
            }
            
            /* 优化阴影效果 */
            .btn, .interactive-btn, .card {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
            }
            
            /* 减少渐变复杂度 */
            .btn, .interactive-btn {
                background: var(--primary) !important;
            }
            
            /* 优化字体渲染 */
            body {
                -webkit-font-smoothing: antialiased !important;
                -moz-osx-font-smoothing: grayscale !important;
                text-rendering: optimizeLegibility !important;
            }
            
            /* 减少重绘 */
            .fixed-element {
                will-change: transform !important;
                transform: translateZ(0) !important;
            }
            
            /* 优化触摸响应 */
            button, .btn, .interactive-btn {
                -webkit-tap-highlight-color: transparent !important;
                touch-action: manipulation !important;
            }
            
            /* 移动端可访问性优化 */
            /* 焦点指示器 */
            button:focus,
            .btn:focus,
            .interactive-btn:focus,
            input:focus,
            textarea:focus,
            select:focus {
                outline: 2px solid var(--primary) !important;
                outline-offset: 2px !important;
                border-radius: 4px !important;
            }
            
            /* 高对比度模式支持 */
            @media (prefers-contrast: high) {
                .btn, .interactive-btn {
                    border: 2px solid var(--text) !important;
                    background: var(--bg) !important;
                    color: var(--text) !important;
                }
            }
            
            /* 减少动画模式支持 */
            @media (prefers-reduced-motion: reduce) {
                * {
                    animation: none !important;
                    transition: none !important;
                }
            }
            
            /* 触摸目标大小确保 */
            .touch-target {
                min-height: 44px !important;
                min-width: 44px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
        }
        
        .touch-select.text {
            -webkit-touch-callout: default;
            -webkit-user-select: text;
            -khtml-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        /* 现代化主题系统样式 */
        .theme-switcher {
            position: fixed;
            top: var(--spacing-lg);
            left: var(--spacing-lg);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: var(--font-size-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-fixed);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .theme-switcher:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }
        
        .theme-switcher::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .theme-switcher:hover::before {
            left: 100%;
        }
        
        .theme-switcher-icon {
            font-size: 1.2rem;
            transition: transform var(--transition-bounce);
        }
        
        .theme-switcher:hover .theme-switcher-icon {
            transform: rotate(180deg);
        }
        
        /* 主题切换动画 */
        .theme-transition {
            transition: all var(--transition-slow);
        }
        
        .theme-transition * {
            transition: all var(--transition-slow);
        }
        
        /* 浅色主题变量 */
        :root[data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --bg-dark: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --text-light: #495057;
            --text-muted: #adb5bd;
            --primary: #ff6b9e;
            --primary-dark: #e55a8a;
            --secondary: #6c5ce7;
            --secondary-dark: #5a4fcf;
            --accent: #00cec9;
            --accent-dark: #00b894;
            --success: #28a745;
            --success-dark: #1e7e34;
            --warning: #ffc107;
            --warning-dark: #e0a800;
            --danger: #dc3545;
            --danger-dark: #c82333;
            --info: #17a2b8;
            --info-dark: #138496;
            --border-color: rgba(0, 0, 0, 0.1);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 16px 32px rgba(0, 0, 0, 0.1);
        }
        
        /* 深色主题变量 */
        :root[data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #404040;
            --bg-dark: #0d0d0d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-light: #e0e0e0;
            --text-muted: #808080;
            --primary: #ff6b9e;
            --primary-dark: #e55a8a;
            --secondary: #6c5ce7;
            --secondary-dark: #5a4fcf;
            --accent: #00cec9;
            --accent-dark: #00b894;
            --success: #28a745;
            --success-dark: #1e7e34;
            --warning: #ffc107;
            --warning-dark: #e0a800;
            --danger: #dc3545;
            --danger-dark: #c82333;
            --info: #17a2b8;
            --info-dark: #138496;
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.3);
            --shadow-xl: 0 16px 32px rgba(0, 0, 0, 0.3);
        }
        
        /* 自动主题检测 */
        @media (prefers-color-scheme: light) {
            :root:not([data-theme]) {
                --bg-primary: #ffffff;
                --bg-secondary: #f8f9fa;
                --bg-tertiary: #e9ecef;
                --bg-dark: #ffffff;
                --text-primary: #212529;
                --text-secondary: #6c757d;
                --text-light: #495057;
                --text-muted: #adb5bd;
                --border-color: rgba(0, 0, 0, 0.1);
                --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
                --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.1);
                --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.1);
                --shadow-xl: 0 16px 32px rgba(0, 0, 0, 0.1);
            }
        }
        
        @media (prefers-color-scheme: dark) {
            :root:not([data-theme]) {
                --bg-primary: #1a1a1a;
                --bg-secondary: #2d2d2d;
                --bg-tertiary: #404040;
                --bg-dark: #0d0d0d;
                --text-primary: #ffffff;
                --text-secondary: #b0b0b0;
                --text-light: #e0e0e0;
                --text-muted: #808080;
                --border-color: rgba(255, 255, 255, 0.1);
                --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
                --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.3);
                --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.3);
                --shadow-xl: 0 16px 32px rgba(0, 0, 0, 0.3);
            }
        }
        
        /* 现代化个性化定制面板样式 */
        .personalization-panel {
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin: var(--spacing-xl) 0;
            box-shadow: var(--shadow-xl);
            border: 2px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .personalization-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--primary), var(--secondary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .personalization-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--bg-tertiary);
            position: relative;
        }
        
        .personalization-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--accent);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .personalization-subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
            line-height: 1.6;
            opacity: 0.9;
        }
        
        .personalization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-xl) 0;
        }
        
        .personalization-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .personalization-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(0, 206, 201, 0.2);
        }
        
        .personalization-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--accent), var(--primary), var(--secondary));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .personalization-card-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .personalization-card-icon {
            font-size: 2rem;
            color: var(--accent);
            width: 50px;
            height: 50px;
            background: rgba(0, 206, 201, 0.1);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .personalization-card-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-light);
            margin: 0;
        }
        
        .personalization-card-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: var(--font-size-base);
            line-height: 1.6;
            margin-bottom: var(--spacing-lg);
        }
        
        .personalization-controls {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }
        
        .personalization-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition-normal);
        }
        
        .personalization-control:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent);
        }
        
        .personalization-control-label {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--text-light);
            font-weight: 500;
        }
        
        .personalization-control-icon {
            font-size: 1.2rem;
            color: var(--accent);
        }
        
        .personalization-control-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            color: var(--text-light);
            font-size: var(--font-size-base);
            transition: all var(--transition-normal);
        }
        
        .personalization-control-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 206, 201, 0.1);
        }
        
        .personalization-color-picker {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }
        
        .personalization-color-picker:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }
        
        .personalization-color-picker::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .personalization-color-picker:hover::before {
            left: 100%;
        }
        
        .personalization-btn {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-bounce);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            width: 100%;
            margin-top: var(--spacing-md);
        }
        
        .personalization-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--accent-dark), var(--accent));
        }
        
        .personalization-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .personalization-btn:hover::before {
            left: 100%;
        }
        
        /* 现代化页面加载动画系统 */
        .page-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-loading);
            transition: opacity var(--transition-slow), visibility var(--transition-slow);
        }
        
        .page-loader.hidden {
            opacity: 0;
            visibility: hidden;
            display: none !important;
        }
        
        .loader-content {
            text-align: center;
            color: var(--text-primary);
        }
        
        .loader-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(255, 107, 158, 0.2);
            border-top: 4px solid var(--primary);
            border-radius: var(--radius-full);
            animation: spin 1s linear infinite;
            margin: 0 auto var(--spacing-lg);
        }
        
        .loader-text {
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .loader-subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            opacity: 0.8;
        }
        
        .loader-progress {
            width: 200px;
            height: 6px;
            background: rgba(255, 107, 158, 0.2);
            border-radius: var(--radius-full);
            margin: var(--spacing-lg) auto 0;
            overflow: hidden;
            position: relative;
        }
        
        .loader-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: var(--radius-full);
            transition: width var(--transition-slow);
            position: relative;
            overflow: hidden;
        }
        
        .loader-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 页面内容进入动画 */
        .page-content {
            opacity: 0;
            transform: translateY(30px);
            transition: all var(--transition-slow);
        }
        
        .page-content.loaded {
            opacity: 1;
            transform: translateY(0);
        }
        
        .page-content .card,
        .page-content .timeline-item,
        .page-content .love-feed-section,
        .page-content .interactive-section {
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--transition-normal);
        }
        
        .page-content.loaded .card,
        .page-content.loaded .timeline-item,
        .page-content.loaded .love-feed-section,
        .page-content.loaded .interactive-section {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* 错开动画延迟 */
        .page-content.loaded .card:nth-child(1) { transition-delay: 0.1s; }
        .page-content.loaded .card:nth-child(2) { transition-delay: 0.2s; }
        .page-content.loaded .card:nth-child(3) { transition-delay: 0.3s; }
        .page-content.loaded .card:nth-child(4) { transition-delay: 0.4s; }
        .page-content.loaded .card:nth-child(5) { transition-delay: 0.5s; }
        
        .page-content.loaded .timeline-item:nth-child(1) { transition-delay: 0.1s; }
        .page-content.loaded .timeline-item:nth-child(2) { transition-delay: 0.2s; }
        .page-content.loaded .timeline-item:nth-child(3) { transition-delay: 0.3s; }
        .page-content.loaded .timeline-item:nth-child(4) { transition-delay: 0.4s; }
        .page-content.loaded .timeline-item:nth-child(5) { transition-delay: 0.5s; }
        
        .page-content.loaded .love-feed-section { transition-delay: 0.3s; }
        .page-content.loaded .interactive-section { transition-delay: 0.4s; }
        
        /* 现代化滚动触发动画系统 */
        .scroll-animate {
            opacity: 0;
            transform: translateY(50px);
            transition: all var(--transition-slow);
        }
        
        .scroll-animate.animate-in {
            opacity: 1;
            transform: translateY(0);
        }
        
        .scroll-animate.slide-left {
            transform: translateX(-50px);
        }
        
        .scroll-animate.slide-right {
            transform: translateX(50px);
        }
        
        .scroll-animate.scale-in {
            transform: scale(0.8) translateY(50px);
        }
        
        .scroll-animate.scale-in.animate-in {
            transform: scale(1) translateY(0);
        }
        
        .scroll-animate.rotate-in {
            transform: rotate(-10deg) translateY(50px);
        }
        
        .scroll-animate.rotate-in.animate-in {
            transform: rotate(0deg) translateY(0);
        }
        
        .scroll-animate.fade-up {
            transform: translateY(30px);
        }
        
        .scroll-animate.fade-up.animate-in {
            transform: translateY(0);
        }
        
        .scroll-animate.bounce-in {
            transform: translateY(50px) scale(0.8);
        }
        
        .scroll-animate.bounce-in.animate-in {
            transform: translateY(0) scale(1);
            animation: bounce 0.8s ease-out;
        }
        
        /* 滚动进度指示器 */
        .scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            z-index: var(--z-fixed);
            backdrop-filter: blur(10px);
        }
        
        .scroll-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
            transition: width var(--transition-fast);
            position: relative;
            overflow: hidden;
        }
        
        .scroll-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        /* 视差滚动效果 */
        .parallax-container {
            position: relative;
            overflow: hidden;
        }
        
        .parallax-element {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            will-change: transform;
        }
        
        .parallax-slow {
            transform: translateZ(-1px) scale(2);
        }
        
        .parallax-medium {
            transform: translateZ(-0.5px) scale(1.5);
        }
        
        .parallax-fast {
            transform: translateZ(0px) scale(1);
        }
        
        /* 滚动数字动画 */
        .scroll-counter {
            display: inline-block;
            overflow: hidden;
        }
        
        .scroll-counter-number {
            display: inline-block;
            transform: translateY(100%);
            transition: transform var(--transition-slow);
        }
        
        .scroll-counter.animate-in .scroll-counter-number {
            transform: translateY(0);
        }
        
        /* 滚动触发的内容显示 */
        .scroll-reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all var(--transition-normal);
        }
        
        .scroll-reveal.revealed {
            opacity: 1;
            transform: translateY(0);
        }
        
        .scroll-reveal.stagger-4 { transition-delay: 0.4s; }
        .scroll-reveal.stagger-5 { transition-delay: 0.5s; }
        
        /* 现代化交互动画系统 */
        .interactive-animation {
            transition: all var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }
        
        .interactive-animation::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all var(--transition-fast);
            pointer-events: none;
        }
        
        .interactive-animation:active::before {
            width: 200px;
            height: 200px;
            opacity: 0;
        }
        
        /* 按钮交互动画 */
        .btn-animated {
            position: relative;
            overflow: hidden;
            transition: all var(--transition-bounce);
        }
        
        .btn-animated::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-slow);
        }
        
        .btn-animated:hover::before {
            left: 100%;
        }
        
        .btn-animated:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-xl);
        }
        
        .btn-animated:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        /* 卡片交互动画 */
        .card-animated {
            transition: all var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }
        
        .card-animated::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transform: translateX(-100%);
            transition: transform var(--transition-slow);
        }
        
        .card-animated:hover::before {
            transform: translateX(100%);
        }
        
        .card-animated:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-xl);
        }
        
        /* 图片交互动画 */
        .image-animated {
            transition: all var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }
        
        .image-animated::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 107, 158, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform var(--transition-slow);
            z-index: 1;
        }
        
        .image-animated:hover::before {
            transform: translateX(100%);
        }
        
        .image-animated:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }
        
        .image-animated img {
            transition: all var(--transition-slow);
        }
        
        .image-animated:hover img {
            transform: scale(1.1);
        }
        
        /* 文字交互动画 */
        .text-animated {
            transition: all var(--transition-normal);
            position: relative;
        }
        
        .text-animated::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width var(--transition-normal);
        }
        
        .text-animated:hover::after {
            width: 100%;
        }
        
        .text-animated:hover {
            color: var(--primary);
            transform: translateX(5px);
        }
        
        /* 图标交互动画 */
        .icon-animated {
            transition: all var(--transition-bounce);
            display: inline-block;
        }
        
        .icon-animated:hover {
            transform: rotate(15deg) scale(1.2);
            color: var(--primary);
        }
        
        .icon-animated.bounce:hover {
            animation: bounce 0.6s ease-in-out;
        }
        
        .icon-animated.pulse:hover {
            animation: pulse 1s ease-in-out;
        }
        
        .icon-animated.shake:hover {
            animation: shake 0.5s ease-in-out;
        }
        
        /* 输入框交互动画 */
        .input-animated {
            transition: all var(--transition-normal);
            position: relative;
        }
        
        .input-animated::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: all var(--transition-normal);
            transform: translateX(-50%);
        }
        
        .input-animated:focus::before {
            width: 100%;
        }
        
        .input-animated:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 158, 0.1);
            transform: translateY(-2px);
        }
        
        /* 加载状态动画 */
        .loading-state {
            position: relative;
            overflow: hidden;
        }
        
        .loading-state::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* 成功状态动画 */
        .success-state {
            animation: successPulse 0.6s ease-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* 错误状态动画 */
        .error-state {
            animation: errorShake 0.5s ease-in-out;
        }
        
        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .counter-number {
            font-size: 3rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        
        .counter-label {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .small {
            font-size: 0.8em;
            opacity: 0.8;
        }
        
        .timeline {
            position: relative;
            padding-left: 50px;
            margin: 3rem 0;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
            border-radius: 2px;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 2.5rem;
        }
        
        .timeline-date {
            position: absolute;
            left: -50px;
            width: 40px;
            text-align: right;
            color: var(--primary);
            font-weight: bold;
        }
        
        .timeline-content {
            background-color: var(--card);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .timeline-content:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        

        
        .timeline-content::before {
            content: '';
            position: absolute;
            left: -15px;
            top: 20px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: var(--primary);
            border: 3px solid var(--bg);
        }
        
        h2 {
            color: var(--primary);
            margin-top: 0;
            font-size: 1.5rem;
        }
        
        /* 时间轴标题样式 */
        .timeline-title {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ff6b9e, #6bd5ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1.2rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            letter-spacing: 0.5px;
        }
        
        /* 时间轴内容文字样式 */
        .timeline-text {
            font-size: 1.05rem;
            line-height: 1.8;
            color: #444;
            margin-bottom: 1rem;
            text-align: justify;
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
        }
        
        /* 时间轴引用样式 */
        .timeline-quote {
            font-style: italic;
            padding: 1.2rem;
            border-left: 4px solid #ff6b9e;
            background: linear-gradient(135deg, #fff6fa 0%, #f6fff9 100%);
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
            font-size: 1.1rem;
            line-height: 1.7;
            color: #555;
            box-shadow: 0 2px 8px rgba(255, 107, 158, 0.1);
        }
        
        /* 时间轴列表样式 */
        .timeline-list {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }
        
        .timeline-list li {
            margin-bottom: 0.8rem;
            color: #555;
            line-height: 1.6;
            position: relative;
            padding-left: 0.5rem;
        }
        
        .timeline-list li::before {
            content: '💖';
            position: absolute;
            left: -1.2rem;
            top: 0.1rem;
            font-size: 0.9rem;
        }
        
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 1rem;
        }
        
        .media-item {
            border-radius: 8px;
            overflow: hidden;
            height: 200px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
        }
        
        .media-item:hover {
            transform: scale(1.05);
        }
        
        /* 图片容器优化 */
        .media-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
        }
        
        /* 确保图片完整显示 */
        .media-item[style*="background-image"] {
            background-size: contain !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
        }
        
        /* 图片加载失败时的样式 */
        .media-item.img-loading-failed {
            background-color: #f8f9fa;
            border: 2px dashed #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 0.9rem;
            text-align: center;
            padding: 1rem;
        }
        
        .media-item.img-loading-failed::before {
            content: '🖼️';
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .quote {
            font-style: italic;
            padding: 1rem;
            border-left: 3px solid var(--primary);
            background-color: rgba(255, 107, 158, 0.1);
            margin: 1rem 0;
        }
        
        footer {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-size: 0.9rem;
        }
        
        /* 纪念日弹窗样式 */
        .anniversary-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s;
        }
        
        .anniversary-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            max-width: 500px;
            text-align: center;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* 实时时钟样式 */
        .real-time-clock {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-block;
            margin-top: 0.5rem;
        }
        
        /* 互动按钮 */
        .interactive-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            margin: 0.5rem;
            transition: transform 0.3s;
        }
        
        .interactive-btn:hover {
            transform: scale(1.05);
        }
        
        @media (max-width: 900px) {
            .container {
                padding: 1.2rem;
            }
        }
        @media (max-width: 768px) {
            .container { padding: 0.5rem; }
            .memory-counter {
                padding: 1.1rem 0.5rem;
                margin: 1.1rem 0;
            }
            .timeline { padding-left: 18px; }
            .timeline-date { left: -18px; width: 18px; font-size: 0.8rem; }
            h1 { font-size: 1.3rem; }
            .counter-number { font-size: 1.2rem; }
            .media-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }
            .media-item {
                height: 120px;
            }
            .anniversary-content {
                padding: 1.1rem 0.5rem;
                max-width: 98vw;
            }
            #quit-smoking-modal > div {
                padding: 1.1rem 0.5rem 1rem 0.5rem !important;
                max-width: 98vw !important;
            }
            #custom-dialog-box {
                padding: 1.1rem 0.5rem 1rem 0.5rem !important;
                max-width: 98vw !important;
            }
            .interactive-btn {
                font-size: 0.95rem;
                padding: 0.4rem 0.7rem;
            }
        }
        @media (max-width: 480px) {
            .container { padding: 0.2rem; }
            .memory-counter {
                padding: 0.7rem 0.2rem;
                margin: 0.7rem 0;
            }
            .media-grid {
                grid-template-columns: 1fr;
                gap: 4px;
            }
            .media-item {
                height: 80vw;
                min-height: 100px;
            }
            .anniversary-content, #quit-smoking-modal > div, #custom-dialog-box {
                padding: 0.7rem 0.2rem 0.7rem 0.2rem !important;
                max-width: 99vw !important;
            }
            .interactive-btn {
                font-size: 0.9rem;
                padding: 0.3rem 0.5rem;
            }
        }
        
        /* ===== 全面移动端优化 ===== */
        
        /* 游戏中心移动端优化 */
        @media (max-width: 768px) {
            /* 游戏按钮布局优化 */
            .game-center-buttons {
                flex-direction: column;
                gap: 1rem;
                align-items: center;
            }
            
            .game-btn {
                width: 100%;
                max-width: 300px;
                padding: 1.2rem 1rem;
                font-size: 1.1rem;
                margin: 0.5rem 0;
            }
            
            /* 游戏统计网格优化 */
            .game-stats {
                grid-template-columns: 1fr;
                gap: 1rem;
                margin-top: 1.5rem;
            }
            
            .stat-item {
                padding: 1.2rem;
                text-align: center;
            }
            
            /* 幸运签区域优化 */
            .lucky-note-section {
                padding: 1.5rem;
                margin: 1rem 0;
            }
            
            .lucky-note-content {
                font-size: 1rem;
                line-height: 1.6;
            }
        }
        
        /* 超小屏幕游戏中心优化 */
        @media (max-width: 480px) {
            .game-btn {
                padding: 1rem 0.8rem;
                font-size: 1rem;
                border-radius: 12px;
            }
            
            .game-stats {
                gap: 0.8rem;
            }
            
            .stat-item {
                padding: 1rem;
            }
            
            .lucky-note-section {
                padding: 1rem;
                margin: 0.8rem 0;
            }
        }
        
        /* 主要section移动端优化 */
        @media (max-width: 768px) {
            /* 通用section优化 */
            .section {
                margin: 1.5rem 0;
                padding: 1.5rem;
                border-radius: 16px;
            }
            
            .section h2 {
                font-size: 1.4rem;
                margin-bottom: 1rem;
            }
            
            .section p {
                font-size: 1rem;
                line-height: 1.6;
                margin-bottom: 1rem;
            }
            
            /* 按钮组优化 */
            .button-group {
                flex-direction: column;
                gap: 0.8rem;
                align-items: center;
            }
            
            .button-group button {
                width: 100%;
                max-width: 280px;
                padding: 1rem;
                font-size: 1rem;
            }
            
            /* 图片和媒体优化 */
            .media-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .media-item {
                height: 200px;
                border-radius: 12px;
            }
            
            /* 文字内容优化 */
            .text-content {
                font-size: 0.95rem;
                line-height: 1.7;
            }
            
            .quote-text {
                font-size: 1rem;
                padding: 1rem;
                border-radius: 12px;
            }
        }
        
        /* 超小屏幕主要section优化 */
        @media (max-width: 480px) {
            .section {
                margin: 1rem 0;
                padding: 1rem;
                border-radius: 12px;
            }
            
            .section h2 {
                font-size: 1.3rem;
                margin-bottom: 0.8rem;
            }
            
            .section p {
                font-size: 0.95rem;
                line-height: 1.6;
                margin-bottom: 0.8rem;
            }
            
            .button-group button {
                padding: 0.9rem;
                font-size: 0.95rem;
                border-radius: 10px;
            }
            
            .media-item {
                height: 180px;
                border-radius: 10px;
            }
            
            .text-content {
                font-size: 0.9rem;
                line-height: 1.6;
            }
            
            .quote-text {
                font-size: 0.95rem;
                padding: 0.8rem;
                border-radius: 10px;
            }
        }
        
        /* 触摸优化 */
        @media (max-width: 768px) {
            /* 增加触摸目标大小 */
            button, .clickable {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* 触摸反馈优化 */
            button:active, .clickable:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }
            
            /* 滚动优化 */
            .scrollable-content {
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
            
            /* 防止双击缩放 */
            * {
                touch-action: manipulation;
            }
        }
        
        /* 导航和头部优化 */
        @media (max-width: 768px) {
            .header-content {
                padding: 1rem;
                text-align: center;
            }
            
            .header-title {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .header-subtitle {
                font-size: 1rem;
                line-height: 1.4;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 0.8rem;
                margin-top: 1rem;
            }
            
            .nav-btn {
                width: 100%;
                max-width: 250px;
                padding: 1rem;
                font-size: 1rem;
            }
        }
        
        /* 表单和输入优化 */
        @media (max-width: 768px) {
            input, textarea, select {
                font-size: 16px; /* 防止iOS缩放 */
                padding: 0.8rem;
                border-radius: 8px;
            }
            
            .form-group {
                margin-bottom: 1.2rem;
            }
            
            .form-label {
                font-size: 1rem;
                margin-bottom: 0.5rem;
                display: block;
            }
            
            .form-button {
                width: 100%;
                padding: 1rem;
                font-size: 1rem;
                margin-top: 1rem;
            }
        }
        
        /* 模态框移动端优化 */
        @media (max-width: 768px) {
            .modal-content {
                width: 95vw;
                max-width: none;
                margin: 2.5vh auto;
                border-radius: 16px;
            }
            
            .modal-header {
                padding: 1.5rem 1.5rem 1rem 1.5rem;
            }
            
            .modal-body {
                padding: 1rem 1.5rem;
            }
            
            .modal-footer {
                padding: 1rem 1.5rem 1.5rem 1.5rem;
            }
            
            .modal-title {
                font-size: 1.3rem;
            }
            
            .modal-close {
                top: 1rem;
                right: 1.5rem;
                font-size: 1.5rem;
            }
        }
        
        /* 超小屏幕模态框优化 */
        @media (max-width: 480px) {
            .modal-content {
                width: 98vw;
                margin: 1vh auto;
                border-radius: 12px;
            }
            
            .modal-header {
                padding: 1.2rem 1.2rem 0.8rem 1.2rem;
            }
            
            .modal-body {
                padding: 0.8rem 1.2rem;
            }
            
            .modal-footer {
                padding: 0.8rem 1.2rem 1.2rem 1.2rem;
            }
            
            .modal-title {
                font-size: 1.2rem;
            }
        }
        
        /* ===== 额外移动端优化 ===== */
        
        /* 触摸手势优化 */
        @media (max-width: 768px) {
            /* 滑动优化 */
            .timeline-item {
                touch-action: pan-y;
            }
            
            /* 图片触摸优化 */
            .media-item {
                touch-action: manipulation;
            }
            
            /* 按钮触摸优化 */
            button {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* 滚动条优化 */
            ::-webkit-scrollbar {
                width: 6px;
            }
            
            ::-webkit-scrollbar-track {
                background: rgba(255, 107, 158, 0.1);
                border-radius: 3px;
            }
            
            ::-webkit-scrollbar-thumb {
                background: rgba(255, 107, 158, 0.3);
                border-radius: 3px;
            }
            
            ::-webkit-scrollbar-thumb:hover {
                background: rgba(255, 107, 158, 0.5);
            }
        }
        
        /* 性能优化 */
        @media (max-width: 768px) {
            /* 减少动画复杂度 */
            .scroll-animate {
                animation-duration: 0.6s;
            }
            
            /* 优化阴影效果 */
            .timeline-item {
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            }
            
            /* 减少渐变复杂度 */
            .btn-animated {
                background: linear-gradient(135deg, #ff6b9e, #ff8fab);
            }
            
            .btn-animated:hover {
                background: linear-gradient(135deg, #ff8fab, #ff6b9e);
            }
        }
        
        /* 可访问性优化 */
        @media (max-width: 768px) {
            /* 增加焦点指示器 */
            button:focus,
            .clickable:focus {
                outline: 2px solid #ff6b9e;
                outline-offset: 2px;
            }
            
            /* 提高对比度 */
            .timeline-text {
                color: #2c3e50;
            }
            
            .timeline-title {
                color: #ff6b9e;
                text-shadow: 0 1px 2px rgba(255, 107, 158, 0.2);
            }
        }
        
        /* 横屏优化 */
        @media (max-width: 768px) and (orientation: landscape) {
            .section {
                margin: 1rem 0;
                padding: 1rem;
            }
            
            .game-center-buttons {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.8rem;
            }
            
            .game-btn {
                width: auto;
                min-width: 200px;
                flex: 1;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div id="privacy-mask-root">
    <!-- 通用自定义弹窗组件（alert/prompt/confirm） -->
    <div id="custom-dialog-mask" style="display:none;position:fixed;z-index:200000;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);justify-content:center;align-items:center;"></div>
    <div id="custom-dialog" style="display:none;position:fixed;z-index:200001;top:0;left:0;width:100vw;height:100vh;justify-content:center;align-items:center;">
      <div id="custom-dialog-box" style="background:#fff;padding:1.5rem 1.2rem 1.2rem 1.2rem;border-radius:16px;max-width:340px;width:90vw;box-shadow:0 8px 32px #0005;position:relative;text-align:center;">
        <!-- 关闭按钮 -->
        <button id="custom-dialog-close" onclick="closeCustomDialog()" class="dialog-close-btn">×</button>
        <div id="custom-dialog-title" style="font-size:1.15rem;color:#ff6b9e;margin-bottom:0.7rem;"></div>
        <div id="custom-dialog-content" style="color:#333;font-size:1.05rem;margin-bottom:1rem;word-break:break-all;"></div>
        <input id="custom-dialog-input" style="display:none;width:90%;margin-bottom:1rem;padding:0.5rem;border-radius:8px;border:1px solid #eee;font-size:1rem;" />
        <div style="margin-top:0.5rem;">
          <button id="custom-dialog-ok" class="interactive-btn" style="min-width:60px;margin:0 0.5rem;">确定</button>
          <button id="custom-dialog-cancel" class="interactive-btn" style="background:#fff6fa;color:#ff6b9e;border:1px solid #ffb6d5;min-width:60px;margin:0 0.5rem;display:none;">取消</button>
        </div>
      </div>
    </div>
    <div id="quit-smoking-modal" style="display:none;position:fixed;z-index:100000;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);justify-content:center;align-items:center;">
        <div style="background:#fff;padding:2rem 1.5rem 1.2rem 1.5rem;border-radius:18px;max-width:370px;width:92vw;box-shadow:0 8px 32px #0005;position:relative;text-align:center;">
            <button onclick="closeQuitSmokingModal()" style="position:absolute;top:10px;right:16px;font-size:1.5rem;background:none;border:none;color:#888;cursor:pointer;">×</button>
            <h2 style="color:#ff6b9e;margin-bottom:0.7rem;">戒烟打卡</h2>
            <div id="qs-days" style="font-size:1.7rem;font-weight:bold;margin-bottom:0.2rem;"></div>
            <div id="qs-streaks" style="color:#6bd5ff;font-size:1.05rem;margin-bottom:0.2rem;"></div>
            <div id="qs-last-date" style="color:#888;font-size:0.95rem;margin-bottom:0.7rem;"></div>
            <button id="qs-punch-btn" class="interactive-btn" style="margin-bottom:0.7rem;">今日打卡</button>
            <button id="qs-reset-btn" class="interactive-btn" style="background:#fff6fa;color:#ff6b9e;border:1px solid #ffb6d5;margin-left:0.5rem;margin-bottom:0.7rem;">重置打卡</button>
            <div id="qs-msg" style="margin-top:0.3rem;color:#6bd5ff;font-size:1.1rem;"></div>
            <div id="qs-history" style="margin-top:0.7rem;text-align:left;font-size:0.98rem;background:#f6faff;border-radius:10px;padding:0.7rem 0.7rem 0.5rem 0.7rem;max-height:120px;overflow-y:auto;"></div>
        </div>
    </div>
    <header>
        <div class="hearts" id="hearts-container"></div>
        <!-- 主标题，连续点击5次可进入戒烟打卡页面（隐藏入口） -->
        <h1 id="main-title">我们的云端恋爱日记</h1>
        <div class="subtitle">xxx ❤️xxx | 开始于 <span id="start-date">2025年8月2日</span></div>
        <div class="real-time-clock" id="current-time">正在加载时间...</div>
    </header>

    <canvas id="bg-bubbles-canvas" style="position:fixed;z-index:0;top:0;left:0;width:100vw;height:100vh;pointer-events:none;"></canvas>
    <canvas id="bg-bubbles-canvas" style="position:fixed;z-index:0;top:0;left:0;width:100vw;height:100vh;pointer-events:none;"></canvas>
    
    <!-- 页面加载器 -->
    <div class="page-loader" id="pageLoader">
        <div class="loader-content">
            <div class="loader-spinner"></div>
            <div class="loader-text">我们的云端恋爱日记</div>
            <div class="loader-subtitle">正在加载美好回忆...</div>
            <div class="loader-progress">
                <div class="loader-progress-bar" id="loaderProgress"></div>
            </div>

        </div>
    </div>
    
    <!-- 滚动进度指示器 -->
    <div class="scroll-progress">
        <div class="scroll-progress-bar" id="scrollProgress"></div>
    </div>
    
    <div class="container page-content">
        <!-- 恋爱动态区块 -->
        <div class="memory-counter card-animated" style="background: #f6fff9; color: #6bd5ff; margin-bottom:2rem;">
            <h2 style="color:#6bd5ff;">恋爱动态</h2>
            
            <!-- 添加恋爱动态按钮 -->
            <div style="text-align: center; margin: 1rem 0;">
                <button onclick="showLoveFeedForm()" style="
                    background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    padding: 0.8rem 1.5rem;
                    margin: 0 0.5rem;
                    cursor: pointer;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    💕 添加恋爱动态
                </button>
            </div>
            
            <!-- 添加恋爱动态表单 -->
                <div id="love-feed-form" style="
                    background: linear-gradient(135deg, #fff6fa, #ffeef8);
                    border: 2px solid #ff6b9e;
                    border-radius: 15px;
                    padding: 1.5rem;
                    margin: 1rem 0;
                    box-shadow: 0 8px 25px rgba(255, 107, 158, 0.15);
                    position: relative;
                    opacity: 0;
                    transform: translateY(-20px);
                    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                    max-height: 0;
                    overflow: hidden;
                    pointer-events: none;
                ">
                <!-- 关闭按钮 -->
                <button onclick="closeLoveFeedForm()" style="
                    position: absolute;
                    top: 15px;
                    right: 20px;
                    background: none;
                    border: none;
                    font-size: 1.5rem;
                    color: #ff6b9e;
                    cursor: pointer;
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.3s ease;
                " onmouseover="this.style.background='rgba(255, 107, 158, 0.1)';this.style.color='#ff8fab'" onmouseout="this.style.background='none';this.style.color='#ff6b9e'">
                    ×
                </button>
                <div style="font-size: 1.3rem; color: #ff6b9e; margin-bottom: 1rem; text-align: center;">💕 添加恋爱动态 💕</div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: #666;">动态内容：</label>
                    <textarea id="feed-content" placeholder="写下今天的美好瞬间..." style="
                        width: 100%;
                        padding: 0.8rem;
                        border: 2px solid #ff6b9e;
                        border-radius: 8px;
                        font-size: 1rem;
                        outline: none;
                        min-height: 80px;
                        resize: vertical;
                    " onfocus="this.style.borderColor='#ff8fab'" onblur="this.style.borderColor='#ff6b9e'"></textarea>
                </div>
                
                <!-- 多张图片上传区域 -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: #666;">添加图片（最多9张）：</label>
                    <div id="image-upload-area" style="
                        border: 2px dashed #ff6b9e;
                        border-radius: 8px;
                        padding: 1rem;
                        text-align: center;
                        background: rgba(255, 107, 158, 0.05);
                        margin-bottom: 0.5rem;
                    ">
                        <div style="color: #ff6b9e; margin-bottom: 0.5rem;">📱 点击上传图片</div>
                        <input type="file" id="image-upload" multiple accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                        <button type="button" onclick="document.getElementById('image-upload').click()" style="
                            background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                            color: white;
                            border: none;
                            padding: 0.6rem 1.2rem;
                            border-radius: 20px;
                            cursor: pointer;
                            font-size: 0.9rem;
                        ">选择图片</button>
                        <div style="font-size: 0.8rem; color: #999; margin-top: 0.5rem;">支持 JPG、PNG、GIF 格式</div>
                    </div>
                    
                    <!-- 图片预览区域 -->
                    <div id="image-preview" style="display: none; margin-top: 1rem;">
                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">已选择 <span id="image-count">0</span> 张图片：</div>
                        <div id="image-preview-list" style="
                            display: grid;
                            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                            gap: 0.5rem;
                            margin-bottom: 1rem;
                        "></div>
                        <button type="button" onclick="clearAllImages()" style="
                            background: #f8f9fa;
                            color: #666;
                            border: 1px solid #e9ecef;
                            padding: 0.5rem 1rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-size: 0.8rem;
                        ">清空所有图片</button>
                    </div>
                </div>
                
                <!-- 兼容旧版本的媒体输入 -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: #666;">动态类型：</label>
                    <select id="feed-type" onchange="toggleMediaInput()" style="
                        width: 100%;
                        padding: 0.8rem;
                        border: 2px solid #ff6b9e;
                        border-radius: 8px;
                        font-size: 1rem;
                        outline: none;
                    " onfocus="this.style.borderColor='#ff8fab'" onblur="this.style.borderColor='#ff6b9e'">
                        <option value="text">文字动态</option>
                        <option value="image">单张图片链接</option>
                        <option value="video">视频链接</option>
                    </select>
                </div>
                <div id="media-input" style="margin-bottom: 1rem; display: none;">
                    <label style="display: block; margin-bottom: 0.5rem; color: #666;">媒体链接：</label>
                    <input type="url" id="feed-media-url" placeholder="请输入图片或视频链接..." style="
                        width: 100%;
                        padding: 0.8rem;
                        border: 2px solid #ff6b9e;
                        border-radius: 8px;
                        font-size: 1rem;
                        outline: none;
                    " onfocus="this.style.borderColor='#ff8fab'" onblur="this.style.borderColor='#ff6b9e'">
                </div>
                <div style="text-align: center;">
                    <button onclick="submitLoveFeed()" style="
                        background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        padding: 0.8rem 2rem;
                        margin: 0 0.5rem;
                        cursor: pointer;
                        font-size: 1rem;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        💕 发布动态
                    </button>
                    <button onclick="clearLoveFeedForm()" style="
                        background: linear-gradient(135deg, #6bd5ff, #4db6ac);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        padding: 0.8rem 2rem;
                        margin: 0 0.5rem;
                        cursor: pointer;
                        font-size: 1rem;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        🔄 清空表单
                    </button>
                </div>
            </div>
            
                            <!-- 动态列表 -->
                <div id="love-feed-list" style="min-height:120px;font-size:1.08rem;line-height:1.7;transition:all 0.3s ease;"></div>
                <div id="love-feed-loading" style="color:#bbb;font-size:0.95rem;margin:1rem 0;">动态加载中...</div>
            
            <!-- 操作按钮 -->
            <div style="margin-top: 2rem;">
                <!-- 基础功能按钮 -->
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <button onclick="refreshLoveFeed()" style="
                        background: linear-gradient(135deg, #6bd5ff, #4db6ac);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        padding: 1rem 2rem;
                        margin: 0 0.5rem;
                        cursor: pointer;
                        font-size: 1.1rem;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(107, 213, 255, 0.3);
                    " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(107, 213, 255, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(107, 213, 255, 0.3)'">
                        🔄 刷新动态
                    </button>
                    
                    <!-- 开发者模式按钮（始终显示） -->
                    <button onclick="togglePermissionMode()" id="permission-mode-btn" style="
                        background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        padding: 1rem 2rem;
                        margin: 0 0.5rem;
                        cursor: pointer;
                        font-size: 1.1rem;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(255, 107, 158, 0.3);
                    " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(255, 107, 158, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(255, 107, 158, 0.3)'">
                        🔐 启用高级权限
                    </button>
                </div>
                
                <!-- 权限控制面板 -->
                <div id="permission-panel" style="
                    display: none;
                    background: rgba(255, 255, 255, 0.15);
                    border-radius: 20px;
                    padding: 2rem;
                    margin: 1rem auto;
                    max-width: 800px;
                    backdrop-filter: blur(15px);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                ">
                    <h3 style="text-align: center; margin-bottom: 1.5rem; color: #ff6b9e; font-size: 1.3rem;">🔐 权限控制面板</h3>
                    
                    <!-- 当前权限状态 -->
                    <div id="current-permission-status" style="
                        text-align: center;
                        margin-bottom: 2rem;
                        padding: 1.5rem;
                        background: rgba(255, 107, 158, 0.1);
                        border-radius: 15px;
                        border: 1px solid rgba(255, 107, 158, 0.2);
                    ">
                        <div style="font-size: 1.2rem; color: #ff6b9e; margin-bottom: 0.8rem; font-weight: 600;">
                            👤 当前权限：<span id="permission-level">访客</span>
                        </div>
                        <div style="font-size: 1rem; color: #666; line-height: 1.5;">
                            <span id="permission-desc">只能查看内容，无法添加或删除动态</span>
                        </div>
                    </div>
                    
                    <!-- 人脸识别登录 -->
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <button onclick="startFaceLogin()" id="face-login-btn" style="
                            background: linear-gradient(135deg, #a55eea, #c44569);
                            color: white;
                            border: none;
                            border-radius: 15px;
                            padding: 1.2rem 2.5rem;
                            cursor: pointer;
                            font-size: 1.2rem;
                            font-weight: 600;
                            transition: all 0.3s ease;
                            box-shadow: 0 6px 20px rgba(165, 94, 234, 0.4);
                            min-width: 250px;
                        " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(165, 94, 234, 0.5)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 6px 20px rgba(165, 94, 234, 0.4)'">
                            📷 人脸识别登录
                        </button>
                    </div>
                    
                    <!-- 人脸注册管理区域 -->
                    <div style="
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 15px;
                        padding: 1.5rem;
                        margin-bottom: 2rem;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    ">
                        <h4 style="text-align: center; margin-bottom: 1.5rem; color: #ff6b9e; font-size: 1.1rem;">👥 人脸注册管理</h4>
                        
                        <!-- 人脸注册按钮 -->
                        <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1.5rem; flex-wrap: wrap;">
                            <button onclick="startFaceRegistration('user')" style="
                                background: linear-gradient(135deg, #28a745, #20c997);
                                color: white;
                                border: none;
                                border-radius: 12px;
                                padding: 1rem 1.5rem;
                                cursor: pointer;
                                font-size: 1rem;
                                font-weight: 600;
                                transition: all 0.3s ease;
                                box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
                                min-width: 180px;
                            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                👤 注册我的人脸
                            </button>
                            
                            <button onclick="startFaceRegistration('partner')" style="
                                background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                                color: white;
                                border: none;
                                border-radius: 12px;
                                padding: 1rem 1.5rem;
                                cursor: pointer;
                                font-size: 1rem;
                                font-weight: 600;
                                transition: all 0.3s ease;
                                box-shadow: 0 4px 15px rgba(255, 107, 158, 0.3);
                                min-width: 180px;
                            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                👩 注册女朋友的人脸
                            </button>
                        </div>
                        
                        <!-- 人脸管理按钮 -->
                    <div style="text-align: center;">
                            <button onclick="manageRegisteredFaces()" style="
                                background: linear-gradient(135deg, #6c5ce7, #a29bfe);
                                color: white;
                                border: none;
                                border-radius: 10px;
                                padding: 0.8rem 1.5rem;
                                cursor: pointer;
                                font-size: 0.9rem;
                                font-weight: 600;
                                transition: all 0.3s ease;
                                box-shadow: 0 3px 12px rgba(108, 92, 231, 0.3);
                                min-width: 150px;
                            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                🛠️ 人脸管理
                            </button>
                        </div>
                    </div>
                    
                    <!-- 关闭高级功能 -->
                    <div style="text-align: center; margin-top: 1.5rem;">
                        <button onclick="closeAdvancedFeatures()" id="close-permission-btn" style="
                            background: linear-gradient(135deg, #ff4757, #ff6b9e);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 1rem 2rem;
                            cursor: pointer;
                            font-size: 1.1rem;
                            font-weight: 600;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
                            min-width: 200px;
                            width: 100%;
                            max-width: 250px;
                        " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(255, 71, 87, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(255, 71, 87, 0.3)'">
                            🔒 关闭高级功能
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 照片上传模态框 -->
        <div id="photo-upload-modal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none;
            z-index: 10000;
            animation: modalFadeIn 0.3s ease-out;
        ">
            <div style="
                position: absolute;
                top: 30%;
                left: 33%;
                transform: translate(-50%, -50%);
                width: 75%;
                max-width: 340px;
                background: white;
                border-radius: 22px;
                padding: 32px;
                text-align: center;
                box-shadow: 0 35px 90px rgba(0, 0, 0, 0.18), 0 0 0 1px rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
            ">


                
                <h3 style="color: #ff6b9e; margin-bottom: 1.5rem; font-size: 1.3rem;">📷 添加甜蜜照片</h3>
                
                <!-- 文件上传区域 -->
                <div style="
                    border: 3px dashed #ff6b9e;
                    border-radius: 15px;
                    padding: 1.5rem;
                    margin-bottom: 1.5rem;
                    background: rgba(255, 107, 158, 0.05);
                    transition: all 0.3s ease;
                    cursor: pointer;
                " id="upload-area" onclick="document.getElementById('photo-file-input').click()" onmouseover="this.style.borderColor='#ff8fab'; this.style.background='rgba(255, 107, 158, 0.1)'" onmouseout="this.style.borderColor='#ff6b9e'; this.style.background='rgba(255, 107, 158, 0.05)'">
                    <div style="font-size: 2.5rem; margin-bottom: 0.8rem;">📁</div>
                    <div style="color: #ff6b9e; margin-bottom: 0.8rem; font-size: 1rem; font-weight: 600;">点击选择照片</div>
                    <div style="color: #666; font-size: 0.9rem;">支持 JPG、PNG、GIF 格式，最大 10MB</div>
                    <input type="file" id="photo-file-input" accept="image/*" style="display: none;" onchange="handlePhotoFileSelect(event)">
                </div>
                
                <!-- 照片预览 -->
                <div id="photo-preview" style="display: none; margin-bottom: 1.5rem;">
                    <div style="
                        width: 150px;
                        height: 150px;
                        margin: 0 auto;
                        border-radius: 15px;
                        overflow: hidden;
                        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
                    ">
                        <img id="preview-image" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                </div>
                
                <!-- 照片信息输入 -->
                <div id="photo-info-form" style="display: none; margin-bottom: 1.5rem;">
                    <div style="margin-bottom: 1rem;">
                        <input type="text" id="photo-description" placeholder="照片描述..." style="
                            width: 100%;
                            padding: 0.8rem;
                            border: 2px solid #e0e6ff;
                            border-radius: 10px;
                            font-size: 1rem;
                            outline: none;
                            transition: border-color 0.3s ease;
                            box-sizing: border-box;
                        " onfocus="this.style.borderColor='#ff6b9e'" onblur="this.style.borderColor='#e0e6ff'">
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <input type="date" id="photo-date" style="
                            width: 100%;
                            padding: 0.8rem;
                            border: 2px solid #e0e6ff;
                            border-radius: 10px;
                            font-size: 1rem;
                            outline: none;
                            transition: border-color 0.3s ease;
                            box-sizing: border-box;
                        " onfocus="this.style.borderColor='#ff6b9e'" onblur="this.style.borderColor='#e0e6ff'">
                    </div>
                </div>
                
                <!-- 操作按钮 -->
                <div style="display: flex; gap: 0.8rem; justify-content: center; flex-wrap: wrap; margin-bottom: 1rem;">
                    <button onclick="uploadPhoto()" id="upload-btn" style="
                        background: linear-gradient(135deg, #28a745, #20c997);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        padding: 0.8rem 1.5rem;
                        cursor: pointer;
                        font-size: 1rem;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        display: none;
                        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
                        flex: 1;
                        min-width: 120px;
                    " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                        ✅ 上传照片
                    </button>
                </div>
                
                <!-- 关闭按钮 -->
                <div style="text-align: center;">
                    <button onclick="closePhotoUploadModal()" style="
                        background: linear-gradient(135deg, #ff4757, #ff6b9e);
                        color: white;
                        border: none;
                        border-radius: 10px;
                        padding: 0.6rem 1.2rem;
                        cursor: pointer;
                        font-size: 0.9rem;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        box-shadow: 0 2px 8px rgba(255, 71, 87, 0.3);
                        min-width: 100px;
                    " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                        ❌ 关闭
                    </button>
                </div>
                

            </div>
        </div>
        
        <!-- 照片管理模态框 -->
        <div id="photo-management-modal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none;
            z-index: 10000;
            animation: modalFadeIn 0.3s ease-out;
        ">
            <div style="
                position: absolute;
                top: 30%;
                left: 20%;
                transform: translate(-50%, -50%);
                width: 90%;
                max-width: 650px;
                background: white;
                border-radius: 22px;
                padding: 32px;
                text-align: center;
                box-shadow: 0 35px 90px rgba(0, 0, 0, 0.18), 0 0 0 1px rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
            ">


                
                <h3 style="color: #ff6b9e; margin-bottom: 1.5rem; font-size: 1.3rem;">⚙️ 相册管理</h3>
                
                <!-- 照片列表 -->
                <div id="photo-management-list" style="
                    display: flex;
                    flex-wrap: wrap;
                    gap: 15px;
                    justify-content: center;
                    margin-bottom: 1.5rem;
                    max-height: 350px;
                    overflow-y: auto;
                ">
                    <!-- 照片项目将通过JavaScript动态生成 -->
                </div>
                
                <!-- 图片预览模态框 -->
                <div id="image-preview-modal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(255, 255, 255, 0.3);
                    backdrop-filter: blur(12px);
                    -webkit-backdrop-filter: blur(12px);
                    display: none;
                    z-index: 10001;
                    align-items: center;
                    justify-content: center;
                    animation: modalFadeIn 0.3s ease-out;
                ">
                    <div style="
                        background: white;
                        border-radius: 15px;
                        padding: 20px;
                        max-width: 90%;
                        max-height: 90%;
                        text-align: center;
                        position: relative;
                        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.1);
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    ">
                        <button onclick="closeImagePreview()" style="
                            position: absolute;
                            top: -10px;
                            right: -10px;
                            background: #e74c3c;
                            color: white;
                            border: none;
                            border-radius: 50%;
                            width: 30px;
                            height: 30px;
                            cursor: pointer;
                            font-size: 16px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        ">×</button>
                        <img id="preview-image" src="" alt="图片预览" style="
                            max-width: 100%;
                            max-height: 70vh;
                            border-radius: 10px;
                            margin-bottom: 15px;
                        ">
                        <div id="preview-info" style="
                            color: #666;
                            font-size: 14px;
                            margin-bottom: 15px;
                        "></div>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button onclick="confirmDeleteImage()" style="
                                background: #e74c3c;
                                color: white;
                                border: none;
                                border-radius: 8px;
                                padding: 10px 20px;
                                cursor: pointer;
                                font-size: 14px;
                            ">🗑️ 确认删除</button>
                            <button onclick="closeImagePreview()" style="
                                background: #95a5a6;
                                color: white;
                                border: none;
                                border-radius: 8px;
                                padding: 10px 20px;
                                cursor: pointer;
                                font-size: 14px;
                            ">❌ 取消</button>
                        </div>
                    </div>
                </div>
                
                <!-- 操作按钮 -->
                <div style="display: flex; gap: 0.8rem; justify-content: center; margin-bottom: 1rem;">
                    <button onclick="closePhotoManagementModal()" style="
                        background: linear-gradient(135deg, #6c5ce7, #a29bfe);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        padding: 0.8rem 1.5rem;
                        cursor: pointer;
                        font-size: 1rem;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
                        min-width: 120px;
                    " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                        🔒 关闭管理
                    </button>
                </div>
                

            </div>
        </div>
        
        <div class="memory-counter">
            <div class="counter-label">我们已经相爱</div>
            <div class="counter-number" id="days-together">0天</div>
            <div class="counter-label" id="next-anniversary">距离100天纪念日还有83天</div>

            <button class="interactive-btn" style="background:#fff6fa;color:#ff6b9e;border:1px solid #ffb6d5;" onclick="showLuckyNote()">抽一支幸运签</button>
            <button class="interactive-btn" style="background:#f6fff9;color:#6bd5ff;border:1px solid #b6eaff;" onclick="showLoveQuiz()">情侣默契问答</button>
        </div>

                    <!-- 甜蜜相册互动区块 -->
            <div class="memory-counter" id="sweet-photo-section" style="background: #fff6fa; color: #ff6b9e; margin-bottom:2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <div>
                        <h2 style="color:#ff6b9e; margin: 0; margin-bottom: 0.3rem;">甜蜜相册</h2>
                        <div id="photo-management-hint" style="display: none; font-size: 0.85rem; color: #999; font-style: italic;">
                            💡 高级权限用户可以使用右侧按钮管理相册
                        </div>
                    </div>
                    
                    <!-- 高级用户照片管理按钮 -->
                    <div id="photo-management-buttons" style="display: none;">
                        <button onclick="showPhotoUploadModal()" style="
                            background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 0.7rem 1.2rem;
                            cursor: pointer;
                            font-size: 0.9rem;
                            margin-right: 0.8rem;
                            transition: all 0.3s ease;
                            box-shadow: 0 3px 12px rgba(255, 107, 158, 0.3);
                            font-weight: 600;
                            min-width: 100px;
                        " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 16px rgba(255, 107, 158, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 3px 12px rgba(255, 107, 158, 0.3)'">
                            📷 添加照片
                        </button>
                        <button onclick="showPhotoManagementModal()" style="
                            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 0.7rem 1.2rem;
                            cursor: pointer;
                            font-size: 0.9rem;
                            transition: all 0.3s ease;
                            box-shadow: 0 3px 12px rgba(108, 92, 231, 0.3);
                            font-weight: 600;
                            min-width: 100px;
                        " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 16px rgba(108, 92, 231, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 3px 12px rgba(108, 92, 231, 0.3)'">
                            ⚙️ 管理相册
                        </button>
                    </div>
                </div>
                
                <!-- 相册顺序如需调整请同步修改order属性和注释 -->
                <div class="media-grid" id="sweet-photo-grid" style="grid-auto-flow: row;">
                <!-- 1. 第一张照片：微信图片_2025-08-07_084038_490.jpg -->
                <div class="media-item clickable-image" data-img="微信图片_2025-08-07_084038_490.jpg" data-photo-id="photo_1" style="background-image: url('微信图片_2025-08-07_084038_490.jpg'); position:relative; order:1;" onclick="showImageModal('微信图片_2025-08-07_084038_490.jpg')">
                    <div class="img-blur-mask"></div>
                    <div class="image-overlay">
                        <span class="zoom-icon">🔍</span>
                        <span class="zoom-text">点击放大</span>
                    </div>
                    <!-- 高级用户删除按钮 -->
                    <button class="photo-delete-btn" onclick="deletePhoto('photo_1', '微信图片_2025-08-07_084038_490.jpg')" style="
                        position: absolute;
                        top: 8px;
                        right: 8px;
                        background: rgba(255, 71, 87, 0.9);
                        color: white;
                        border: none;
                        border-radius: 50%;
                        width: 24px;
                        height: 24px;
                        cursor: pointer;
                        font-size: 12px;
                        line-height: 1;
                        opacity: 0;
                        transition: all 0.3s ease;
                        z-index: 10;
                    " onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">×</button>
                </div>
                <!-- 2. 第二张照片：微信图片_2025-08-08_094627_680.jpg -->
                <div class="media-item clickable-image" data-img="微信图片_2025-08-08_094627_680.jpg" data-photo-id="photo_2" style="background-image: url('微信图片_2025-08-08_094627_680.jpg'); position:relative; order:2;" onclick="showImageModal('微信图片_2025-08-08_094627_680.jpg')">
                    <div class="img-blur-mask"></div>
                    <div class="image-overlay">
                        <span class="zoom-icon">🔍</span>
                        <span class="zoom-text">点击放大</span>
                    </div>
                    <!-- 高级用户删除按钮 -->
                    <button class="photo-delete-btn" onclick="deletePhoto('photo_2', '微信图片_2025-08-08_094627_680.jpg')" style="
                        position: absolute;
                        top: 8px;
                        right: 8px;
                        background: rgba(255, 71, 87, 0.9);
                        color: white;
                        border: none;
                        border-radius: 50%;
                        width: 24px;
                        height: 24px;
                        cursor: pointer;
                        font-size: 12px;
                        line-height: 1;
                        opacity: 0;
                        transition: all 0.3s ease;
                        z-index: 10;
                    " onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">×</button>
                </div>
                <!-- 3. 第三张照片：微信图片_2025-08-07_084553_312.png -->
                <div class="media-item clickable-image" data-img="微信图片_2025-08-07_084553_312.png" data-photo-id="photo_3" style="background-image: url('微信图片_2025-08-07_084553_312.png'); position:relative; order:3;" onclick="showImageModal('微信图片_2025-08-07_084553_312.png')">
                    <div class="img-blur-mask"></div>
                    <div class="image-overlay">
                        <span class="zoom-icon">🔍</span>
                        <span class="zoom-text">点击放大</span>
                    </div>
                    <!-- 高级用户删除按钮 -->
                    <button class="photo-delete-btn" onclick="deletePhoto('photo_3', '微信图片_2025-08-07_084553_312.png')" style="
                        position: absolute;
                        top: 8px;
                        right: 8px;
                        background: rgba(255, 71, 87, 0.9);
                        color: white;
                        border: none;
                        border-radius: 50%;
                        width: 24px;
                        height: 24px;
                        cursor: pointer;
                        font-size: 12px;
                        line-height: 1;
                        opacity: 0;
                        transition: all 0.3s ease;
                        z-index: 10;
                    " onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">×</button>
                </div>
                <!-- 4. 第四张照片：微信图片_2025-08-07_084800_991.png -->
                <div class="media-item clickable-image" data-img="微信图片_2025-08-07_084800_991.png" data-photo-id="photo_4" style="background-image: url('微信图片_2025-08-07_084800_991.png'); position:relative; order:4;" onclick="showImageModal('微信图片_2025-08-07_084800_991.png')">
                    <div class="img-blur-mask"></div>
                    <div class="image-overlay">
                        <span class="zoom-icon">🔍</span>
                        <span class="zoom-text">点击放大</span>
                    </div>
                    <!-- 高级用户删除按钮 -->
                    <button class="photo-delete-btn" onclick="deletePhoto('photo_4', '微信图片_2025-08-07_084800_991.png')" style="
                        position: absolute;
                        top: 8px;
                        right: 8px;
                        background: rgba(255, 71, 87, 0.9);
                        color: white;
                        border: none;
                        border-radius: 50%;
                        width: 24px;
                        height: 24px;
                        cursor: pointer;
                        font-size: 12px;
                        line-height: 1;
                        opacity: 0;
                        transition: all 0.3s ease;
                        z-index: 10;
                    " onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">×</button>
                </div>
            <!-- 如需调整顺序请同步修改order属性和注释 -->
            </div>

        </div>

        <!-- 每日一句互动祝福区块 -->
        <div class="memory-counter" style="background: #f6fff9; color: #6bd5ff; margin-bottom:2rem;">
            <h2 style="color:#6bd5ff;">每日一句</h2>
            <div id="daily-quote" style="font-size:1.2rem; margin:1rem 0;">加载中...</div>
            <button class="interactive-btn" onclick="showRandomQuote()">换一句</button>
        </div>
    <!-- 图片大图弹窗 -->
    <div id="image-modal" style="display:none;position:fixed;z-index:99999;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;">
        <img id="modal-img" src="" style="max-width:90vw;max-height:80vh;border-radius:12px;box-shadow:0 8px 32px #0008;">
        <button onclick="closeImageModal()" style="position:absolute;top:30px;right:40px;font-size:2rem;background:none;border:none;color:#fff;cursor:pointer;">×</button>
    </div>
    <!-- 腾讯云云开发相关脚本 -->
    <script src="cloudbase-config.js"></script>
    <script src="cloudbase-sdk-fixed.js"></script>
    <script src="cloudbase-core-fixed.js"></script>
    
    <!-- 腾讯云AI人脸识别服务 - 增强版 -->
    <script src="tencent-ai-config.js"></script>
    <script src="tencent-ai-service-enhanced.js"></script>
    
    <script>
    // 页面缓冲管理器 - 防止页面闪动
    (function(){
        // 创建页面缓冲元素
        function createPageBuffer() {
            const buffer = document.createElement('div');
            buffer.className = 'page-buffer';
            buffer.innerHTML = `
                <div style="text-align: center; padding: 2rem; color: #999;">
                    <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">🔄 正在加载...</div>
                    <div style="font-size: 0.9rem;">保持页面稳定</div>
                </div>
            `;
            return buffer;
        }
        
        // 在指定元素前插入缓冲
        window.insertPageBuffer = function(beforeElement, minHeight = 100) {
            const buffer = createPageBuffer();
            buffer.style.minHeight = minHeight + 'px';
            
            if (beforeElement && beforeElement.parentNode) {
                beforeElement.parentNode.insertBefore(buffer, beforeElement);
                
                // 缓冲出现动画
                setTimeout(() => {
                    buffer.classList.add('show');
                }, 50);
                
                return buffer;
            }
            return null;
        };
        
        // 移除缓冲元素
        window.removePageBuffer = function(buffer) {
            if (buffer && buffer.parentNode) {
                buffer.classList.remove('show');
                setTimeout(() => {
                    if (buffer.parentNode) {
                        buffer.parentNode.removeChild(buffer);
                    }
                }, 300);
            }
        };
        
        console.log('✅ 页面缓冲管理器已加载');
    })();
    
    // 自定义弹窗组件（alert/prompt/confirm）
    (function(){
      const mask = document.getElementById('custom-dialog-mask');
      const dialog = document.getElementById('custom-dialog');
      const box = document.getElementById('custom-dialog-box');
      const title = document.getElementById('custom-dialog-title');
      const content = document.getElementById('custom-dialog-content');
      const input = document.getElementById('custom-dialog-input');
      const okBtn = document.getElementById('custom-dialog-ok');
      const cancelBtn = document.getElementById('custom-dialog-cancel');
      let cb = null;
      let mode = 'alert';
      function closeDialog(val) {
        mask.style.display = 'none';
        dialog.style.display = 'none';
        input.value = '';
        input.style.display = 'none';
        cancelBtn.style.display = 'none';
        if(cb) cb(val);
        cb = null;
      }
      
      // 关闭对话框函数
      window.closeCustomDialog = function() {
        console.log('🔍 关闭按钮被点击了！');
        console.log('🔍 当前对话框状态:', dialog.style.display);
        closeDialog();
      };
      window.showAlert = function(msg, callback, optTitle) {
        console.log('🔍 showAlert被调用:', msg.substring(0, 20) + '...');
        mode = 'alert';
        title.textContent = optTitle || '提示';
        content.textContent = msg;
        input.style.display = 'none';
        cancelBtn.style.display = 'none';
        mask.style.display = dialog.style.display = 'flex';
        cb = callback;
        
        // 根据内容类型决定是否显示关闭按钮
        const closeBtn = document.getElementById('custom-dialog-close');
        if (closeBtn) {
          // 如果是"每日一句"，隐藏关闭按钮
          if (msg.includes('每日一句')) {
            console.log('🔍 每日一句对话框，隐藏关闭按钮，消息内容:', msg.substring(0, 50));
            closeBtn.classList.add('hidden');
          } else {
            console.log('🔍 其他对话框，显示关闭按钮，消息内容:', msg.substring(0, 50));
            closeBtn.classList.remove('hidden');
          }
        } else {
          console.warn('⚠️ 关闭按钮未找到，可能影响用户体验');
        }
      };
      window.showConfirm = function(msg, callback, optTitle) {
        mode = 'confirm';
        title.textContent = optTitle || '请确认';
        content.textContent = msg;
        input.style.display = 'none';
        cancelBtn.style.display = 'inline-block';
        mask.style.display = dialog.style.display = 'flex';
        cb = callback;
      };
      window.showPrompt = function(msg, callback, optTitle, defaultVal, showCancel = true) {
        mode = 'prompt';
        title.textContent = optTitle || '请输入';
        content.textContent = msg;
        input.style.display = 'block';
        input.value = defaultVal || '';
        cancelBtn.style.display = showCancel ? 'inline-block' : 'none';
        mask.style.display = dialog.style.display = 'flex';
        cb = callback;
        setTimeout(()=>{input.focus();}, 100);
      };
      
      // 添加ESC键关闭对话框功能
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && dialog.style.display === 'flex') {
          closeDialog();
        }
      });
      okBtn.onclick = function() {
        if(mode==='prompt') closeDialog(input.value);
        else if(mode==='confirm') closeDialog(true);
        else closeDialog();
      };
      cancelBtn.onclick = function() {
        if(mode==='prompt') closeDialog(null);
        else if(mode==='confirm') closeDialog(false);
      };
      mask.onclick = function(e) { /* 点击遮罩不关闭 */ };
      dialog.onclick = function(e) { if(e.target===dialog) closeDialog(); };
      input.onkeydown = function(e) { if(e.key==='Enter') okBtn.click(); };
    })();
    // 背景彩色气泡动图效果
    (function() {
        const canvas = document.getElementById('bg-bubbles-canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        let dpr = window.devicePixelRatio || 1;
        let width = window.innerWidth, height = window.innerHeight;
        function resize() {
            dpr = window.devicePixelRatio || 1;
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            ctx.setTransform(1,0,0,1,0,0);
            ctx.scale(dpr, dpr);
        }
        window.addEventListener('resize', resize);
        resize();
        // 气泡参数
        const colors = ['#ff6b9e', '#6bd5ff', '#ffd56b', '#9e6bff', '#baffc9', '#fff6fa'];
        const bubbles = [];
        const BUBBLE_COUNT = 18;
        for (let i = 0; i < BUBBLE_COUNT; i++) {
            bubbles.push({
                x: Math.random() * width,
                y: Math.random() * height,
                r: 20 + Math.random() * 40,
                color: colors[Math.floor(Math.random()*colors.length)],
                speed: 0.3 + Math.random() * 0.7,
                dx: (Math.random()-0.5)*0.3,
                alpha: 0.15 + Math.random()*0.15
            });
        }
        function draw() {
            ctx.clearRect(0,0,width,height);
            for (const b of bubbles) {
                ctx.save();
                ctx.globalAlpha = b.alpha;
                ctx.beginPath();
                ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
                ctx.closePath();
                ctx.fillStyle = b.color;
                ctx.shadowColor = b.color;
                ctx.shadowBlur = 16;
                ctx.fill();
                ctx.restore();
                // update
                b.y -= b.speed;
                b.x += b.dx;
                if (b.y + b.r < 0) {
                    b.y = height + b.r;
                    b.x = Math.random() * width;
                }
            }
            requestAnimationFrame(draw);
        }
        draw();
    })();

    // 相册图片加载检测，自动隐藏加载失败的图片项
    window.addEventListener('DOMContentLoaded', function() {
        // 更新权限UI
        if (typeof updatePermissionUI === 'function') {
            updatePermissionUI();
        }
        
        document.querySelectorAll('.media-item[data-img]').forEach(function(item) {
            var img = new window.Image();
            img.onload = function() { 
                // 图片加载成功，移除加载失败的样式
                item.classList.remove('img-loading-failed');
                console.log('图片加载成功:', item.getAttribute('data-img'));
            };
            img.onerror = function(e) {
                // 显示详细错误信息
                var src = item.getAttribute('data-img');
                var msg = '相册图片加载失败：' + src + '\n\n';
                if (src.startsWith('http')) {
                    msg += '网络图片加载失败，请检查：\n• 网络连接\n• 图片链接是否有效\n• 图片服务器是否正常';
                } else {
                    msg += '本地图片加载失败，请检查：\n• 图片文件是否存在\n• 文件名和路径是否正确\n• 文件格式是否支持';
                }
                msg += '\n\n建议：\n• 将图片文件放在与HTML相同的目录中\n• 或使用完整的网络图片链接';
                
                showAlert(msg);
                // 控制台输出更详细的事件对象
                console.error('图片加载失败', src, e);
                
                // 添加加载失败的样式，而不是直接隐藏
                item.classList.add('img-loading-failed');
                item.style.backgroundImage = 'url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'300\' height=\'300\'%3E%3Crect width=\'300\' height=\'300\' fill=\'%23f0f0f0\'/%3E%3Ctext x=\'150\' y=\'150\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%23999\' font-size=\'16\'3E图片加载失败%3C/text%3E%3C/svg%3E")';
            };
            img.src = item.getAttribute('data-img');
        });
    });
    // 甜蜜相册弹窗
    function showImageModal(url) {
        document.getElementById('modal-img').src = url;
        document.getElementById('image-modal').style.display = 'flex';
    }
    function closeImageModal() {
        document.getElementById('image-modal').style.display = 'none';
        document.getElementById('modal-img').src = '';
    }
    // 每日一句祝福 - 增强版（支持联网获取）
    const quotes = [
        '愿我们一直甜到老，岁月静好。',
        '你笑起来真像夏天的风。',
        '和你在一起，每一天都值得纪念。',
        '世界很大，遇见你刚刚好。',
        '你是我最美的风景。',
        '陪你看日落的人比日落更温柔。',
        '我喜欢你，像风走了八千里，不问归期。',
        '你是我心里的小太阳。',
        '有你在，连平凡的日子都闪闪发光。',
        '余生请多指教。',
        '你的出现让我的世界变得温柔又明亮。',
        '每天醒来第一件事就是想你。',
        '你是我心中永远的宝藏。',
        '有你的日子，连空气都是甜的。',
        '想和你一起看遍四季的风景。',
        '你是我最温暖的依靠。',
        '遇见你，是我最美的意外。',
        '你的笑容是我每天的动力。',
        '和你在一起，时间总是过得太快。',
        '愿我们的故事没有结局，只剩幸福。'
    ];
    
    // 已显示的句子记录（避免重复）
    let displayedQuotes = new Set();
    
    // 联网获取每日一句
    async function fetchOnlineQuote() {
        try {
            // 尝试多个API源
            const apiSources = [
                'https://api.quotable.io/random?tags=love&maxLength=50',
                'https://api.quotable.io/random?tags=life&maxLength=50',
                'https://api.quotable.io/random?tags=wisdom&maxLength=50'
            ];
            
            for (const apiUrl of apiSources) {
                try {
                    const response = await fetch(apiUrl, { 
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'LoveDiary/1.0'
                        },
                        timeout: 5000
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.content && data.content.length > 0) {
                            // 翻译为中文（简化处理，实际可以使用翻译API）
                            const translatedQuote = translateQuote(data.content);
                            return {
                                text: translatedQuote,
                                author: data.author || '网络',
                                source: 'online'
                            };
                        }
                    }
                } catch (error) {
                    console.log(`API源 ${apiUrl} 失败:`, error.message);
                    continue;
                }
            }
            
            // 所有API都失败，返回null
            return null;
        } catch (error) {
            console.error('联网获取句子失败:', error);
            return null;
        }
    }
    
    // 简单的英文到中文翻译（实际项目中可以使用专业翻译API）
    function translateQuote(englishText) {
        const translations = {
            'love': '爱情',
            'life': '人生',
            'happiness': '幸福',
            'beautiful': '美丽',
            'together': '在一起',
            'forever': '永远',
            'heart': '心',
            'smile': '微笑',
            'dream': '梦想',
            'hope': '希望',
            'joy': '快乐',
            'peace': '平静',
            'courage': '勇气',
            'wisdom': '智慧',
            'faith': '信念',
            'grace': '优雅',
            'kindness': '善良',
            'patience': '耐心',
            'strength': '力量',
            'beauty': '美丽'
        };
        
        // 简单的关键词替换
        let translated = englishText;
        for (const [eng, chn] of Object.entries(translations)) {
            translated = translated.replace(new RegExp(eng, 'gi'), chn);
        }
        
        // 如果翻译效果不好，返回原文
        if (translated === englishText) {
            return `"${englishText}" - 网络句子`;
        }
        
        return translated;
    }
    
    // 获取不重复的句子
    function getUniqueQuote() {
        // 首先尝试联网获取
        return fetchOnlineQuote().then(onlineQuote => {
            if (onlineQuote && !displayedQuotes.has(onlineQuote.text)) {
                displayedQuotes.add(onlineQuote.text);
                return onlineQuote;
            }
            
            // 联网失败或重复，使用本地句子
            let availableQuotes = quotes.filter(q => !displayedQuotes.has(q));
            
            // 如果本地句子都用完了，重置记录
            if (availableQuotes.length === 0) {
                displayedQuotes.clear();
                availableQuotes = quotes;
                console.log('🔄 本地句子已全部显示，重置记录');
            }
            
            // 随机选择一句
            const randomQuote = availableQuotes[Math.floor(Math.random() * availableQuotes.length)];
            displayedQuotes.add(randomQuote);
            
            return {
                text: randomQuote,
                author: '本地',
                source: 'local'
            };
        }).catch(error => {
            console.error('获取句子失败，使用本地备用:', error);
            // 出错时使用本地句子
            let availableQuotes = quotes.filter(q => !displayedQuotes.has(q));
            if (availableQuotes.length === 0) {
                displayedQuotes.clear();
                availableQuotes = quotes;
            }
            const randomQuote = availableQuotes[Math.floor(Math.random() * availableQuotes.length)];
            displayedQuotes.add(randomQuote);
            
            return {
                text: randomQuote,
                author: '本地',
                source: 'local'
            };
        });
    }
    
    // 显示每日一句
    async function showRandomQuote() {
        const quoteElement = document.getElementById('daily-quote');
        const button = document.querySelector('button[onclick="showRandomQuote()"]');
        
        // 显示加载状态
        quoteElement.innerHTML = '<span style="color: #999;">🔄 正在获取句子...</span>';
        button.disabled = true;
        button.textContent = '获取中...';
        
        try {
            const quote = await getUniqueQuote();
            
            // 显示句子
            quoteElement.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.2rem; margin-bottom: 0.5rem; color: #6bd5ff;">
                        ${quote.text}
                    </div>
                    <div style="font-size: 0.9rem; color: #999;">
                        ${quote.source === 'online' ? '🌐 网络句子' : '💝 本地句子'} 
                        ${quote.author !== '本地' ? `· ${quote.author}` : ''}
                    </div>
                </div>
            `;
            
            // 显示成功提示
            if (quote.source === 'online') {
                showAlert(`✅ 成功获取网络句子！\n\n"${quote.text}"`);
            }
            
        } catch (error) {
            console.error('显示句子失败:', error);
            quoteElement.innerHTML = '<span style="color: #ff6b9e;">❌ 获取失败，请重试</span>';
        } finally {
            // 恢复按钮状态
            button.disabled = false;
            button.textContent = '换一句';
        }
    }
    // 页面加载时自动显示一句
    window.addEventListener('DOMContentLoaded', function() {
        showRandomQuote();
    });
    // 恋爱动态自动加载（支持图片和视频）
    /*
    love-feed.json 每条动态可包含：
    {
      "date": "2025-08-08",
      "text": "一起看了电影，超级开心！",
      "img": "movie.jpg", // 可选，图片路径或URL
      "video": "movie.mp4" // 可选，视频路径或URL
    }
    图片和视频字段均为可选，支持本地文件或网络链接。图片建议放在同目录或img子目录，视频同理。
    */
    (function(){
        const feedList = document.getElementById('love-feed-list');
        const feedLoading = document.getElementById('love-feed-loading');
        // 等待云开发系统初始化完成后再加载动态
        function waitForCloudBase() {
            if (window.cloudBaseManager && window.cloudBaseManager.isInitialized) {
                console.log('✅ 云开发系统已就绪，开始加载动态...');
                feedLoading.textContent = '正在加载动态...';
                window.cloudBaseManager.loadLoveFeedToPage();
            } else {
                console.log('⏳ 等待云开发系统初始化...');
                setTimeout(waitForCloudBase, 100);
            }
        }
        
        // 开始等待云开发系统
        waitForCloudBase();
    })();
    </script>
        
        <div class="timeline">
            <!-- 初遇次元 -->
            <div class="timeline-item scroll-animate fade-up section">
                <div class="timeline-date">2025.6</div>
                <div class="timeline-content">
                    <h2 class="timeline-title">🌐 初遇次元</h2>
                    <p class="timeline-text text-content">2025年6月7日，命运的齿轮开始转动！通过同学的快手分享，我第一次看到了你。那一刻，仿佛整个宇宙都在告诉我：这个女孩，值得我用一生去珍惜。</p>
                    <div class="timeline-quote quote-text">"还记得加你好友后的第一句话吗？'你好'——多么简单的两个字，却是我人生最美好的开始。原本只想做朋友，谁知道......"</div>
                    <div class="media-grid media-container">
                        <div class="media-item clickable-image" style="background-image: url('初识_20250813004540_25_9.jpg'); position:relative;" onclick="showImageModal('初识_20250813004540_25_9.jpg')">
                            <div class="img-blur-mask"></div>
                            <div class="image-overlay">
                                <span class="zoom-icon">🔍</span>
                                <span class="zoom-text">点击放大</span>
                            </div>
                        </div>
                        <div class="media-item clickable-image" style="background-image: url('初识_20250813004541_26_9.jpg'); position:relative;" onclick="showImageModal('初识_20250813004541_26_9.jpg')">
                            <div class="img-blur-mask"></div>
                            <div class="image-overlay">
                                <span class="zoom-icon">🔍</span>
                                <span class="zoom-text">点击放大</span>
                            </div>
                        </div>
                    </div>
                    
                    <style>
                    .img-blur-mask {
                        position: absolute;
                        top: 0; left: 0; right: 0; bottom: 0;
                        width: 100%; height: 100%;
                        /* backdrop-filter: blur(8px); */ /* 移除模糊效果 */
                        background: transparent; /* 移除半透明白色背景 */
                        border-radius: 8px;
                        z-index: 2;
                        pointer-events: none;
                    }
                    
                    .clickable-image {
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .clickable-image:hover {
                        transform: scale(1.05);
                        box-shadow: 0 8px 25px rgba(255, 107, 158, 0.3);
                    }
                    
                    .image-overlay {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(255, 107, 158, 0.1);
                        border-radius: 8px;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        opacity: 0;
                        transition: all 0.3s ease;
                        z-index: 3;
                        pointer-events: none;
                    }
                    
                    .clickable-image:hover .image-overlay {
                        opacity: 1;
                        background: rgba(255, 107, 158, 0.2);
                    }
                    
                    .zoom-icon {
                        font-size: 1.5rem;
                        color: #ff6b9e;
                        margin-bottom: 0.5rem;
                        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
                    }
                    
                    .zoom-text {
                        font-size: 0.8rem;
                        color: #ff6b9e;
                        font-weight: 600;
                        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
                    }
                    </style>
                </div>
            </div>
            
            <!-- 破壁时刻 -->
            <div class="timeline-item scroll-animate slide-left section">
                <div class="timeline-date">2025.7</div>
                <div class="timeline-content">
                    <h2 class="timeline-title">💬 破壁时刻</h2>
                    <p class="timeline-text text-content">7月的某个夜晚，我们聊到很晚很晚。你突然敞开心扉，分享了很多内心的想法。那一刻，我仿佛看到了一个闪闪发光的灵魂——你的活泼、热情、聪敏，还有那份纯真的善良，彻底击中了我的心。</p>
                    <p class="timeline-text text-content">7月29日，我们第一次视频通话！你害羞地用特效挡着脸，但我依然能看到你那双笑起来像月牙一样美的眼睛。那一刻，我知道我已经无法自拔了。</p>
                    <div class="button-group">
                    <button class="interactive-btn btn-animated" onclick="playOurSong()">播放我们的歌</button>
                    <button class="interactive-btn btn-animated" onclick="searchAndPlaySong()">切换网易云歌曲</button> <!-- 新增按钮，点击弹窗输入网易云ID -->
                    </div>
                </div>
            </div>

            <!-- 关系升级 -->
            <div class="timeline-item scroll-animate scale-in">
                <div class="timeline-date">2025.8.2</div>
                <div class="timeline-content">
                    <h2 class="timeline-title">🚀 关系升级</h2>
                    <p class="timeline-text">2025年8月2日凌晨5点20分，这个充满魔力的时刻！我在QQ上鼓起勇气，向你发送了那句改变我们命运的话。当你回复"我同意！"的那一刻，我的世界瞬间被粉色的泡泡填满，仿佛整个宇宙都在为我们庆祝！</p>
                    <p class="timeline-text">从此，我们有了专属的情侣标志：那些只属于我们两个人的亲昵称呼，还有那对象征着彼此背景的甜蜜头像。每一个细节都在诉说着我们的专属故事。</p>
                    <div class="media-grid">
                        <div class="media-item clickable-image" style="background-image: url('头像.jpg')" onclick="showImageModal('头像.jpg')">
                            <div class="image-overlay">
                                <span class="zoom-icon">🔍</span>
                                <span class="zoom-text">点击放大</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 云端甜蜜清单 -->
            <div class="timeline-item scroll-animate rotate-in">
                <div class="timeline-date">2025.8</div>
                <div class="timeline-content">
                    <h2 class="timeline-title">💻 云端甜蜜清单</h2>
                    <p class="timeline-text">我们一起完成的事：</p>
                    <ul class="timeline-list">
                        <li>💕 等待我们的故事</li>
                        <li>🌟 未来可期</li>
                        <li>💫 未完待续</li>
                    </ul>
                    <p class="timeline-text">互相送过的虚拟礼物：</p>
                    <ul class="timeline-list">
                        <li>🎁 等你来填写</li>
                        <li>💝 一起创造回忆</li>
                    </ul>

                </div>
            </div>
            
            <!-- 互动游戏区域 -->
            <div class="timeline-item scroll-animate bounce-in section">
                <div class="timeline-date">🎮</div>
                <div class="timeline-content">
                    <h2 class="timeline-title">🎮 互动游戏中心</h2>
                    <p class="timeline-text text-content">让我们一起玩游戏，增进感情吧！</p>
                    
                    <div class="mini-games-grid game-center-buttons">
                        <button class="mini-game-btn primary btn-animated game-btn" onclick="getLuckyNote()">
                            <span class="game-icon">🎯</span>
                            <span class="game-text">获取幸运签</span>
                        </button>
                        <button class="mini-game-btn secondary btn-animated game-btn" onclick="getLoveQuiz()">
                            <span class="game-icon">💬</span>
                            <span class="game-text">爱情问答</span>
                        </button>
                        <button class="mini-game-btn accent btn-animated game-btn" onclick="showDailyQuote()">
                            <span class="game-icon">💝</span>
                            <span class="game-text">每日一句</span>
                        </button>
                    </div>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <span class="stat-icon">🎯</span>
                            <span class="stat-label">幸运签</span>
                            <span class="stat-value" id="lucky-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">💬</span>
                            <span class="stat-label">问答次数</span>
                            <span class="stat-value" id="quiz-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">💝</span>
                            <span class="stat-label">每日一句</span>
                            <span class="stat-value" id="quote-count">0</span>
                        </div>
                    </div>
                    
                    <!-- 游戏结果显示区域 -->
                    <div id="interactive-result" style="margin-top: 1rem;"></div>
                </div>
            </div>
            
            <!-- 未来信号塔 -->
            <div class="timeline-item section">
                <div class="timeline-date">未来</div>
                <div class="timeline-content">
                    <h2 class="timeline-title">📡 未来信号塔</h2>
                    <p class="timeline-text text-content">我们计划在......第一次见面，地点定在......</p>
                    <p class="timeline-text text-content">长远的梦想：</p>
                    <ul class="timeline-list text-content">
                        <li>🌈 一起看遍世界风景</li>
                        <li>🏠 建造我们的小窝</li>
                        <li>💑 携手走过春夏秋冬</li>
                    </ul>
                    <div id="countdown" style="margin-top: 1rem;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>用代码编织的爱意 | 最后更新于 <span id="update-date"></span></p>
        <p>开发者wechat：zly_137,QQ:2369157249(注明来意！)</p>
        <button class="interactive-btn" style="margin-top:1rem;background:#fff6fa;color:#ff6b9e;border:1px solid #ffb6d5;" onclick="showWhisperInput()">写一句悄悄话</button>
        <button class="interactive-btn" style="margin-top:1rem;background:#f6fff9;color:#6bd5ff;border:1px solid #b6eaff;" onclick="showConfessionWall()">表白墙</button>
    </footer>

    <!-- 悄悄话弹幕容器 -->
    <div id="whisper-barrage-container" style="position:fixed;left:0;bottom:40px;width:100vw;z-index:99998;pointer-events:none;"></div>

    <script>
    // 页面点击随机飘落爱心动画
    document.addEventListener('click', function(e) {
        // 只在主区域点击才触发
        if (e.target.closest('button,.media-item,#image-modal')) return;
        const heart = document.createElement('div');
        heart.textContent = '💖';
        heart.style.position = 'fixed';
        heart.style.left = e.clientX - 16 + 'px';
        heart.style.top = e.clientY - 16 + 'px';
        heart.style.fontSize = (24 + Math.random()*16) + 'px';
        heart.style.opacity = 0.85;
        heart.style.pointerEvents = 'none';
        heart.style.transition = 'transform 1.2s cubic-bezier(.2,1.2,.4,1), opacity 1.2s';
        heart.style.transform = 'translateY(0) scale(1)';
        document.body.appendChild(heart);
        setTimeout(()=>{
            heart.style.transform = `translateY(-120px) scale(${1.2+Math.random()*0.6})`;
            heart.style.opacity = 0;
        }, 10);
        setTimeout(()=>heart.remove(), 1300);
    });

// 游戏统计计数器
let gameStats = {
    lucky: 0,
    quiz: 0,
    quote: 0
};

// 从localStorage加载游戏统计
function loadGameStats() {
    const saved = localStorage.getItem('gameStats');
    if (saved) {
        gameStats = JSON.parse(saved);
        updateGameStatsDisplay();
    }
}

// 更新游戏统计显示
function updateGameStatsDisplay() {
    const luckyCount = document.getElementById('lucky-count');
    const quizCount = document.getElementById('quiz-count');
    const quoteCount = document.getElementById('quote-count');
    
    if (luckyCount) luckyCount.textContent = gameStats.lucky;
    if (quizCount) quizCount.textContent = gameStats.quiz;
    if (quoteCount) quoteCount.textContent = gameStats.quote;
}

// 保存游戏统计到localStorage
function saveGameStats() {
    localStorage.setItem('gameStats', JSON.stringify(gameStats));
}

// 增加游戏统计
function incrementGameStat(type) {
    gameStats[type]++;
    saveGameStats();
    updateGameStatsDisplay();
}

// 幸运签功能
function showLuckyNote() {
    const notes = [
        '你们的爱情会像今天的阳光一样温暖明亮~',
        '未来的每一天都值得期待，甜蜜会一直延续！',
        '你们的故事会比童话更美好~',
        '幸福就在身边，珍惜每一次心动~',
        '愿你们的感情像幸运签一样，抽到的都是好消息！',
        '今天会有小惊喜降临哦！',
        '你们的默契值已满分！',
        '爱意如初，甜蜜如故。',
        '你们的未来会很闪耀！',
        '愿你们的每一天都被爱包围~'
    ];
    const idx = Math.floor(Math.random() * notes.length);
    incrementGameStat('lucky');
    showAlert('🎁 幸运签：\n' + notes[idx]);
}

// 每日一句功能
function showDailyQuote() {
    incrementGameStat('quote');
    const quotes = [
        '爱情是两个人一起成长的过程，每一天都是新的开始。',
        '真正的爱情不是占有，而是彼此成就。',
        '爱情就像春天的花朵，需要用心浇灌才能绽放。',
        '最好的爱情是，你在我身边，我在你心里。',
        '爱情不是寻找完美的人，而是学会用完美的眼光看待不完美的人。',
        '真正的爱情经得起时间的考验，越久越醇香。',
        '爱情是两个人一起面对生活的勇气和力量。',
        '最好的爱情是，你懂我的沉默，我懂你的温柔。',
        '爱情不是轰轰烈烈，而是细水长流的陪伴。',
        '真正的爱情是，你愿意为对方成为更好的人。'
    ];
    const idx = Math.floor(Math.random() * quotes.length);
    showAlert('💝 每日一句：\n' + quotes[idx]);
}

    // 表白墙弹幕功能
    function showConfessionWall() {
        showPrompt('在表白墙写下你的心里话（会以弹幕形式飘过页面顶部）：', function(confession) {
            if (confession && confession.trim()) {
                addConfessionBarrage(confession.trim());
            }
        }, '💕 表白墙', true); // 添加标题和取消按钮
    }
function addConfessionBarrage(text) {
    let container = document.getElementById('confession-barrage-container');
    if (!container) {
        container = document.createElement('div');
        container.id = 'confession-barrage-container';
        container.style.position = 'fixed';
        container.style.left = '0';
        container.style.top = '20px';
        container.style.width = '100vw';
        container.style.zIndex = '99999';
        container.style.pointerEvents = 'none';
        document.body.appendChild(container);
    }
    const span = document.createElement('span');
    span.textContent = text;
    span.style.position = 'absolute';
    span.style.left = '100vw';
    span.style.top = (Math.random()*20) + 'px';
    span.style.whiteSpace = 'nowrap';
    span.style.fontSize = (18+Math.random()*8)+'px';
    span.style.color = ['#ff6b9e','#6bd5ff','#ffd56b','#9e6bff','#baffc9'][Math.floor(Math.random()*5)];
    span.style.background = 'rgba(255,255,255,0.85)';
    span.style.borderRadius = '16px';
    span.style.padding = '4px 16px';
    span.style.marginRight = '8px';
    span.style.boxShadow = '0 2px 8px #0001';
    span.style.opacity = 0.98;
    span.style.pointerEvents = 'none';
    const duration = 8 + Math.random()*3;
    span.style.transition = `transform ${duration}s linear`;
    container.appendChild(span);
    setTimeout(()=>{
        span.style.transform = `translateX(-110vw)`;
    }, 30);
    setTimeout(()=>span.remove(), duration*1000+1000);
}

// 情侣默契问答功能
function showLoveQuiz() {
    const quizList = [
        {
            q: '第一次见面你们最想做什么？',
            a: ['A. 拥抱', 'B. 吃好吃的', 'C. 看电影', 'D. 一起散步']
        },
        {
            q: '你觉得对方最可爱的地方是？',
            a: ['A. 笑容', 'B. 声音', 'C. 性格', 'D. 眼睛']
        },
        {
            q: '你们最想一起去的地方？',
            a: ['A. 海边', 'B. 游乐园', 'C. 山顶', 'D. 家里']
        },
        {
            q: '谁更容易先认错？',
            a: ['A. 我', 'B. 对方', 'C. 看情况', 'D. 都不认错']
        },
        {
            q: '你们的爱情主题色是？',
            a: ['A. 粉色', 'B. 蓝色', 'C. 黄色', 'D. 紫色']
        },
        {
            q: '你们第一次约会最难忘的瞬间是？',
            a: ['A. 牵手', 'B. 拍照', 'C. 吃美食', 'D. 看电影']
        },
        {
            q: '对方最喜欢的饮料是？',
            a: ['A. 奶茶', 'B. 咖啡', 'C. 果汁', 'D. 碳酸饮料']
        },
        {
            q: '你们最常用的情侣昵称是？',
            a: ['A. 宝宝', 'B. 亲爱的', 'C. 小猪', 'D. 独家昵称']
        },
        {
            q: '谁更爱吃零食？',
            a: ['A. 我', 'B. 对方', 'C. 都爱', 'D. 都不爱']
        },
        {
            q: '你们最想一起完成的愿望是？',
            a: ['A. 一起旅行', 'B. 拍情侣写真', 'C. 养宠物', 'D. 共同买房']
        },
        {
            q: '对方最怕的东西是？',
            a: ['A. 昆虫', 'B. 黑暗', 'C. 高空', 'D. 独处']
        },
        {
            q: '你们最喜欢一起做的事情？',
            a: ['A. 看电影', 'B. 散步', 'C. 做饭', 'D. 打游戏']
        },
        {
            q: '谁更喜欢撒娇？',
            a: ['A. 我', 'B. 对方', 'C. 都会', 'D. 都不撒娇']
        },
        {
            q: '你们的专属纪念日是哪一天？',
            a: ['A. 第一次见面', 'B. 表白日', 'C. 牵手日', 'D. 其它']
        },
        {
            q: '对方最喜欢的季节是？',
            a: ['A. 春天', 'B. 夏天', 'C. 秋天', 'D. 冬天']
        },
        {
            q: '你们最常一起点的外卖是什么？',
            a: ['A. 火锅', 'B. 烧烤', 'C. 奶茶甜品', 'D. 快餐']
        }
    ];
    const idx = Math.floor(Math.random() * quizList.length);
    const quiz = quizList[idx];
    showPrompt('情侣默契问答：\n' + quiz.q + '\n' + quiz.a.join('  '), function(answer) {
        if (answer) {
            showAlert('答案已记录！快和TA对答案吧~\n你选的是：' + answer);
        }
    }, '💕 情侣默契问答', true); // 添加标题和取消按钮
}

        // 悄悄话弹幕功能
    function showWhisperInput() {
        showPrompt('请输入悄悄话权限密码：', function(pwd) {
            if (pwd !== 'zly') {
                if (pwd !== null) showAlert('密码错误，无权限输入悄悄话！');
                return;
            }
            showPrompt('写一句悄悄话（会以弹幕形式飘过页面底部）：', function(msg) {
                if (msg && msg.trim()) {
                    // 敏感词列表，可根据需要扩展
                    const badWords = [
                        '傻逼','sb','妈的','操','fuck','shit','草','狗','死','滚','贱','bitch','cnm','mlgb','煞笔','你妈','他妈','日你','屌','鸡巴','阴道','阳痿','高潮','肏','婊子','杂种','畜生','王八','二逼','弱智','智障','脑残','白痴','废物','垃圾','变态','淫','色鬼','小三','小贱','贱人','狗东西','狗屎','狗日','狗娘养的','猪','蠢','sb','tmd','nm','nmsl','nt','nmh','nmgb','nmzb','nmmp','nmll','nmzl','nmzj','nmzz','nmml','nmb','nmw','nmgd','nmgg','nmgn','nmgs','nmgl','nmga','nmge','nmgr','nmgt','nmgy','nmgh','nmgi','nmgo','nmgu','nmgi','nmga','nmgb','nmgsb','nmgnb','nmglb','nmglg','nmgls','nmglw','nmglz','nmglx','nmglc','nmglv','nmglf','nmglp','nmglq','nmglr','nmglj','nmglk','nmglh','nmglm','nmglb','nmglg','nmgls','nmglw','nmglz','nmglx','nmglc','nmglv','nmglf','nmglp','nmglq','nmglr','nmglj','nmglk','nmglh','nmglm','nmglb','nmglg','nmgls','nmglw','nmglz','nmglx','nmglc','nmglv','nmglf','nmglp','nmglq','nmglr','nmglj','nmglk','nmglh','nmglm','s逼','蠢猪'
                    ];
                    const lowerMsg = msg.trim().toLowerCase();
                    let hasBad = false;
                    for (let i = 0; i < badWords.length; i++) {
                        if (lowerMsg.includes(badWords[i])) {
                            hasBad = true;
                            break;
                        }
                    }
                    if (hasBad) {
                        showAlert('内容包含不文明用语，请重新输入~');
                        return;
                    }
                    addWhisperBarrage(msg.trim());
                }
            }, '💕 悄悄话', true); // 添加标题和取消按钮
        }, '🔐 权限验证', true); // 添加标题和取消按钮
    }
    function addWhisperBarrage(text) {
        const container = document.getElementById('whisper-barrage-container');
        const span = document.createElement('span');
        span.textContent = text;
        span.style.position = 'absolute';
        span.style.left = '100vw';
        span.style.bottom = (Math.random()*20) + 'px';
        span.style.whiteSpace = 'nowrap';
        span.style.fontSize = (18+Math.random()*8)+'px';
        span.style.color = ['#ff6b9e','#6bd5ff','#ffd56b','#9e6bff','#baffc9'][Math.floor(Math.random()*5)];
        span.style.background = 'rgba(255,255,255,0.7)';
        span.style.borderRadius = '16px';
        span.style.padding = '4px 16px';
        span.style.marginRight = '8px';
        span.style.boxShadow = '0 2px 8px #0001';
        span.style.opacity = 0.95;
        span.style.pointerEvents = 'none';
        const duration = 7 + Math.random()*3;
        span.style.transition = `transform ${duration}s linear`;
        container.appendChild(span);
        // 动画
        setTimeout(()=>{
            span.style.transform = `translateX(-110vw)`;
        }, 30);
        setTimeout(()=>span.remove(), duration*1000+1000);
    }
        // 配置项 - 个性化网页
        const CONFIG = {
            startDate: '2025-08-02T05:20:00', // 关系确立日期
            names: {
                me: 'xxx',
                you: 'xxx'
            },
            anniversaries: [
                { days: 7, title: "🎉 恋爱一周纪念", message: "甜蜜的第一周只是开始哦~" },
                { days: 30, title: "🌙 满月快乐", message: "一个月的糖分超标警告！" },
                { days: 100, title: "💯 百日成就", message: "100天只是我们故事的序章" },
                { days: 365, title: "🌸 周年纪念", message: "一年四季，最爱有你" },
                { days: 520, title: "💖 520我爱你", message: "这个日子天生属于我们" }
            ],
            ourSong: 'https://music.163.com/song/media/outer/url?id=568389828.mp3' // 替换为你们的歌，只改musicID部分
        };
        
        // 初始化页面内容
        function initPage() {
            document.title = `我们的云端恋爱日记 | ${CONFIG.names.me} & ${CONFIG.names.you}`;
            document.querySelector('h1').textContent = '我们的云端恋爱日记';
            document.querySelector('.subtitle').innerHTML = 
                `${CONFIG.names.me} ❤️ ${CONFIG.names.you} | 始于 <span id="start-date">${formatDate(new Date(CONFIG.startDate))}</span>`;
        }
        
        // 漂浮爱心效果
        function createHearts() {
            const container = document.getElementById('hearts-container');
            const colors = ['#ff6b9e', '#6bd5ff', '#ffd56b', '#9e6bff'];
            
            for (let i = 0; i < 20; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = '❤️';
                heart.style.left = Math.random() * 100 + '%';
                heart.style.top = Math.random() * 100 + '%';
                heart.style.color = colors[Math.floor(Math.random() * colors.length)];
                heart.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(heart);
            }
        }
        
        // 更新实时时间
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = 
                `当前时间: ${now.getFullYear()}年${now.getMonth()+1}月${now.getDate()}日 ` + 
                `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
        }
        
        // 精确计时和100天纪念日倒计时
        function updateTimeTogether() {
            const startDate = new Date(CONFIG.startDate);
            const now = new Date();
            const diff = now - startDate;
            // 计算时间差
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            // 更新时间显示
            document.getElementById('days-together').innerHTML = 
                `${days}天<span class="small">${hours}小时${minutes}分${seconds}秒</span>`;
            // 只显示100天纪念日倒计时
            const daysLeft = 100 - days;
            document.getElementById('next-anniversary').textContent = 
                daysLeft > 0 ? `距离100天纪念日还有${daysLeft}天` : `已经超过100天纪念日${-daysLeft}天啦！`;
            // 更新倒计时
            updateCountdown();
        }
        
        // 更新见面倒计时
        function updateCountdown() {
            const meetDate = new Date('2026-08-02T00:00:00'); // 修改为你们的见面日期
            const now = new Date();
            const diff = meetDate - now;
            
            if (diff > 0) {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                document.getElementById('countdown').innerHTML = 
                    `<p>距离见面还有: <strong>${days}天${hours}小时${minutes}分</strong></p>`;
            } else {
                document.getElementById('countdown').innerHTML = 
                    `<p>我们已经见面啦！🎉 下次见面倒计时可以修改代码设置~</p>`;
            }
        }
        
        // 纪念日彩蛋
        function checkAnniversary(days) {
            const anniversary = CONFIG.anniversaries.find(a => a.days === days);
            if (anniversary && !localStorage.getItem(`anniversary-${days}`)) {
                showAnniversaryPopup(anniversary);
                localStorage.setItem(`anniversary-${days}`, 'shown');
            }
        }
        
        // 显示纪念日弹窗
        function showAnniversaryPopup(anniversary) {
            const popup = document.createElement('div');
            popup.className = 'anniversary-popup';
            popup.innerHTML = `
                <div class="anniversary-content">
                    <button class="close-btn" onclick="this.parentNode.parentNode.remove()">×</button>
                    <h2 style="color: var(--primary);">${anniversary.title}</h2>
                    <p style="font-size: 1.2rem;">${anniversary.message}</p>
                    <img src="https://via.placeholder.com/300x200?text=我们的${anniversary.days}天" 
                         style="max-width: 100%; border-radius: 10px; margin: 1rem 0;">
                    <p>这是我们爱的第 ${anniversary.days} 天</p>
                    <button onclick="this.parentNode.parentNode.remove()" style="
                        padding: 10px 20px;
                        background: var(--primary);
                        color: white;
                        border: none;
                        border-radius: 20px;
                        margin-top: 1rem;
                        cursor: pointer;
                    ">继续书写我们的故事</button>
                </div>
            `;
            
            document.body.appendChild(popup);
        }
        
        // 显示更新日期
        function showUpdateDate() {
            document.getElementById('update-date').textContent = formatDate(new Date());
        }
        
        // 格式化日期
        function formatDate(date) {
            return `${date.getFullYear()}年${date.getMonth()+1}月${date.getDate()}日`;
        }
        
        // 播放/暂停我们的歌，并支持切换网易云音乐ID
        // 保持音频对象全局唯一，避免多次播放重叠
        let ourSongAudio = null;
        function playOurSong() {
            if (!ourSongAudio) {
                ourSongAudio = new Audio(CONFIG.ourSong);
                ourSongAudio.loop = false; // 如需循环播放可设为true
                // 监听播放失败
                ourSongAudio.onerror = function() {
                    alert('无法播放音乐，可能该ID无版权或被下架，将恢复默认歌曲');
                    // 恢复默认歌曲
                    CONFIG.ourSong = 'https://music.163.com/song/media/outer/url?id=568389828.mp3';
                    ourSongAudio = null;
                };
            }
            if (ourSongAudio.paused) {
                ourSongAudio.play().catch(e => alert('无法自动播放，请点击页面任意处后重试'));
            } else {
                ourSongAudio.pause();
            }
        }
        // 网易云音乐ID切换功能（需密码）
        function searchAndPlaySong() {
            showPrompt('请输入更换歌曲的权限密码：', function(pwd) {
            if (pwd !== 'zly') {
                    if (pwd !== null) showAlert('密码错误，无权限更换歌曲！');
                    return;
                }
                showPrompt('请输入网易云音乐的歌曲ID（数字，如568389828）：', function(musicId) {
                    if (musicId && /^\d+$/.test(musicId)) {
                        const url = `https://music.163.com/song/media/outer/url?id=${musicId}.mp3`;
                        CONFIG.ourSong = url; // 更新配置
                        if (ourSongAudio) {
                            ourSongAudio.pause();
                            ourSongAudio = null; // 释放旧对象
                        }
                        playOurSong(); // 播放新歌
                    } else if (musicId) {
                        showAlert('请输入正确的网易云音乐ID（纯数字）');
                    }
                }, '🎵 更换歌曲', true); // 添加标题和取消按钮
            }, '🔐 权限验证', true); // 添加标题和取消按钮
        }
        // 如需单独暂停按钮，可调用 playOurSong() 或自定义
        

        
        // 显示爱情计算器
        function showLoveCalculator() {
            const lovePercent = Math.floor(Math.random() * 31) + 70; // 70-100%
            alert(`❤️ 你们的匹配度是: ${lovePercent}% ❤️\n\n${CONFIG.names.me} 和 ${CONFIG.names.you} 是天造地设的一对！`);
        }
        
        // 页面加载和动画系统
        let pageLoaded = false;
        let scrollObserver;
        

        
        // 初始化页面加载器
        function initPageLoader() {
            const loader = document.getElementById('pageLoader');
            const progressBar = document.getElementById('loaderProgress');
            let progress = 0;
            
            console.log('开始初始化页面加载器...');
            
            // 确保加载器存在
            if (!loader || !progressBar) {
                console.error('页面加载器元素未找到');
                return;
            }
            
            console.log('页面加载器元素找到，开始加载动画...');
            
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    console.log('加载进度达到100%，准备隐藏加载器...');
                    
                    // 立即隐藏加载器
                    loader.style.display = 'none';
                    loader.classList.add('hidden');
                    
                    // 显示页面内容
                    const pageContent = document.querySelector('.page-content');
                    if (pageContent) {
                        pageContent.classList.add('loaded');
                        console.log('页面内容已显示');
                    }
                    
                    // 初始化滚动动画
                    initScrollAnimations();
                    
                    pageLoaded = true;
                    
                    console.log('页面加载完成，加载器已隐藏');
                }
                
                progressBar.style.width = progress + '%';
            }, 100);
        }
        

        
        // 初始化滚动动画系统
        function initScrollAnimations() {
            const animatedElements = document.querySelectorAll('.scroll-animate');
            
            // 创建Intersection Observer
            scrollObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-in');
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });
            
            // 观察所有动画元素
            animatedElements.forEach(el => {
                scrollObserver.observe(el);
            });
        }
        
        // 更新滚动进度条
        function updateScrollProgress() {
            const scrollProgress = document.getElementById('scrollProgress');
            if (scrollProgress) {
                const scrollTop = window.pageYOffset;
                const docHeight = document.body.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                scrollProgress.style.width = scrollPercent + '%';
            }
        }
        
        // 初始化
        window.onload = function() {
            // 启动页面加载器
            initPageLoader();
            
            // 备用隐藏机制：3秒后强制隐藏加载器
            setTimeout(() => {
                const loader = document.getElementById('pageLoader');
                if (loader && !pageLoaded) {
                    console.log('备用机制：强制隐藏加载器');
                    loader.style.display = 'none';
                    loader.classList.add('hidden');
                    
                    const pageContent = document.querySelector('.page-content');
                    if (pageContent) {
                        pageContent.classList.add('loaded');
                    }
                    
                    initScrollAnimations();
                    pageLoaded = true;
                }
            }, 3000);
            
            initPage();
            createHearts();
            updateCurrentTime();
            updateTimeTogether();
            showUpdateDate();
            
            // 初始化游戏统计
            loadGameStats();
            
            // 初始化恋爱动态表单监听器
            setTimeout(() => {
                addLoveFeed();
                // 初始化权限控制
                updatePermissionUI();
            }, 1000);
            
            // 每秒更新时间
            setInterval(updateCurrentTime, 1000);
            setInterval(updateTimeTogether, 1000);
            
            // 监听滚动事件
            window.addEventListener('scroll', updateScrollProgress);
        };
        
        // 安全初始化函数
        function safeInitFunctions() {
            try {
                // 基础功能初始化
                if (typeof initPage === 'function') initPage();
                if (typeof createHearts === 'function') createHearts();
                if (typeof updateCurrentTime === 'function') updateCurrentTime();
                if (typeof updateTimeTogether === 'function') updateTimeTogether();
                if (typeof showUpdateDate === 'function') showUpdateDate();
                if (typeof loadGameStats === 'function') loadGameStats();
                
                // 延迟初始化
                setTimeout(() => {
                    try {
                        if (typeof addLoveFeed === 'function') addLoveFeed();
                        if (typeof updatePermissionUI === 'function') updatePermissionUI();
                    } catch (error) {
                        console.error('延迟初始化出错:', error);
                    }
                }, 1000);
                
                // 定时器设置
                try {
                    if (typeof updateCurrentTime === 'function') {
                        setInterval(updateCurrentTime, 1000);
                    }
                    if (typeof updateTimeTogether === 'function') {
                        setInterval(updateTimeTogether, 1000);
                    }
                } catch (error) {
                    console.error('定时器设置出错:', error);
                }
                
                // 事件监听器
                try {
                    if (typeof updateScrollProgress === 'function') {
                        window.addEventListener('scroll', updateScrollProgress);
                    }
                } catch (error) {
                    console.error('事件监听器设置出错:', error);
                }
                
            } catch (error) {
                console.error('安全初始化函数出错:', error);
            }
        }
        
        // 强制显示页面（最后的备用方案）
        function forceShowPage() {
            try {
                console.log('强制显示页面（最后的备用方案）');
                
                const loader = document.getElementById('pageLoader');
                if (loader) {
                    loader.style.display = 'none';
                    loader.classList.add('hidden');
                }
                
                const pageContent = document.querySelector('.page-content');
                if (pageContent) {
                    pageContent.classList.add('loaded');
                }
                
                pageLoaded = true;
                
                // 尝试初始化基本功能
                safeInitFunctions();
                
            } catch (error) {
                console.error('强制显示页面时出错:', error);
            }
        }
    
    // 戒烟打卡功能（隐藏入口，连续点击主标题5次弹出，支持本地存储）
    (function(){
        // 入口设置：连续点击主标题5次触发
        let clickCount = 0;
        let clickTimer = null;
        const title = document.getElementById('main-title');
        if (title) {
            title.addEventListener('click', function() {
                clickCount++;
                if (clickTimer) clearTimeout(clickTimer);
                // 2秒内连续点击才计数，否则重置
                clickTimer = setTimeout(()=>{clickCount=0;}, 2000);
                if (clickCount >= 5) {
                    clickCount = 0;
                    showQuitSmokingModal();
                }
            });
        }

        // 打开戒烟打卡弹窗
        window.showQuitSmokingModal = function() {
            document.getElementById('quit-smoking-modal').style.display = 'flex';
            updateQuitSmokingUI();
        };
        // 关闭弹窗
        window.closeQuitSmokingModal = function() {
            document.getElementById('quit-smoking-modal').style.display = 'none';
        };

        // 获取今天日期字符串（yyyy-mm-dd）
        function getTodayStr() {
            const d = new Date();
            return d.getFullYear() + '-' + (d.getMonth()+1).toString().padStart(2,'0') + '-' + d.getDate().toString().padStart(2,'0');
        }
        // 获取昨天日期字符串
        function getYesterdayStr() {
            const d = new Date();
            d.setDate(d.getDate()-1);
            return d.getFullYear() + '-' + (d.getMonth()+1).toString().padStart(2,'0') + '-' + d.getDate().toString().padStart(2,'0');
        }
        // 获取本地存储的打卡数据
        function getQSData() {
            let data = localStorage.getItem('quitSmokingData');
            if (!data) return {days:0, lastDate:'', history:[], streak:0, maxStreak:0, achievements:[]};
            try {
                let d = JSON.parse(data);
                if (!d.history) d.history = [];
                if (!d.achievements) d.achievements = [];
                if (!d.streak) d.streak = 0;
                if (!d.maxStreak) d.maxStreak = 0;
                return d;
            } catch { return {days:0, lastDate:'', history:[], streak:0, maxStreak:0, achievements:[]}; }
        }
        // 保存打卡数据到本地
        function setQSData(data) {
            localStorage.setItem('quitSmokingData', JSON.stringify(data));
        }
        // 更新弹窗UI显示
        function updateQuitSmokingUI() {
            const data = getQSData();
            document.getElementById('qs-days').textContent = `累计打卡：${data.days||0} 天`;
            document.getElementById('qs-streaks').textContent = `连续：${data.streak||0} 天  |  最长连续：${data.maxStreak||0} 天`;
            document.getElementById('qs-last-date').textContent = data.lastDate ? `上次打卡：${data.lastDate}` : '还未开始打卡';
            const today = getTodayStr();
            const btn = document.getElementById('qs-punch-btn');
            if (data.history && data.history.includes(today)) {
                btn.disabled = true;
                btn.textContent = '今日已打卡';
                document.getElementById('qs-msg').textContent = getEncourageMsg(data.streak||0);
            } else {
                btn.disabled = false;
                btn.textContent = '今日打卡';
                document.getElementById('qs-msg').textContent = '';
            }
            // 打卡历史
            renderQSHistory(data.history||[]);
        }
        // 鼓励语
        function getEncourageMsg(streak) {
            if (streak >= 30) return '你已经坚持30天，超棒！继续保持！';
            if (streak >= 14) return '两周不易，习惯正在养成！';
            if (streak >= 7) return '一周成就达成！继续加油！';
            if (streak >= 3) return '已经坚持3天，迈出重要一步！';
            if (streak > 0) return '继续加油！每一天都值得骄傲~';
            return '';
        }
        // 打卡历史渲染
        function renderQSHistory(history) {
            const el = document.getElementById('qs-history');
            if (!history || history.length === 0) {
                el.innerHTML = '<span style="color:#bbb;">暂无打卡记录</span>';
                return;
            }
            // 取最近7天
            let arr = [];
            let today = new Date();
            for (let i = 6; i >= 0; i--) {
                let d = new Date(today);
                d.setDate(d.getDate()-i);
                let ds = d.getFullYear()+'-'+(d.getMonth()+1).toString().padStart(2,'0')+'-'+d.getDate().toString().padStart(2,'0');
                arr.push(ds);
            }
            let html = '<b>最近7天：</b><br>';
            arr.forEach(date => {
                if (history.includes(date)) {
                    html += `<span style='color:#4caf50;'>✔️${date}</span> `;
                } else {
                    html += `<span style='color:#bbb;'>✖️${date}</span> `;
                }
            });
            el.innerHTML = html;
        }
        // 点击"今日打卡"按钮逻辑
        function punchQS() {
            let data = getQSData();
            const today = getTodayStr();
            const yesterday = getYesterdayStr();
            if (!data.history) data.history = [];
            if (!data.achievements) data.achievements = [];
            // 连续天数判断
            if (data.history.length > 0 && data.history[data.history.length-1] === yesterday) {
                data.streak = (data.streak||0) + 1;
            } else if (data.history.length > 0 && data.history[data.history.length-1] === today) {
                // 已打卡
            } else {
                data.streak = 1;
            }
            if (!data.history.includes(today)) {
                data.history.push(today);
                data.days = data.history.length;
                data.lastDate = today;
                if (!data.maxStreak || data.streak > data.maxStreak) data.maxStreak = data.streak;
                setQSData(data);
                checkQSAchievements(data);
            }
            updateQuitSmokingUI();
        }
        // 成就检测
        function checkQSAchievements(data) {
            const achs = [
                {streak:3, msg:'🎉 连续打卡3天成就达成！习惯养成第一步！'},
                {streak:7, msg:'🏅 连续打卡7天成就达成！一周不易，继续加油！'},
                {streak:14, msg:'🥈 连续打卡14天成就达成！你已经很棒了！'},
                {streak:30, msg:'🏆 连续打卡30天成就达成！你已经战胜了自己！'}
            ];
            for (let i=0;i<achs.length;i++) {
                if (data.streak === achs[i].streak && !data.achievements.includes(achs[i].streak)) {
                    data.achievements.push(achs[i].streak);
                    setQSData(data);
                    setTimeout(()=>{
                        showQSAchievement(achs[i].msg);
                    }, 300);
                }
            }
        }
        // 成就弹窗
        function showQSAchievement(msg) {
            const div = document.createElement('div');
            div.style.position = 'fixed';
            div.style.top = '30%';
            div.style.left = '50%';
            div.style.transform = 'translate(-50%,-50%)';
            div.style.background = '#fff6fa';
            div.style.color = '#ff6b9e';
            div.style.padding = '1.2rem 2rem';
            div.style.borderRadius = '18px';
            div.style.fontSize = '1.2rem';
            div.style.boxShadow = '0 8px 32px #0003';
            div.style.zIndex = 100001;
            div.textContent = msg;
            document.body.appendChild(div);
            setTimeout(()=>{div.remove();}, 2600);
        }
        // 重置打卡
        function resetQS() {
            if (confirm('确定要重置所有打卡数据吗？此操作不可恢复。')) {
                localStorage.removeItem('quitSmokingData');
                updateQuitSmokingUI();
            }
        }
        // 绑定按钮事件
        document.getElementById('qs-punch-btn').onclick = punchQS;
        document.getElementById('qs-reset-btn').onclick = resetQS;
    })();
    
    // 云开发功能增强
    document.addEventListener('DOMContentLoaded', function() {
        // 等待云开发初始化完成
        const checkCloudBase = setInterval(() => {
            if (window.cloudBaseManager && window.cloudBaseManager.isInitialized) {
                clearInterval(checkCloudBase);
                console.log('云开发功能已就绪！');
                
                // 添加互动功能按钮
                addInteractiveFeatures();
            }
        }, 1000);
    });
    
    // 添加互动功能
    function addInteractiveFeatures() {
        // 在"云端甜蜜清单"部分添加互动按钮
        const loveListSection = document.querySelector('.timeline-content:has(.timeline-list)');

    }
    
    // 获取幸运签
    async function getLuckyNote() {
        const resultDiv = document.getElementById('interactive-result');
        resultDiv.innerHTML = '<div style="color: #ff6b9e; font-size: 1.1rem;">🎯 正在获取幸运签...</div>';
        
        try {
            if (window.cloudBaseManager) {
                const result = await window.cloudBaseManager.getLuckyNote();
                if (result && result.data) {
                    resultDiv.innerHTML = `
                        <div style="
                            background: linear-gradient(135deg, #fff6fa, #ffeef8);
                            border: 2px solid #ffb6d5;
                            border-radius: 15px;
                            padding: 1.5rem;
                            margin: 1rem 0;
                            box-shadow: 0 8px 25px rgba(255, 107, 158, 0.15);
                        ">
                            <div style="
                                display: flex;
                                align-items: center;
                                justify-content: space-between;
                                margin-bottom: 1rem;
                                padding-bottom: 0.5rem;
                                border-bottom: 2px solid rgba(255, 107, 158, 0.2);
                                position: relative;
                            ">
                                <span style="font-size: 1.2rem; color: #ff6b9e;">✨</span>
                                <span style="font-size: 1.3rem; color: #ff6b9e; font-weight: 600;">今日幸运签</span>
                                <span style="font-size: 1.2rem; color: #ff6b9e;">✨</span>
                                <button onclick="clearInteractiveResult()" class="card-close-btn">×</button>
                            </div>
                            <div style="
                                display: flex;
                                align-items: center;
                                justify-content: space-between;
                                margin-bottom: 1rem;
                                padding: 1rem;
                                background: rgba(255, 255, 255, 0.6);
                                border-radius: 10px;
                                border: 1px solid rgba(255, 107, 158, 0.1);
                            ">
                                <div style="flex: 1; text-align: left;">
                                    <div style="font-size: 1.1rem; color: #333; font-weight: 500; margin-bottom: 0.5rem;">幸运内容</div>
                                    <div style="font-size: 1rem; color: #666; line-height: 1.5;">${result.data.note}</div>
                                </div>
                                <div style="
                                    width: 60px;
                                    height: 60px;
                                    background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                                    border-radius: 50%;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    margin-left: 1rem;
                                    flex-shrink: 0;
                                ">
                                    <span style="font-size: 1.5rem; color: white;">🎯</span>
                                </div>
                            </div>
                            <div style="
                                display: flex;
                                align-items: center;
                                justify-content: space-between;
                                font-size: 0.9rem;
                                color: #999;
                            ">
                                <span>💝 爱情指南</span>
                                <span>获取时间：${new Date(result.data.timestamp).toLocaleString()}</span>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div style="color: #ff6b9e;">🎯 获取幸运签失败，请重试~</div>';
                }
            } else {
                resultDiv.innerHTML = '<div style="color: #ff6b9e;">🎯 云开发服务未就绪，请稍后重试~</div>';
            }
        } catch (error) {
            console.error('获取幸运签失败:', error);
            resultDiv.innerHTML = '<div style="color: #ff6b9e;">🎯 获取幸运签失败，请重试~</div>';
        }
    }
    
    // 获取爱情问答
    async function getLoveQuiz() {
        incrementGameStat('quiz');
        const resultDiv = document.getElementById('interactive-result');
        resultDiv.innerHTML = '<div style="color: #ff8fab; font-size: 1.1rem;">💭 正在获取爱情问答...</div>';
        
        try {
            if (window.cloudBaseManager) {
                const result = await window.cloudBaseManager.getLoveQuiz();
                if (result && result.data && result.data.quiz) {
                    const quiz = result.data.quiz;
                    resultDiv.innerHTML = `
                        <div style="
                            background: linear-gradient(135deg, #fff6fa, #ffeef8);
                            border: 2px solid #ffb6d5;
                            border-radius: 15px;
                            padding: 1.5rem;
                            margin: 1rem 0;
                            box-shadow: 0 8px 25px rgba(255, 107, 158, 0.15);
                        ">
                            <div style="font-size: 1.3rem; color: #ff8fab; margin-bottom: 1rem; text-align: center; position: relative;">💭 爱情问答 💭
                                <button onclick="clearInteractiveResult()" class="card-close-btn love-quiz">×</button>
                            </div>
                            <div class="quiz-question" style="font-size: 1.1rem; color: #333; margin-bottom: 1rem; font-weight: bold;">${quiz.question}</div>
                            <div style="margin-bottom: 1.5rem;">
                                ${quiz.options.map((option, index) => `
                                    <div onclick="selectQuizOption(this, '${option}', '${quiz.answer}')" style="
                                        background: #f8f9fa;
                                        border: 2px solid #e9ecef;
                                        border-radius: 10px;
                                        padding: 0.8rem;
                                        margin: 0.5rem 0;
                                        color: #666;
                                        font-weight: normal;
                                        cursor: pointer;
                                        transition: all 0.3s ease;
                                        user-select: none;
                                    " onmouseover="this.style.background='#fff6fa';this.style.borderColor='#ffb6d5'" onmouseout="this.style.background='#f8f9fa';this.style.borderColor='#e9ecef'">
                                        ${String.fromCharCode(65 + index)}. ${option}
                                        <span class="option-result" style="display: none;"></span>
                                    </div>
                                `).join('')}
                            </div>
                            <div id="quiz-result" style="display: none; margin-bottom: 1rem;">
                                <div id="result-message" style="
                                    padding: 1rem;
                                    border-radius: 8px;
                                    text-align: center;
                                    font-weight: bold;
                                    font-size: 1.1rem;
                                    margin-bottom: 1rem;
                                "></div>
                                <div style="text-align: center;">
                                    <button onclick="retryQuiz()" style="
                                        background: linear-gradient(135deg, #ff8fab, #ff6b9e);
                                        color: white;
                                        border: none;
                                        border-radius: 8px;
                                        padding: 0.8rem 1.5rem;
                                        margin: 0 0.5rem;
                                        cursor: pointer;
                                        font-size: 1rem;
                                        transition: all 0.3s ease;
                                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                        🔄 重新答题
                                    </button>
                                    <button onclick="nextQuiz()" style="
                                        background: linear-gradient(135deg, #6c5ce7, #a29bfe);
                                        color: white;
                                        border: none;
                                        border-radius: 8px;
                                        padding: 0.8rem 1.5rem;
                                        margin: 0 0.5rem;
                                        cursor: pointer;
                                        font-size: 1rem;
                                        transition: all 0.3s ease;
                                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                        ➡️ 下一题
                                    </button>
                                    <button onclick="getNetworkQuiz()" style="
                                        background: linear-gradient(135deg, #00b894, #00cec9);
                                        color: white;
                                        border: none;
                                        border-radius: 8px;
                                        padding: 0.8rem 1.5rem;
                                        margin: 0 0.5rem;
                                        cursor: pointer;
                                        font-size: 1rem;
                                        transition: all 0.3s ease;
                                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                        🌐 网络题目
                                    </button>
                                </div>
                            </div>
                            <div style="
                                background: #fff6fa;
                                border-left: 4px solid #ff8fab;
                                padding: 1rem;
                                border-radius: 8px;
                                color: #666;
                                font-style: italic;
                            ">
                                💡 ${quiz.explanation}
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div style="color: #ff8fab;">💭 获取爱情问答失败，请重试~</div>';
                }
            } else {
                resultDiv.innerHTML = '<div style="color: #ff8fab;">💭 云开发服务未就绪，请稍后重试~</div>';
            }
        } catch (error) {
            console.error('获取爱情问答失败:', error);
            resultDiv.innerHTML = '<div style="color: #ff8fab;">💭 获取爱情问答失败，请重试~</div>';
        }
    }
    
    // 清除互动结果区域
    function clearInteractiveResult() {
        try {
            const resultDiv = document.getElementById('interactive-result');
            if (resultDiv) {
                resultDiv.innerHTML = '';
                console.log('✅ 互动结果区域已清除');
            } else {
                console.warn('⚠️ 未找到互动结果区域');
            }
        } catch (error) {
            console.error('❌ 清除互动结果区域时出错:', error);
        }
    }
    
    // 选择问答选项
    function selectQuizOption(element, selectedOption, correctAnswer) {
        // 防止重复选择
        if (element.classList.contains('selected')) return;
        
        // 标记所有选项为已选择状态
        const allOptions = document.querySelectorAll('[onclick*="selectQuizOption"]');
        allOptions.forEach(opt => opt.classList.add('selected'));
        
        // 显示选择结果
        const resultDiv = document.getElementById('quiz-result');
        const resultMessage = document.getElementById('result-message');
        
        if (selectedOption === correctAnswer) {
            // 正确答案
            element.style.background = '#e8f5e8';
            element.style.borderColor = '#28a745';
            element.style.color = '#155724';
            element.style.fontWeight = 'bold';
            element.querySelector('.option-result').innerHTML = ' ✅ 正确！';
            element.querySelector('.option-result').style.display = 'inline';
            
            resultMessage.innerHTML = '🎉 恭喜你答对了！';
            resultMessage.style.background = '#d4edda';
            resultMessage.style.color = '#155724';
            resultMessage.style.border = '2px solid #c3e6cb';
        } else {
            // 错误答案
            element.style.background = '#f8d7da';
            element.style.borderColor = '#dc3545';
            element.style.color = '#721c24';
            element.style.fontWeight = 'bold';
            element.querySelector('.option-result').innerHTML = ' ❌ 错误';
            element.querySelector('.option-result').style.display = 'inline';
            
            // 高亮正确答案 - 修复逻辑
            allOptions.forEach(opt => {
                // 获取选项文本（去掉A. B. C. D.前缀）
                const optText = opt.textContent.replace(/^[A-D]\.\s/, '').trim();
                // 去掉结果提示文本，只保留选项内容
                const cleanOptText = optText.replace(/\s*[✅❌].*$/, '').trim();
                
                if (cleanOptText === correctAnswer) {
                    // 高亮正确答案
                    opt.style.background = '#e8f5e8';
                    opt.style.borderColor = '#28a745';
                    opt.style.color = '#155724';
                    opt.style.fontWeight = 'bold';
                    opt.style.boxShadow = '0 0 10px rgba(40, 167, 69, 0.3)';
                    
                    // 显示正确答案标识
                    const resultSpan = opt.querySelector('.option-result');
                    if (resultSpan) {
                        resultSpan.innerHTML = ' ✅ 正确答案';
                        resultSpan.style.display = 'inline';
                        resultSpan.style.color = '#28a745';
                        resultSpan.style.fontWeight = 'bold';
                    }
                }
            });
            
            resultMessage.innerHTML = '😔 答错了，正确答案已高亮显示';
            resultMessage.style.background = '#f8d7da';
            resultMessage.style.color = '#721c24';
            resultMessage.style.border = '2px solid #f5c6cb';
        }
        
        resultDiv.style.display = 'block';
        
        // 记录互动
        if (window.cloudBaseManager) {
            window.cloudBaseManager.recordInteraction('quiz_answer', {
                question: document.querySelector('#interactive-result .quiz-question')?.textContent || '爱情问答',
                selected: selectedOption,
                correct: correctAnswer,
                isCorrect: selectedOption === correctAnswer
            });
        }
    }
    
    // 重新答题
    function retryQuiz() {
        // 重置所有选项状态
        const allOptions = document.querySelectorAll('[onclick*="selectQuizOption"]');
        allOptions.forEach(opt => {
            opt.classList.remove('selected');
            opt.style.background = '#f8f9fa';
            opt.style.borderColor = '#e9ecef';
            opt.style.color = '#666';
            opt.style.fontWeight = 'normal';
            opt.style.boxShadow = 'none';
            opt.style.pointerEvents = 'auto';
            
            // 重置结果提示
            const resultSpan = opt.querySelector('.option-result');
            if (resultSpan) {
                resultSpan.style.display = 'none';
                resultSpan.innerHTML = '';
            }
        });
        
        // 隐藏结果区域
        document.getElementById('quiz-result').style.display = 'none';
    }
    
    // 下一题
    function nextQuiz() {
        // 重新获取爱情问答
        getLoveQuiz();
    }
    
    // 获取网络题目
    async function getNetworkQuiz() {
        const resultDiv = document.getElementById('interactive-result');
        resultDiv.innerHTML = '<div style="color: #00b894; font-size: 1.1rem;">🌐 正在获取网络题目...</div>';
        
        try {
            if (window.cloudBaseManager) {
                const result = await window.cloudBaseManager.callFunction('getNetworkQuiz');
                if (result && result.data && result.data.quiz) {
                    const quiz = result.data.quiz;
                    const source = result.data.source || 'unknown';
                    
                    resultDiv.innerHTML = `
                        <div style="
                            background: linear-gradient(135deg, #fff6fa, #ffeef8);
                            border: 2px solid #00b894;
                            border-radius: 15px;
                            padding: 1.5rem;
                            margin: 1rem 0;
                            box-shadow: 0 8px 25px rgba(0, 184, 148, 0.15);
                        ">
                            <div style="font-size: 1.3rem; color: #00b894; margin-bottom: 1rem; text-align: center;">
                                🌐 网络题目 ${source === 'network' ? '✅' : '⚠️'}
                                ${result.data.totalQuizzes ? `(${result.data.currentIndex}/${result.data.totalQuizzes})` : ''}
                            </div>
                            <div class="quiz-question" style="font-size: 1.1rem; color: #333; margin-bottom: 1rem; font-weight: bold;">${quiz.question}</div>
                            <div style="margin-bottom: 1.5rem;">
                                ${quiz.options.map((option, index) => `
                                    <div onclick="selectQuizOption(this, '${option}', '${quiz.answer}')" style="
                                        background: #f8f9fa;
                                        border: 2px solid #e9ecef;
                                        border-radius: 10px;
                                        padding: 0.8rem;
                                        margin: 0.5rem 0;
                                        color: #666;
                                        font-weight: normal;
                                        cursor: pointer;
                                        transition: all 0.3s ease;
                                        user-select: none;
                                    " onmouseover="this.style.background='#e8f5e8';this.style.borderColor='#00b894'" onmouseout="this.style.background='#f8f9fa';this.style.borderColor='#e9ecef'">
                                        ${String.fromCharCode(65 + index)}. ${option}
                                        <span class="option-result" style="display: none;"></span>
                                    </div>
                                `).join('')}
                            </div>
                            <div id="quiz-result" style="display: none; margin-bottom: 1rem;">
                                <div id="result-message" style="
                                    padding: 1rem;
                                    border-radius: 8px;
                                    text-align: center;
                                    font-weight: bold;
                                    font-size: 1.1rem;
                                    margin-bottom: 1rem;
                                "></div>
                                <div style="text-align: center;">
                                    <button onclick="retryQuiz()" style="
                                        background: linear-gradient(135deg, #ff8fab, #ff6b9e);
                                        color: white;
                                        border: none;
                                        border-radius: 8px;
                                        padding: 0.8rem 1.5rem;
                                        margin: 0 0.5rem;
                                        cursor: pointer;
                                        font-size: 1rem;
                                        transition: all 0.3s ease;
                                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                        🔄 重新答题
                                    </button>
                                    <button onclick="getNetworkQuiz()" style="
                                        background: linear-gradient(135deg, #00b894, #00cec9);
                                        color: white;
                                        border: none;
                                        border-radius: 8px;
                                        padding: 0.8rem 1.5rem;
                                        margin: 0 0.5rem;
                                        cursor: pointer;
                                        font-size: 1rem;
                                        transition: all 0.3s ease;
                                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                        🌐 下一道网络题
                                    </button>
                                    <button onclick="getLoveQuiz()" style="
                                        background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                                        color: white;
                                        border: none;
                                        border-radius: 8px;
                                        padding: 0.8rem 1.5rem;
                                        margin: 0 0.5rem;
                                        cursor: pointer;
                                        font-size: 1rem;
                                        transition: all 0.3s ease;
                                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                        💕 返回本地题目
                                    </button>
                                </div>
                            </div>
                            <div style="
                                background: #e8f5e8;
                                border-left: 4px solid #00b894;
                                padding: 1rem;
                                border-radius: 8px;
                                color: #666;
                                font-style: italic;
                            ">
                                💡 ${quiz.explanation}
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div style="color: #00b894;">🌐 获取网络题目失败，请重试~</div>';
                }
            } else {
                resultDiv.innerHTML = '<div style="color: #00b894;">🌐 云开发服务未就绪，请稍后重试~</div>';
            }
        } catch (error) {
            console.error('获取网络题目失败:', error);
            resultDiv.innerHTML = '<div style="color: #00b894;">🌐 获取网络题目失败，请重试~</div>';
        }
    }
    
    // 添加恋爱动态（现在直接在页面中显示表单）
    async function addLoveFeed() {
        // 表单已经在页面中，只需要确保媒体输入监听器正常工作
        const feedType = document.getElementById('feed-type');
        if (feedType) {
            feedType.addEventListener('change', function() {
                const mediaInput = document.getElementById('media-input');
                if (this.value === 'image' || this.value === 'video') {
                    mediaInput.style.display = 'block';
                } else {
                    mediaInput.style.display = 'none';
                }
            });
        }
    }
    
    // 提交恋爱动态
    async function submitLoveFeed() {
        const content = document.getElementById('feed-content').value.trim();
        const type = document.getElementById('feed-type').value;
        const mediaUrl = document.getElementById('feed-media-url').value.trim();
        
        if (!content) {
            showAlert('请输入动态内容！');
            return;
        }
        
        let finalType = type;
        let finalMediaUrl = mediaUrl;
        let finalMediaUrls = [];
        
        // 如果有上传的图片，优先使用
        if (window.selectedImages && window.selectedImages.length > 0) {
            finalType = 'image';
            // 将图片文件转换为Data URL（实际项目中应该上传到服务器）
            finalMediaUrls = window.selectedImages.map(file => {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(file);
                });
            });
            
            // 等待所有图片转换完成
            finalMediaUrls = await Promise.all(finalMediaUrls);
            finalMediaUrl = finalMediaUrls[0]; // 兼容旧版本
        }
        
        // 检查媒体链接（如果没有上传图片）
        if ((finalType === 'image' || finalType === 'video') && !finalMediaUrl && finalMediaUrls.length === 0) {
            showAlert('请输入媒体链接或上传图片！');
            return;
        }
        
        try {
            if (window.cloudBaseManager) {
                const result = await window.cloudBaseManager.addLoveFeed(content, finalType, finalMediaUrl);
                if (result) {
                    showAlert('💕 恋爱动态发布成功！');
                    // 刷新动态列表
                    if (window.cloudBaseManager.loadLoveFeedToPage) {
                        window.cloudBaseManager.loadLoveFeedToPage();
                    }
                    // 清空表单并关闭表单
                    clearLoveFeedForm();
                    closeLoveFeedForm();
                }
            } else {
                showAlert('云开发服务未就绪，请稍后重试~');
            }
        } catch (error) {
            console.error('发布恋爱动态失败:', error);
            showAlert('发布失败，请重试~');
        }
    }
    
    // 清空恋爱动态表单
    function clearLoveFeedForm() {
        document.getElementById('feed-content').value = '';
        document.getElementById('feed-type').value = 'text';
        document.getElementById('feed-media-url').value = '';
        document.getElementById('media-input').style.display = 'none';
        
        // 清空图片
        if (window.selectedImages) {
            window.selectedImages = [];
        }
        document.getElementById('image-upload').value = '';
        document.getElementById('image-preview').style.display = 'none';
    }
    
    // 显示恋爱动态表单
    function showLoveFeedForm() {
        console.log('💕 开始显示恋爱动态表单...');
        const form = document.getElementById('love-feed-form');
        const reopenButton = document.getElementById('reopen-love-feed-form');
        
        if (form) {
            console.log('开始执行显示动画...');
            // 先显示表单，但设置为透明和偏移
            form.style.display = 'block';
            form.style.opacity = '0';
            form.style.transform = 'translateY(20px)';
            form.style.maxHeight = '0';
            form.style.padding = '0 1.5rem';
            form.style.margin = '0';
            form.style.pointerEvents = 'none';
            
            // 强制重绘
            form.offsetHeight;
            
            // 执行显示动画
            form.style.opacity = '1';
            form.style.transform = 'translateY(0)';
            form.style.maxHeight = '1000px';
            form.style.padding = '1.5rem';
            form.style.margin = '1rem 0';
            form.style.pointerEvents = 'auto';
            
            console.log('表单显示动画完成');
        } else {
            console.error('❌ 未找到恋爱动态表单元素！');
        }
        
        // 移除重新打开按钮（如果存在）
        if (reopenButton) {
            reopenButton.remove();
            console.log('已移除重新打开按钮');
        }
        
        console.log('💕 显示恋爱动态表单函数执行完成');
    }
    
    // 关闭恋爱动态表单
    function closeLoveFeedForm() {
        console.log('🔒 开始关闭恋爱动态表单...');
        const form = document.getElementById('love-feed-form');
        
        console.log('找到表单元素:', form);
        
        if (form) {
            console.log('开始执行关闭动画...');
            // 使用流畅的关闭动画
            form.style.opacity = '0';
            form.style.transform = 'translateY(-20px)';
            form.style.maxHeight = '0';
            form.style.padding = '0 1.5rem';
            form.style.margin = '0';
            form.style.pointerEvents = 'none';
            
            // 等待动画完成后隐藏
            setTimeout(() => {
                console.log('动画完成，隐藏表单...');
                form.style.display = 'none';
                // 重置样式，为下次显示做准备
                form.style.opacity = '1';
                form.style.transform = 'translateY(0)';
                form.style.maxHeight = '1000px';
                form.style.padding = '1.5rem';
                form.style.margin = '1rem 0';
                form.style.pointerEvents = 'auto';
                console.log('表单已关闭，样式已重置');
            }, 400);
        } else {
            console.error('❌ 未找到恋爱动态表单元素！');
        }
        
        console.log('🔒 关闭恋爱动态表单函数执行完成');
    }
    
    // 重新打开恋爱动态表单
    function reopenLoveFeedForm() {
        console.log('🔄 重新打开恋爱动态表单...');
        // 直接调用显示函数
        showLoveFeedForm();
    }
    
    // 刷新恋爱动态
    async function refreshLoveFeed() {
        const loadingDiv = document.getElementById('love-feed-loading');
        const feedList = document.getElementById('love-feed-list');
        
        // 保存当前动态列表的高度，用于缓冲
        const currentHeight = feedList.offsetHeight;
        const minHeight = Math.max(currentHeight, 120); // 至少保持120px高度
        
        // 显示加载状态，保持页面布局稳定
        loadingDiv.textContent = '正在刷新动态...';
        loadingDiv.style.display = 'block';
        
        // 在甜蜜相册区块前插入页面缓冲，防止下面的区块突然闪动
        const photoSection = document.getElementById('sweet-photo-section');
        let pageBuffer = null;
        if (photoSection) {
            pageBuffer = window.insertPageBuffer(photoSection, minHeight);
        }
        
        // 创建动态列表缓冲占位符
        const bufferDiv = document.createElement('div');
        bufferDiv.id = 'love-feed-buffer';
        bufferDiv.style.cssText = `
            min-height: ${minHeight}px;
            background: linear-gradient(135deg, rgba(255, 107, 158, 0.05), rgba(255, 142, 171, 0.05));
            border: 2px dashed rgba(255, 107, 158, 0.3);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem 0;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        `;
        bufferDiv.innerHTML = `
            <div style="text-align: center; color: #ff6b9e;">
                <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">🔄 正在刷新动态...</div>
                <div style="font-size: 0.9rem; color: #999;">请稍候，保持页面稳定</div>
            </div>
        `;
        
        // 清空动态列表并插入缓冲占位符
        feedList.innerHTML = '';
        feedList.appendChild(bufferDiv);
        
        // 缓冲占位符出现动画
        setTimeout(() => {
            bufferDiv.style.opacity = '1';
            bufferDiv.style.transform = 'translateY(0)';
        }, 50);
        
        try {
            if (window.cloudBaseManager && window.cloudBaseManager.loadLoveFeedToPage) {
                await window.cloudBaseManager.loadLoveFeedToPage();
                
                // 缓冲占位符消失动画
                bufferDiv.style.opacity = '0';
                bufferDiv.style.transform = 'translateY(-10px)';
                
                setTimeout(() => {
                    // 移除缓冲占位符
                    if (bufferDiv.parentNode) {
                        bufferDiv.parentNode.removeChild(bufferDiv);
                    }
                    
                    // 移除页面缓冲
                    if (pageBuffer) {
                        window.removePageBuffer(pageBuffer);
                    }
                    
                    loadingDiv.textContent = '动态刷新完成！';
                    
                    // 自动关闭恋爱动态表单以节省空间
                    closeLoveFeedForm();
                    
                    setTimeout(() => {
                        loadingDiv.textContent = '动态加载中...';
                    }, 2000);
                }, 300);
                
            } else {
                loadingDiv.textContent = '云开发服务未就绪';
                // 移除缓冲占位符
                if (bufferDiv.parentNode) {
                    bufferDiv.parentNode.removeChild(bufferDiv);
                }
                // 移除页面缓冲
                if (pageBuffer) {
                    window.removePageBuffer(pageBuffer);
                }
            }
        } catch (error) {
            console.error('刷新动态失败:', error);
            loadingDiv.textContent = '刷新失败，请重试';
            // 移除缓冲占位符
            if (bufferDiv.parentNode) {
                bufferDiv.parentNode.removeChild(bufferDiv);
            }
            // 移除页面缓冲
            if (pageBuffer) {
                window.removePageBuffer(pageBuffer);
            }
        }
    }
    
    // 添加新回忆
    async function addNewMemory() {
        const resultDiv = document.getElementById('interactive-result');
        
        // 创建输入表单
        resultDiv.innerHTML = `
            <div style="
                background: linear-gradient(135deg, #fff6fa, #ffeef8);
                border: 2px solid #ffb6d5;
                border-radius: 15px;
                padding: 1.5rem;
                margin: 1rem 0;
                box-shadow: 0 8px 25px rgba(255, 107, 158, 0.15);
            ">
                <div style="font-size: 1.3rem; color: #ffb6d5; margin-bottom: 1rem; text-align: center;">✨ 添加美好回忆 ✨</div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: #666;">回忆标题：</label>
                    <input type="text" id="memory-title" placeholder="给这个回忆起个标题..." style="
                        width: 100%;
                        padding: 0.8rem;
                        border: 2px solid #ffb6d5;
                        border-radius: 8px;
                        font-size: 1rem;
                        outline: none;
                    " onfocus="this.style.borderColor='#ff6b9e'" onblur="this.style.borderColor='#ffb6d5'">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: #666;">回忆内容：</label>
                    <textarea id="memory-content" placeholder="写下这个美好的回忆..." style="
                        width: 100%;
                        padding: 0.8rem;
                        border: 2px solid #ffb6d5;
                        border-radius: 8px;
                        font-size: 1rem;
                        outline: none;
                        min-height: 100px;
                        resize: vertical;
                    " onfocus="this.style.borderColor='#ff6b9e'" onblur="this.style.borderColor='#ffb6d5'"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button onclick="submitMemory()" style="
                        background: linear-gradient(45deg, #ff6b9e, #ff8fab);
                        color: white;
                        border: none;
                        padding: 0.8rem 2rem;
                        border-radius: 25px;
                        cursor: pointer;
                        font-size: 1rem;
                        box-shadow: 0 4px 15px rgba(255, 107, 158, 0.3);
                    ">💾 保存回忆</button>
                    <button onclick="cancelAddMemory()" style="
                        background: #f8f9fa;
                        color: #666;
                        border: 2px solid #e9ecef;
                        border-radius: 25px;
                        cursor: pointer;
                        font-size: 1rem;
                        padding: 0.8rem 2rem;
                    ">❌ 取消</button>
                </div>
            </div>
        `;
    }
    
    // 提交回忆
    async function submitMemory() {
        const title = document.getElementById('memory-title').value.trim();
        const content = document.getElementById('memory-content').value.trim();
        
        if (!title || !content) {
            alert('请填写完整的回忆标题和内容~');
            return;
        }
        
        const resultDiv = document.getElementById('interactive-result');
        resultDiv.innerHTML = '<div style="color: #ffb6d5; font-size: 1.1rem;">✨ 正在保存回忆...</div>';
        
        try {
            if (window.cloudBaseManager) {
                const result = await window.cloudBaseManager.addMemory(title, content, 'user_created');
                if (result) {
                    resultDiv.innerHTML = `
                        <div style="
                            background: linear-gradient(135deg, #fff6fa, #ffeef8);
                            border: 2px solid #ffb6d5;
                            border-radius: 15px;
                            padding: 1.5rem;
                            margin: 1rem 0;
                            text-align: center;
                            box-shadow: 0 8px 25px rgba(255, 107, 158, 0.15);
                        ">
                            <div style="font-size: 1.3rem; color: #ffb6d5; margin-bottom: 1rem;">🎉 回忆保存成功！</div>
                            <div style="font-size: 1.1rem; color: #666; line-height: 1.6;">
                                <strong>${title}</strong><br>
                                ${content}
                            </div>
                            <div style="font-size: 0.9rem; color: #999; margin-top: 1rem;">保存时间：${new Date().toLocaleString()}</div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div style="color: #ffb6d5;">✨ 保存回忆失败，请重试~</div>';
                }
            } else {
                resultDiv.innerHTML = '<div style="color: #ffb6d5;">✨ 云开发服务未就绪，请稍后重试~</div>';
            }
        } catch (error) {
            console.error('保存回忆失败:', error);
            resultDiv.innerHTML = '<div style="color: #ffb6d5;">✨ 保存回忆失败，请重试~</div>';
        }
    }
    
    // 取消添加回忆
    function cancelAddMemory() {
        const resultDiv = document.getElementById('interactive-result');
        resultDiv.innerHTML = '<div style="color: #999; font-size: 1rem;">已取消添加回忆~</div>';
    }
    
    // 显示图片模态框
    function showImageModal(imageUrl) {
        const modal = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');
        
        if (modal && modalImage) {
            modalImage.src = imageUrl;
            modal.style.display = 'block';
            
            // 图片加载完成后调整显示
            modalImage.onload = function() {
                // 获取图片原始尺寸
                const imgWidth = this.naturalWidth;
                const imgHeight = this.naturalHeight;
                
                // 获取视窗尺寸
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                // 计算最佳显示尺寸
                const maxWidth = viewportWidth * 0.9;
                const maxHeight = viewportHeight * 0.9;
                
                // 保持宽高比
                let displayWidth = imgWidth;
                let displayHeight = imgHeight;
                
                if (displayWidth > maxWidth) {
                    displayWidth = maxWidth;
                    displayHeight = (imgHeight * maxWidth) / imgWidth;
                }
                
                if (displayHeight > maxHeight) {
                    displayHeight = maxHeight;
                    displayWidth = (imgWidth * maxHeight) / imgHeight;
                }
                
                // 设置图片显示尺寸
                this.style.width = displayWidth + 'px';
                this.style.height = displayHeight + 'px';
            };
            
            // 强制重绘后显示动画
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        }
    }
    
    // 关闭图片模态框
    function closeImageModal() {
        const modal = document.getElementById('imageModal');
        
        if (modal) {
            modal.classList.remove('show');
            
            // 等待动画完成后隐藏
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
    }
    
    // 处理图片上传
    function handleImageUpload(event) {
        const files = event.target.files;
        const maxImages = 9;
        
        if (files.length > maxImages) {
            alert(`最多只能选择${maxImages}张图片`);
            return;
        }
        
        // 存储选中的图片
        window.selectedImages = Array.from(files);
        
        // 显示预览
        showImagePreview();
        
        // 显示媒体类型选择
        document.getElementById('feed-type').value = 'image';
        toggleMediaInput();
    }
    
    // 显示图片预览
    function showImagePreview() {
        const previewDiv = document.getElementById('image-preview');
        const previewList = document.getElementById('image-preview-list');
        const imageCount = document.getElementById('image-count');
        
        if (!window.selectedImages || window.selectedImages.length === 0) {
            previewDiv.style.display = 'none';
            return;
        }
        
        // 更新图片数量
        imageCount.textContent = window.selectedImages.length;
        
        // 清空预览列表
        previewList.innerHTML = '';
        
        // 添加每张图片的预览
        window.selectedImages.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imgDiv = document.createElement('div');
                imgDiv.style.cssText = `
                    position: relative;
                    width: 80px;
                    height: 80px;
                    border-radius: 8px;
                    overflow: hidden;
                    border: 2px solid #ff6b9e;
                `;
                
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.cssText = `
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                `;
                
                const removeBtn = document.createElement('button');
                removeBtn.innerHTML = '×';
                removeBtn.style.cssText = `
                    position: absolute;
                    top: -5px;
                    right: -5px;
                    width: 20px;
                    height: 20px;
                    border-radius: 50%;
                    background: #ff6b9e;
                    color: white;
                    border: none;
                    cursor: pointer;
                    font-size: 14px;
                    line-height: 1;
                `;
                removeBtn.onclick = () => removeImage(index);
                
                imgDiv.appendChild(img);
                imgDiv.appendChild(removeBtn);
                previewList.appendChild(imgDiv);
            };
            reader.readAsDataURL(file);
        });
        
        previewDiv.style.display = 'block';
    }
    
    // 移除单张图片
    function removeImage(index) {
        window.selectedImages.splice(index, 1);
        showImagePreview();
    }
    
    // 清空所有图片
    function clearAllImages() {
        window.selectedImages = [];
        document.getElementById('image-upload').value = '';
        showImagePreview();
    }
    
    // 切换媒体输入显示
    function toggleMediaInput() {
        const mediaInput = document.getElementById('media-input');
        const feedType = document.getElementById('feed-type').value;
        
        if (feedType === 'text') {
            mediaInput.style.display = 'none';
        } else {
            mediaInput.style.display = 'block';
        }
    }
    
    // 删除恋爱动态（开发者功能）
    async function deleteLoveFeed(feedId) {
        console.log('🔄 删除函数被调用，feedId:', feedId);
        
        // 直接执行删除，简化流程
        console.log('✅ 跳过开发者验证，直接执行删除');
        await executeDelete(feedId);
    }
    
    // 执行删除操作
    async function executeDelete(feedId) {
        try {
            console.log('🔄 开始删除流程...');
            
            if (window.cloudBaseManager && window.cloudBaseManager.deleteLoveFeed) {
                console.log('✅ 云开发管理器就绪，调用删除方法');
                const result = await window.cloudBaseManager.deleteLoveFeed(feedId);
                console.log('删除结果:', result);
                
                if (result) {
                    showAlert('✅ 恋爱动态删除成功！');
                    // 不需要重新加载，删除函数已经处理了DOM更新
                    console.log('✅ 删除成功，DOM已更新');
                } else {
                    showAlert('❌ 删除失败，请重试');
                }
            } else {
                console.log('❌ 云开发管理器未就绪');
                showAlert('❌ 云开发服务未就绪');
            }
        } catch (error) {
            console.error('删除恋爱动态失败:', error);
            showAlert('❌ 删除失败，请重试');
        }
    }
    
    // 切换权限模式
    function togglePermissionMode() {
        // 显示验证方式选择
        const verificationMethods = [
            { id: 'password', label: '🔐 密码验证', icon: '🔑' },
            { id: 'face', label: '📷 人脸识别', icon: '👤' }
        ];
        
        let methodHtml = '<div style="text-align: center; margin-bottom: 1rem;">';
        methodHtml += '<h3 style="color: #ff6b9e; margin-bottom: 1rem;">选择验证方式</h3>';
        
        verificationMethods.forEach(method => {
            methodHtml += `<button onclick="selectVerificationMethod('${method.id}')" style="
                display: block;
                width: 100%;
                margin: 0.5rem 0;
                padding: 1rem;
                background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                color: white;
                border: none;
                border-radius: 12px;
                font-size: 1rem;
                cursor: pointer;
                transition: all 0.3s ease;
            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                ${method.icon} ${method.label}
            </button>`;
        });
        
        methodHtml += '</div>';
        
        // 创建自定义对话框
        showCustomDialog('🔐 权限验证', methodHtml);
    }
    
    // 选择验证方式
    function selectVerificationMethod(method) {
        closeCustomDialog();
        
        if (method === 'password') {
            // 密码验证
        showPrompt('🔐 请输入权限密码：', function(password) {
                if (password === 'zly') {
                    enableAdvancedPermission();
                } else if (password !== null) {
                    showAlert('❌ 密码错误！');
                }
            });
        } else if (method === 'face') {
            // 人脸识别验证
            startFaceVerification();
        }
    }
    
    // 开始人脸识别验证
    function startFaceVerification() {
        // 检查是否有人脸数据
        const faceData = localStorage.getItem('authorizedFaces');
        if (!faceData) {
            showAlert('❌ 未找到已授权的人脸数据！\n\n请先进行人脸注册。', function() {
                showFaceRegistrationDialog();
            });
            return;
        }
        
        // 显示人脸识别界面
        showFaceVerificationDialog();
    }
    
    // 显示人脸注册对话框
    function showFaceRegistrationDialog() {
        const dialogHtml = `
            <div style="text-align: center;">
                <h3 style="color: #ff6b9e; margin-bottom: 1rem;">📷 人脸注册</h3>
                <p style="color: #666; margin-bottom: 1.5rem;">请先注册您和女朋友的人脸，用于后续验证</p>
                
                <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1.5rem;">
                    <button onclick="registerFace('user')" style="
                        padding: 0.8rem 1.5rem;
                        background: linear-gradient(135deg, #28a745, #20c997);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 0.9rem;
                    ">👤 注册我的脸</button>
                    
                    <button onclick="registerFace('partner')" style="
                        padding: 0.8rem 1.5rem;
                        background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 0.9rem;
                    ">👩 注册女朋友的脸</button>
                </div>
                
                <button onclick="closeCustomDialog()" style="
                    padding: 0.6rem 1.2rem;
                    background: #95a5a6;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 0.8rem;
                    margin-right: 0.5rem;
                ">关闭</button>
                
                <button onclick="manageRegisteredFaces()" style="
                    padding: 0.6rem 1.2rem;
                    background: linear-gradient(135deg, #6c5ce7, #a29bfe);
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 0.8rem;
                ">👥 管理已注册人脸</button>
            </div>
        `;
        
        showCustomDialog('📷 人脸注册', dialogHtml);
    }
    
    // 注册人脸
    function registerFace(type) {
        closeCustomDialog();
        
        const typeName = type === 'user' ? '您' : '女朋友';
        showAlert(`📷 准备注册${typeName}的人脸\n\n请确保：\n• 光线充足\n• 面部清晰\n• 保持稳定`, function() {
            // 启动摄像头进行人脸注册
            startFaceRegistration(type);
        });
    }
    
    // 启动人脸注册摄像头
    function startFaceRegistration(type) {
        const typeName = type === 'user' ? '您' : '女朋友';
        
        // 在高级权限面板中显示摄像头界面
        const permissionPanel = document.getElementById('permission-panel');
        if (!permissionPanel) return;
        
        // 隐藏人脸注册管理区域
        const faceManagementArea = permissionPanel.querySelector('[onclick*="startFaceRegistration"]').closest('div').parentElement;
        faceManagementArea.style.display = 'none';
        
        // 创建摄像头注册界面
        const cameraHtml = `
            <div style="text-align: center;">
                <h4 style="color: #ff6b9e; margin-bottom: 1.5rem; font-size: 1.2rem;">📷 人脸注册 - ${typeName}</h4>
                <p style="color: #666; margin-bottom: 1.5rem;">请将脸部对准摄像头，保持稳定</p>
                
                <div style="
                    width: 320px;
                    height: 240px;
                    background: #f8f9ff;
                    border: 2px solid #ff6b9e;
                    border-radius: 12px;
                    margin: 0 auto 1.5rem;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 2rem;
                    color: #ff6b9e;
                    position: relative;
                    overflow: hidden;
                " id="camera-container">
                    <video id="registration-video" autoplay muted playsinline style="
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        display: none;
                    "></video>
                    <canvas id="registration-canvas" style="display: none;"></canvas>
                    <div id="camera-placeholder" style="
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        gap: 0.5rem;
                    ">
                        <span style="font-size: 3rem;">📷</span>
                        <span style="font-size: 0.9rem; color: #666;">摄像头未启动</span>
                    </div>
                    <div id="face-frame" style="
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 200px;
                        height: 200px;
                        border: 2px dashed #ff6b9e;
                        border-radius: 50%;
                        display: none;
                    "></div>
                </div>
                
                <div class="camera-button-group" style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1.5rem; flex-wrap: wrap;">
                    <button id="start-camera-btn" onclick="initRegistrationCamera('${type}')" style="
                        padding: 0.8rem 1.5rem;
                        background: linear-gradient(135deg, #28a745, #20c997);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 1rem;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
                        min-width: 140px;
                        width: 100%;
                        max-width: 200px;
                    " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">🎥 启动摄像头</button>
                    
                    <button id="capture-face-btn" onclick="captureFaceForRegistration('${type}')" style="
                        padding: 0.8rem 1.5rem;
                        background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 1rem;
                        display: none;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(255, 107, 158, 0.3);
                        min-width: 140px;
                        width: 100%;
                        max-width: 200px;
                    " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">📸 拍照注册</button>
                </div>
                
                <!-- 底部按钮 -->
                <div style="text-align: center; margin-top: 1.5rem;">
                    <button id="return-management-btn" onclick="returnToFaceManagement()" style="
                        padding: 0.8rem 1.5rem;
                        background: linear-gradient(135deg, #3498db, #2980b9);
                        color: white;
                        border: none;
                        border-radius: 10px;
                        cursor: pointer;
                        font-size: 1rem;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
                        min-width: 140px;
                        width: 100%;
                        max-width: 200px;
                    " onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(52, 152, 219, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(52, 152, 219, 0.3)'">
                        🔙 返回管理
                    </button>
                </div>
            </div>
        `;
        
        // 在人脸注册管理区域的位置插入摄像头界面
        faceManagementArea.insertAdjacentHTML('afterend', cameraHtml);
        
        // 显示摄像头界面
        const cameraContainer = permissionPanel.querySelector('#camera-container').parentElement;
        cameraContainer.style.display = 'block';
    }
    
    // 初始化注册摄像头
    async function initRegistrationCamera(type) {
        try {
            const video = document.getElementById('registration-video');
            const canvas = document.getElementById('registration-canvas');
            const placeholder = document.getElementById('camera-placeholder');
            const faceFrame = document.getElementById('face-frame');
            const startBtn = document.getElementById('start-camera-btn');
            const captureBtn = document.getElementById('capture-face-btn');
            
            // 请求摄像头权限
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'user',
                    width: { ideal: 640 },
                    height: { ideal: 480 }
                } 
            });
            
            // 启动视频流
            video.srcObject = stream;
            video.style.display = 'block';
            placeholder.style.display = 'none';
            faceFrame.style.display = 'block';
            startBtn.style.display = 'none';
            captureBtn.style.display = 'inline-block';
            
            // 等待视频加载
            video.onloadedmetadata = () => {
                video.play();
                console.log('摄像头已启动，可以开始拍照注册');
            };
            
        } catch (error) {
            console.error('摄像头启动失败:', error);
            showAlert('❌ 摄像头启动失败！\n\n请确保：\n• 允许浏览器访问摄像头\n• 设备有前置摄像头\n• 摄像头未被其他应用占用');
        }
    }
    
    // 拍照注册人脸
    function captureFaceForRegistration(type) {
        const video = document.getElementById('registration-video');
        const canvas = document.getElementById('registration-canvas');
        const typeName = type === 'user' ? '您' : '女朋友';
        
        // 设置画布尺寸
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        // 在画布上绘制当前视频帧
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // 获取图像数据
        const imageData = canvas.toDataURL('image/jpeg', 0.8);
        
        // 停止摄像头
        const stream = video.srcObject;
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
        }
        
        // 保存人脸数据
        const faceData = {
            type: type,
            name: typeName,
            timestamp: Date.now(),
            imageData: imageData,
            features: 'face_features_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
            owner: type === 'user' ? 'admin' : 'partner', // 添加所有者标识
            ownerName: type === 'user' ? '您' : '女朋友'
        };
        
        // 保存到云端（模拟）
        saveFaceToCloud(faceData);
        
        // 同时保存到本地存储作为备份
        const existingFaces = JSON.parse(localStorage.getItem('authorizedFaces') || '[]');
        existingFaces.push(faceData);
        localStorage.setItem('authorizedFaces', JSON.stringify(existingFaces));
        
        // 显示成功消息并返回管理界面
        showAlert(`✅ ${typeName}的人脸注册成功！\n\n现在可以使用人脸识别验证权限了。`);
        returnToFaceManagement();
        
        console.log('人脸注册完成:', faceData);
    }
    
    // 返回人脸管理界面
    function returnToFaceManagement() {
        const permissionPanel = document.getElementById('permission-panel');
        if (!permissionPanel) return;
        
        // 隐藏摄像头界面
        const cameraContainer = permissionPanel.querySelector('#camera-container');
        if (cameraContainer) {
            cameraContainer.parentElement.remove();
        }
        
        // 显示人脸注册管理区域
        const faceManagementArea = permissionPanel.querySelector('[onclick*="startFaceRegistration"]').closest('div').parentElement;
        faceManagementArea.style.display = 'block';
    }
    
    // 保存人脸到云端（模拟云端存储）
    function saveFaceToCloud(faceData) {
        try {
            // 模拟云端存储
            const cloudFaces = JSON.parse(localStorage.getItem('cloudFaces') || '[]');
            cloudFaces.push(faceData);
            localStorage.setItem('cloudFaces', JSON.stringify(cloudFaces));
            
            console.log('✅ 人脸数据已保存到云端:', faceData.ownerName);
            
            // 这里可以替换为真实的云端API调用
            // 例如：await fetch('/api/faces', { method: 'POST', body: JSON.stringify(faceData) });
            
        } catch (error) {
            console.error('❌ 云端存储失败:', error);
            showAlert('⚠️ 云端存储失败，但已保存到本地备份');
        }
    }
    
    // 从云端获取人脸数据
    function getFacesFromCloud() {
        try {
            const cloudFaces = JSON.parse(localStorage.getItem('cloudFaces') || '[]');
            return cloudFaces;
        } catch (error) {
            console.error('❌ 从云端获取人脸数据失败:', error);
            return [];
        }
    }
    
    // 显示人脸验证对话框（已废弃，使用新的腾讯云人脸识别系统）
    function showFaceVerificationDialog() {
        // 直接调用新的腾讯云人脸识别系统
        startFaceRecognition();
    }
    
    
    
    // 启用高级权限
    function enableAdvancedPermission() {
                // 生成唯一的权限会话ID
                const sessionId = Date.now().toString(36) + Math.random().toString(36).substr(2);
                const permissionInfo = {
                    sessionId: sessionId,
                    timestamp: Date.now(),
                    userAgent: navigator.userAgent,
                    ip: '127.0.0.1' // 本地IP
                };
                
                // 存储权限信息到sessionStorage（页面关闭后失效）
                sessionStorage.setItem('permissionSession', JSON.stringify(permissionInfo));
                
                // 更新权限状态
                updatePermissionUI();
                
                showAlert('✅ 高级权限已启用！\n\n⚠️ 注意：此权限仅对当前浏览器会话有效\n关闭页面后需要重新验证！');
    }
    
    // 管理已注册人脸
    function manageRegisteredFaces() {
        // 从云端获取人脸数据
        const cloudFaces = getFacesFromCloud();
        
        if (cloudFaces.length === 0) {
            showAlert('📷 云端暂无已注册的人脸数据\n\n请先进行人脸注册。');
            return;
        }
        
        // 获取当前用户权限（这里模拟，实际应该从登录状态获取）
        const currentUserRole = getCurrentUserRole(); // 'admin' 或 'partner'
        
        let faceListHtml = '<div style="text-align: center;">';
        faceListHtml += '<h3 style="color: #ff6b9e; margin-bottom: 1rem;">👥 云端人脸数据</h3>';
        
        // 根据权限过滤显示的人脸
        const visibleFaces = currentUserRole === 'admin' ? cloudFaces : cloudFaces.filter(face => face.owner === 'partner');
        
        visibleFaces.forEach((face, index) => {
            const typeIcon = face.type === 'user' ? '👤' : '👩';
            const typeName = face.ownerName;
            const registerTime = new Date(face.timestamp).toLocaleString();
            const ownerBadge = face.owner === 'admin' ? '👑 管理员' : '💕 伴侣';
            
            faceListHtml += `<div style="
                background: #f8f9ff;
                border: 1px solid #e0e6ff;
                border-radius: 12px;
                padding: 1.5rem;
                margin: 0.8rem 0;
                text-align: center;
            ">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-weight: 600; color: #ff6b9e; font-size: 1.1rem;">${typeIcon} ${typeName}</span>
                        <span style="
                            background: ${face.owner === 'admin' ? 'linear-gradient(135deg, #f39c12, #e67e22)' : 'linear-gradient(135deg, #e91e63, #ad1457)'};
                            color: white;
                            padding: 0.2rem 0.6rem;
                            border-radius: 12px;
                            font-size: 0.7rem;
                            font-weight: 600;
                        ">${ownerBadge}</span>
                    </div>
                    ${currentUserRole === 'admin' ? `
                        <button onclick="deleteFaceFromCloud('${face.features}')" style="
                            background: #e74c3c;
                            color: white;
                            border: none;
                            border-radius: 6px;
                            padding: 0.4rem 0.8rem;
                            cursor: pointer;
                            font-size: 0.8rem;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">🗑️ 删除</button>
                    ` : ''}
                </div>
                
                ${face.imageData ? `
                    <div style="
                        width: 120px;
                        height: 120px;
                        margin: 0 auto 1rem;
                        border-radius: 50%;
                        overflow: hidden;
                        border: 3px solid #ff6b9e;
                        box-shadow: 0 4px 15px rgba(255, 107, 158, 0.3);
                    ">
                        <img src="${face.imageData}" alt="${typeName}的人脸" style="
                            width: 100%;
                            height: 100%;
                            object-fit: cover;
                        ">
                    </div>
                ` : `
                    <div style="
                        width: 120px;
                        height: 120px;
                        margin: 0 auto 1rem;
                        border-radius: 50%;
                        background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 3rem;
                        color: white;
                    ">${typeIcon}</div>
                `}
                
                <div style="color: #666; font-size: 0.9rem; margin-bottom: 0.5rem;">注册时间: ${registerTime}</div>
                <div style="color: #999; font-size: 0.8rem;">特征ID: ${face.features}</div>
                <div style="color: #888; font-size: 0.8rem; margin-top: 0.5rem;">存储位置: ☁️ 云端</div>
            </div>`;
        });
        
        // 显示权限说明
        if (currentUserRole === 'partner') {
            faceListHtml += '<div style="background: rgba(255, 107, 158, 0.1); border: 1px solid rgba(255, 107, 158, 0.3); border-radius: 8px; padding: 1rem; margin: 1rem 0; color: #666; font-size: 0.9rem;">💡 您当前是伴侣权限，只能查看自己的人脸数据</div>';
        }
        
        faceListHtml += '<button onclick="closeCustomDialog()" style="padding: 0.8rem 1.5rem; background: #95a5a6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; margin-top: 1rem;">关闭</button>';
        
        faceListHtml += '</div>';
        
        showCustomDialog('👥 云端人脸管理', faceListHtml);
    }
    
    // 获取当前用户角色
    function getCurrentUserRole() {
        // 这里模拟用户角色，实际应该从登录状态获取
        // 可以根据需要修改这个逻辑
        return 'admin'; // 或者 'partner'
    }
    
    // 从云端删除人脸
    function deleteFaceFromCloud(featureId) {
        if (confirm('确定要删除这个人脸数据吗？此操作不可恢复！')) {
            try {
                // 从云端删除
                const cloudFaces = JSON.parse(localStorage.getItem('cloudFaces') || '[]');
                const updatedFaces = cloudFaces.filter(face => face.features !== featureId);
                localStorage.setItem('cloudFaces', JSON.stringify(updatedFaces));
                
                // 同时从本地备份删除
                const localFaces = JSON.parse(localStorage.getItem('authorizedFaces') || '[]');
                const updatedLocalFaces = localFaces.filter(face => face.features !== featureId);
                localStorage.setItem('authorizedFaces', JSON.stringify(updatedLocalFaces));
                
                showAlert('✅ 人脸数据已从云端删除！');
                
                // 刷新人脸管理界面
                setTimeout(() => {
                    manageRegisteredFaces();
                }, 1000);
                
            } catch (error) {
                console.error('删除人脸失败:', error);
                showAlert('❌ 删除失败，请重试！');
            }
        }
    }
    
    // 删除已注册人脸
    function deleteRegisteredFace(index) {
        if (confirm('确定要删除这个人脸数据吗？')) {
            const faceData = JSON.parse(localStorage.getItem('authorizedFaces') || '[]');
            const deletedFace = faceData.splice(index, 1)[0];
            localStorage.setItem('authorizedFaces', JSON.stringify(faceData));
            
            showAlert(`✅ 已删除${deletedFace.name}的人脸数据！`);
            
            // 刷新人脸管理界面
            setTimeout(() => {
                manageRegisteredFaces();
            }, 1000);
        }
    }
    
    // 缓存常用DOM元素
    const DOM_CACHE = {
        permissionPanel: null,
        permissionBtn: null,
        closeBtn: null,
        photoManagementButtons: null,
        photoManagementHint: null,
        deleteButtons: null,
        photoDeleteButtons: null
    };
    
    // 初始化DOM缓存
    function initDOMCache() {
        try {
            DOM_CACHE.permissionPanel = document.getElementById('permission-panel');
            DOM_CACHE.permissionBtn = document.getElementById('permission-mode-btn');
            DOM_CACHE.closeBtn = document.getElementById('close-permission-btn');
            DOM_CACHE.photoManagementButtons = document.getElementById('photo-management-buttons');
            DOM_CACHE.photoManagementHint = document.getElementById('photo-management-hint');
            DOM_CACHE.deleteButtons = document.querySelectorAll('[onclick*="deleteLoveFeed"]');
            DOM_CACHE.photoDeleteButtons = document.querySelectorAll('.photo-delete-btn');
            
            Logger.success('DOM缓存初始化完成', {
                cachedElements: Object.keys(DOM_CACHE).length
            });
        } catch (error) {
            Logger.error('DOM缓存初始化失败', error);
        }
    }
    
    // 更新权限控制UI - 优化版本
    function updatePermissionUI() {
        const hasPermission = checkPermissionSession();
        
        // 开发环境下的详细日志
        if (console.debug) {
            console.debug('🔄 更新权限控制UI', {
                hasPermission,
                permissionSession: sessionStorage.getItem('permissionSession'),
                developerSession: sessionStorage.getItem('developerSession')
            });
        }
        
        // 显示/隐藏权限控制面板
        if (DOM_CACHE.permissionPanel) {
            DOM_CACHE.permissionPanel.style.display = hasPermission ? 'block' : 'none';
        }
        
        // 批量更新按钮显示状态
        const updateButtonVisibility = (buttons, visible) => {
            buttons.forEach(button => {
                button.style.display = visible ? 'block' : 'none';
            });
        };
        
        // 更新删除按钮
        updateButtonVisibility(DOM_CACHE.deleteButtons, hasPermission);
        
        // 更新照片管理相关元素
        if (DOM_CACHE.photoManagementButtons) {
            DOM_CACHE.photoManagementButtons.style.display = hasPermission ? 'flex' : 'none';
        }
        if (DOM_CACHE.photoManagementHint) {
            DOM_CACHE.photoManagementHint.style.display = hasPermission ? 'block' : 'none';
        }
        
        // 更新照片删除按钮
        updateButtonVisibility(DOM_CACHE.photoDeleteButtons, hasPermission);
        
        // 更新权限模式按钮状态
        if (DOM_CACHE.permissionBtn) {
            DOM_CACHE.permissionBtn.innerHTML = hasPermission ? '🔐 高级权限已启用' : '🔐 启用高级权限';
            DOM_CACHE.permissionBtn.style.background = hasPermission ? 
                'linear-gradient(135deg, #28a745, #20c997)' : 
                'linear-gradient(135deg, #ff6b9e, #ff8fab)';
            DOM_CACHE.permissionBtn.disabled = hasPermission;
            DOM_CACHE.permissionBtn.style.opacity = hasPermission ? '0.6' : '1';
        }
        
        if (DOM_CACHE.closeBtn) {
            DOM_CACHE.closeBtn.style.display = hasPermission ? 'inline-block' : 'none';
        }
        
        // 更新权限状态显示
        updatePermissionStatus();
    }
    
    // 更新权限状态显示
    function updatePermissionStatus() {
        const hasPermission = checkPermissionSession();
        const permissionLevel = document.getElementById('permission-level');
        const permissionDesc = document.getElementById('permission-desc');
        
        if (permissionLevel && permissionDesc) {
            if (hasPermission) {
                permissionLevel.textContent = '高级用户';
                permissionLevel.style.color = '#28a745';
                permissionDesc.textContent = '可以添加、删除动态，管理所有功能';
            } else {
                permissionLevel.textContent = '访客';
                permissionLevel.style.color = '#ff6b9e';
                permissionDesc.textContent = '只能查看内容，无法添加或删除动态';
            }
        }
    }
    
    // 检查权限会话是否有效
    function checkPermissionSession() {
        try {
            const permissionSession = sessionStorage.getItem('permissionSession');
            if (!permissionSession) return false;
            
            const sessionInfo = JSON.parse(permissionSession);
            const currentTime = Date.now();
            const sessionAge = currentTime - sessionInfo.timestamp;
            
            // 会话有效期：8小时
            const maxSessionAge = 8 * 60 * 60 * 1000;
            
            if (sessionAge > maxSessionAge) {
                // 会话过期，清除
                sessionStorage.removeItem('permissionSession');
                console.log('⚠️ 权限会话已过期');
                return false;
            }
            
            // 验证用户代理是否一致（防止简单的会话复制）
            if (sessionInfo.userAgent !== navigator.userAgent) {
                sessionStorage.removeItem('permissionSession');
                console.log('⚠️ 用户代理不匹配，清除权限会话');
                return false;
            }
            
            console.log('✅ 权限会话有效，剩余时间:', Math.round((maxSessionAge - sessionAge) / 1000 / 60), '分钟');
            return true;
        } catch (error) {
            console.error('检查权限会话失败:', error);
            return false;
        }
    }
    
    // 关闭高级功能
    function closeAdvancedFeatures() {
        // 清除权限会话
        sessionStorage.removeItem('permissionSession');
        
        // 更新UI
        updatePermissionUI();
        
        // 显示简洁的提示信息
        showAlert('✅ 高级功能已关闭！\n\n需要重新验证才能使用高级功能。');
    }
    
    // 人脸识别登录
    function startFaceLogin() {
        console.log('🔄 开始人脸识别登录...');
        
        // 检查是否支持摄像头
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            showAlert('❌ 您的浏览器不支持摄像头功能');
            return;
        }
        
        // 显示升级版摄像头界面
        showEnhancedFaceRecognitionModal();
        
        // 启动真实摄像头
        startCamera();
    }
    
    // 显示升级版人脸识别模态框
    function showEnhancedFaceRecognitionModal() {
        // 创建模态框
        const modal = document.createElement('div');
        modal.id = 'face-recognition-modal';
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.7));
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        `;
        
        modal.innerHTML = `
            <div style="
                background: linear-gradient(135deg, #fff, #f8f9ff);
                border-radius: 25px;
                padding: 2.5rem;
                text-align: center;
                max-width: 500px;
                width: 90%;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.2);
                position: relative;
                overflow: hidden;
            ">
                <!-- 装饰性背景元素 -->
                <div style="
                    position: absolute;
                    top: -50px;
                    right: -50px;
                    width: 100px;
                    height: 100px;
                    background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                    border-radius: 50%;
                    opacity: 0.1;
                "></div>
                <div style="
                    position: absolute;
                    bottom: -30px;
                    left: -30px;
                    width: 60px;
                    height: 60px;
                    background: linear-gradient(135deg, #a55eea, #c44569);
                    border-radius: 50%;
                    opacity: 0.1;
                "></div>
                
                <!-- 标题区域 -->
                <div style="margin-bottom: 2rem;">
                    <div style="
                        display: inline-flex;
                        align-items: center;
                        background: linear-gradient(135deg, #ff6b9e, #ff8fab);
                        color: white;
                        padding: 0.8rem 1.5rem;
                        border-radius: 25px;
                        font-size: 1.3rem;
                        font-weight: 600;
                        box-shadow: 0 8px 25px rgba(255, 107, 158, 0.3);
                    ">
                        📷 人脸识别登录
                    </div>
                </div>
                
                <!-- 摄像头预览区域 -->
                <div style="
                    width: 280px;
                    height: 280px;
                    background: linear-gradient(135deg, #f8f9ff, #e8f4fd);
                    border-radius: 20px;
                    margin: 1.5rem auto;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border: 3px solid #e0e6ff;
                    position: relative;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                ">
                    <video id="camera-preview" style="
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        border-radius: 17px;
                        display: none;
                    " autoplay muted playsinline></video>
                    
                    <!-- 摄像头加载状态 -->
                    <div id="camera-loading" style="
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        color: #666;
                    ">
                        <div style="
                            width: 80px;
                            height: 80px;
                            border: 4px solid #e0e6ff;
                            border-top: 4px solid #ff6b9e;
                            border-radius: 50%;
                            animation: spin 1s linear infinite;
                            margin-bottom: 1rem;
                        "></div>
                        <div style="font-size: 1rem;">正在启动摄像头...</div>
                    </div>
                    
                    <!-- 识别状态指示器 -->
                    <div id="recognition-status" style="
                        position: absolute;
                        top: 10px;
                        right: 10px;
                        background: rgba(0, 0, 0, 0.7);
                        color: white;
                        padding: 0.5rem 1rem;
                        border-radius: 15px;
                        font-size: 0.9rem;
                        display: none;
                    ">
                        🔍 识别中
                    </div>
                </div>
                
                <!-- 进度条 -->
                <div style="
                    width: 100%;
                    height: 6px;
                    background: #e0e6ff;
                    border-radius: 3px;
                    margin: 1.5rem 0;
                    overflow: hidden;
                ">
                    <div id="recognition-progress" style="
                        width: 0%;
                        height: 100%;
                        background: linear-gradient(90deg, #ff6b9e, #a55eea);
                        border-radius: 3px;
                        transition: width 0.3s ease;
                    "></div>
                </div>
                
                <!-- 状态提示 -->
                <div id="status-message" style="
                    color: #666;
                    margin-bottom: 2rem;
                    font-size: 1rem;
                    line-height: 1.5;
                    min-height: 3rem;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">
                    请将面部对准摄像头，保持适当距离...
                </div>
                
                <!-- 操作按钮 -->
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button onclick="retryFaceRecognition()" id="retry-btn" style="
                        background: linear-gradient(135deg, #6c5ce7, #a29bfe);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        padding: 1rem 1.5rem;
                        cursor: pointer;
                        font-size: 1rem;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        display: none;
                        box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        🔄 重试
                    </button>
                    
                    <button onclick="closeFaceRecognitionModal()" style="
                        background: linear-gradient(135deg, #ff4757, #ff6b9e);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        padding: 1rem 1.5rem;
                        cursor: pointer;
                        font-size: 1rem;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        ❌ 取消
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // 添加进入动画
        const modalContent = modal.querySelector('div');
        modalContent.style.opacity = '0';
        modalContent.style.transform = 'scale(0.8)';
        
        setTimeout(() => {
            modalContent.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
            modalContent.style.opacity = '1';
            modalContent.style.transform = 'scale(1)';
        }, 100);
    }
    
    // 启动摄像头
    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    width: { ideal: 640 },
                    height: { ideal: 480 },
                    facingMode: 'user'
                } 
            });
            
            const video = document.getElementById('camera-preview');
            const loading = document.getElementById('camera-loading');
            
            if (video && loading) {
                video.srcObject = stream;
                video.style.display = 'block';
                loading.style.display = 'none';
                
                // 开始识别流程
                startRecognitionProcess();
            }
            
        } catch (error) {
            console.error('摄像头启动失败:', error);
            showCameraError();
        }
    }
    
    // 开始识别流程
    function startRecognitionProcess() {
        const statusMessage = document.getElementById('status-message');
        const recognitionStatus = document.getElementById('recognition-status');
        const progress = document.getElementById('recognition-progress');
        
        // 显示识别状态
        recognitionStatus.style.display = 'block';
        statusMessage.textContent = '正在分析面部特征...';
        
        // 模拟识别进度
        let progressValue = 0;
        const progressInterval = setInterval(() => {
            progressValue += Math.random() * 15;
            if (progressValue > 100) progressValue = 100;
            
            progress.style.width = progressValue + '%';
            
            if (progressValue >= 100) {
                clearInterval(progressInterval);
                recognitionSuccess();
            }
        }, 200);
        
        // 更新状态消息
        const messages = [
            '正在分析面部特征...',
            '检测到人脸，正在匹配...',
            '面部特征匹配中...',
            '验证身份信息...',
            '识别完成！'
        ];
        
        let messageIndex = 0;
        const messageInterval = setInterval(() => {
            if (messageIndex < messages.length - 1) {
                messageIndex++;
                statusMessage.textContent = messages[messageIndex];
            }
        }, 800);
    }
    
    // 识别成功
    function recognitionSuccess() {
        const statusMessage = document.getElementById('status-message');
        const recognitionStatus = document.getElementById('recognition-status');
        const retryBtn = document.getElementById('retry-btn');
        
        statusMessage.innerHTML = '<span style="color: #28a745; font-weight: 600;">✅ 识别成功！欢迎回来！</span>';
        recognitionStatus.innerHTML = '✅ 成功';
        recognitionStatus.style.background = 'rgba(40, 167, 69, 0.9)';
        retryBtn.style.display = 'inline-block';
        
        // 启用高级权限
        const sessionId = Date.now().toString(36) + Math.random().toString(36).substr(2);
        const permissionInfo = {
            sessionId: sessionId,
            timestamp: Date.now(),
            userAgent: navigator.userAgent,
            ip: '127.0.0.1'
        };
        
        sessionStorage.setItem('permissionSession', JSON.stringify(permissionInfo));
        
        // 延迟关闭，让用户看到成功状态
        setTimeout(() => {
            showAlert('🎉 人脸识别成功！\n\n高级权限已启用，现在可以管理所有功能了！');
            updatePermissionUI();
            closeFaceRecognitionModal();
        }, 2000);
    }
    
    // 显示摄像头错误
    function showCameraError() {
        const statusMessage = document.getElementById('status-message');
        const retryBtn = document.getElementById('retry-btn');
        
        statusMessage.innerHTML = '<span style="color: #ff4757; font-weight: 600;">❌ 摄像头启动失败，请检查权限设置</span>';
        retryBtn.style.display = 'inline-block';
    }
    
    // 重试人脸识别
    function retryFaceRecognition() {
        const statusMessage = document.getElementById('status-message');
        const recognitionStatus = document.getElementById('recognition-status');
        const progress = document.getElementById('recognition-progress');
        const retryBtn = document.getElementById('retry-btn');
        
        // 重置状态
        statusMessage.textContent = '请将面部对准摄像头，保持适当距离...';
        recognitionStatus.style.display = 'none';
        progress.style.width = '0%';
        retryBtn.style.display = 'none';
        
        // 重新开始识别
        startRecognitionProcess();
    }
    
    // 关闭人脸识别模态框
    function closeFaceRecognitionModal() {
        const modal = document.getElementById('face-recognition-modal');
        if (modal) {
            // 停止摄像头
            const video = document.getElementById('camera-preview');
            if (video && video.srcObject) {
                const tracks = video.srcObject.getTracks();
                tracks.forEach(track => track.stop());
            }
            
            // 添加关闭动画
            const modalContent = modal.querySelector('div');
            modalContent.style.transition = 'all 0.3s ease';
            modalContent.style.opacity = '0';
            modalContent.style.transform = 'scale(0.8)';
            
            setTimeout(() => {
                modal.remove();
            }, 300);
        }
    }
    
    // ===== 甜蜜相册管理功能 =====
    
    // 显示照片上传模态框
    function showPhotoUploadModal() {
        const modal = document.getElementById('photo-upload-modal');
        if (modal) {
            modal.style.display = 'block';
            
            // 重置表单
            resetPhotoUploadForm();
            
            // 添加进入动画
            const modalContent = modal.querySelector('div');
            modalContent.style.opacity = '0';
            modalContent.style.transform = 'scale(0.8)';
            
            setTimeout(() => {
                modalContent.style.transition = 'all 0.3s ease';
                modalContent.style.opacity = '1';
                modalContent.style.transform = 'scale(1)';
            }, 100);
        }
    }
    
    // 关闭照片上传模态框
    function closePhotoUploadModal() {
        const modal = document.getElementById('photo-upload-modal');
        if (modal) {
            const modalContent = modal.querySelector('div');
            modalContent.style.transition = 'all 0.3s ease';
            modalContent.style.opacity = '0';
            modalContent.style.transform = 'scale(0.8)';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
    }
    
    // 重置照片上传表单
    function resetPhotoUploadForm() {
        document.getElementById('photo-preview').style.display = 'none';
        document.getElementById('photo-info-form').style.display = 'none';
        document.getElementById('upload-btn').style.display = 'none';
        document.getElementById('photo-file-input').value = '';
        document.getElementById('photo-description').value = '';
        document.getElementById('photo-date').value = new Date().toISOString().split('T')[0];
    }
    
    // 处理照片文件选择
    function handlePhotoFileSelect(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        // 检查文件类型
        if (!file.type.startsWith('image/')) {
            showAlert('❌ 请选择图片文件！');
            return;
        }
        
        // 检查文件大小（10MB）
        if (file.size > 10 * 1024 * 1024) {
            showAlert('❌ 文件大小不能超过10MB！');
            return;
        }
        
        // 显示照片预览
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('photo-preview');
            const previewImage = document.getElementById('preview-image');
            const photoInfoForm = document.getElementById('photo-info-form');
            const uploadBtn = document.getElementById('upload-btn');
            
            previewImage.src = e.target.result;
            preview.style.display = 'block';
            photoInfoForm.style.display = 'block';
            uploadBtn.style.display = 'inline-block';
        };
        reader.readAsDataURL(file);
    }
    
    // 上传照片
    function uploadPhoto() {
        const fileInput = document.getElementById('photo-file-input');
        const description = document.getElementById('photo-description').value.trim();
        const date = document.getElementById('photo-date').value;
        
        if (!fileInput.files[0]) {
            showAlert('❌ 请先选择照片！');
            return;
        }
        
        if (!description) {
            showAlert('❌ 请填写照片描述！');
            return;
        }
        
        if (!date) {
            showAlert('❌ 请选择拍摄日期！');
            return;
        }
        
        // 模拟上传过程
        const uploadBtn = document.getElementById('upload-btn');
        const originalText = uploadBtn.innerHTML;
        uploadBtn.innerHTML = '🔄 上传中...';
        uploadBtn.disabled = true;
        
        setTimeout(() => {
            // 模拟上传成功
            const file = fileInput.files[0];
            const photoId = 'photo_' + Date.now();
            const photoData = {
                id: photoId,
                filename: file.name,
                description: description,
                date: date,
                uploadTime: new Date().toISOString()
            };
            
            // 保存到本地存储
            savePhotoToStorage(photoData);
            
            // 添加到相册
            addPhotoToAlbum(photoData);
            
            showAlert('✅ 照片上传成功！\n\n照片已添加到甜蜜相册中。');
            
            // 重置表单并关闭模态框
            resetPhotoUploadForm();
            closePhotoUploadModal();
            
            // 恢复按钮状态
            uploadBtn.innerHTML = originalText;
            uploadBtn.disabled = false;
        }, 2000);
    }
    
    // 保存照片到本地存储
    function savePhotoToStorage(photoData) {
        try {
            let photos = JSON.parse(localStorage.getItem('sweetPhotos') || '[]');
            photos.push(photoData);
            localStorage.setItem('sweetPhotos', JSON.stringify(photos));
            console.log('✅ 照片已保存到本地存储');
        } catch (error) {
            console.error('保存照片失败:', error);
        }
    }
    
    // 添加照片到相册
    function addPhotoToAlbum(photoData) {
        const photoGrid = document.getElementById('sweet-photo-grid');
        if (!photoGrid) return;
        
        // 创建新的照片元素
        const photoElement = document.createElement('div');
        photoElement.className = 'media-item clickable-image';
        photoElement.setAttribute('data-img', photoData.filename);
        photoElement.setAttribute('data-photo-id', photoData.id);
        
        photoElement.style.cssText = `
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23f0f0f0"/><text x="100" y="100" text-anchor="middle" dy=".3em" font-size="20" fill="%23666">新照片</text></svg>');
            position: relative;
            order: ${photoGrid.children.length + 1};
        `;
        
        photoElement.innerHTML = `
            <div class="img-blur-mask"></div>
            <div class="image-overlay">
                <span class="zoom-icon">🔍</span>
                <span class="zoom-text">点击放大</span>
            </div>
            <!-- 高级用户删除按钮 -->
            <button class="photo-delete-btn" onclick="deletePhoto('${photoData.id}', '${photoData.filename}')" style="
                position: absolute;
                top: 8px;
                right: 8px;
                background: rgba(255, 71, 87, 0.9);
                color: white;
                border: none;
                border-radius: 50%;
                width: 24px;
                height: 24px;
                cursor: pointer;
                font-size: 12px;
                line-height: 1;
                opacity: 0;
                transition: all 0.3s ease;
                z-index: 10;
            " onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">×</button>
        `;
        
        // 添加到相册
        photoGrid.appendChild(photoElement);
        
        // 添加进入动画
        photoElement.style.opacity = '0';
        photoElement.style.transform = 'scale(0.8)';
        
        setTimeout(() => {
            photoElement.style.transition = 'all 0.5s ease';
            photoElement.style.opacity = '1';
            photoElement.style.transform = 'scale(1)';
        }, 100);
    }
    
    // 删除照片
    function deletePhoto(photoId, filename) {
        showConfirm(`⚠️ 确认删除这张照片吗？\n\n文件名：${filename}\n\n此操作不可恢复！`, function(confirmed) {
            if (!confirmed) return;
            
            // 从DOM中移除
            const photoElement = document.querySelector(`[data-photo-id="${photoId}"]`);
            if (photoElement) {
                // 添加删除动画
                photoElement.style.transition = 'all 0.3s ease';
                photoElement.style.opacity = '0';
                photoElement.style.transform = 'scale(0.8)';
                
                setTimeout(() => {
                    if (photoElement.parentNode) {
                        photoElement.parentNode.removeChild(photoElement);
                        
                        // 从本地存储中删除
                        removePhotoFromStorage(photoId);
                        
                        showAlert('✅ 照片删除成功！');
                    }
                }, 300);
            }
        });
    }
    
    // 统一的日志系统
    const Logger = {
        info: (message, data = null) => {
            if (console.info) {
                console.info(`ℹ️ ${message}`, data);
            }
        },
        success: (message, data = null) => {
            if (console.log) {
                console.log(`✅ ${message}`, data);
            }
        },
        warning: (message, data = null) => {
            if (console.warn) {
                console.warn(`⚠️ ${message}`, data);
            }
        },
        error: (message, error = null) => {
            if (console.error) {
                console.error(`❌ ${message}`, error);
            }
        },
        debug: (message, data = null) => {
            if (console.debug) {
                console.debug(`🔍 ${message}`, data);
            }
        }
    };
    
    // 统一的错误处理函数
    function handleError(operation, error, fallback = null) {
        Logger.error(`${operation} 操作失败`, error);
        
        // 显示用户友好的错误信息
        if (typeof showAlert === 'function') {
            showAlert(`操作失败：${operation}`, 'error');
        }
        
        return fallback;
    }
    
    // 性能优化工具函数
    const PerformanceUtils = {
        // 防抖函数
        debounce: (func, wait) => {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        },
        
        // 节流函数
        throttle: (func, limit) => {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        },
        
        // 批量DOM操作
        batchDOMUpdates: (updates) => {
            // 使用 requestAnimationFrame 批量更新DOM
            requestAnimationFrame(() => {
                updates.forEach(update => update());
            });
        }
    };
    
    // 从本地存储中删除照片 - 优化版本
    function removePhotoFromStorage(photoId) {
        try {
            let photos = JSON.parse(localStorage.getItem('sweetPhotos') || '[]');
            const originalLength = photos.length;
            
            photos = photos.filter(photo => photo.id !== photoId);
            
            if (photos.length < originalLength) {
            localStorage.setItem('sweetPhotos', JSON.stringify(photos));
                Logger.success('照片已从本地存储中删除', { photoId, remainingPhotos: photos.length });
                return true;
            } else {
                Logger.warning('未找到要删除的照片', { photoId });
                return false;
            }
        } catch (error) {
            return handleError('删除照片', error, false);
        }
    }
    
    // 通用模态框动画函数
    function animateModal(modal, action = 'show') {
        if (!modal) return;
        
            const modalContent = modal.querySelector('div');
        if (!modalContent) return;
        
        if (action === 'show') {
            modal.style.display = 'block';
            modalContent.style.opacity = '0';
            modalContent.style.transform = 'scale(0.8)';
            
            setTimeout(() => {
                modalContent.style.transition = 'all 0.3s ease';
                modalContent.style.opacity = '1';
                modalContent.style.transform = 'scale(1)';
            }, 100);
        } else if (action === 'hide') {
            modalContent.style.transition = 'all 0.3s ease';
            modalContent.style.opacity = '0';
            modalContent.style.transform = 'scale(0.8)';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
    }
    
    // 显示照片管理模态框 - 应用节流优化
    const showPhotoManagementModal = PerformanceUtils.throttle(function() {
        const modal = document.getElementById('photo-management-modal');
        if (modal) {
            animateModal(modal, 'show');
            loadPhotoManagementList();
        }
    }, 500);
    
    // 关闭照片管理模态框 - 应用节流优化
    const closePhotoManagementModal = PerformanceUtils.throttle(function() {
        const modal = document.getElementById('photo-management-modal');
        if (modal) {
            animateModal(modal, 'hide');
        }
    }, 500);
    
    // 加载照片管理列表
    function loadPhotoManagementList() {
        const listContainer = document.getElementById('photo-management-list');
        if (!listContainer) return;
        
        try {
            // 获取本地存储的照片
            let photos = JSON.parse(localStorage.getItem('sweetPhotos') || '[]');
            
            // 获取页面中的照片
            const pagePhotos = Array.from(document.querySelectorAll('[data-photo-id]')).map(element => ({
                id: element.getAttribute('data-photo-id'),
                filename: element.getAttribute('data-img'),
                url: element.getAttribute('data-img'), // 添加url字段，用于显示图片
                description: '页面照片',
                date: '未知',
                uploadTime: new Date().toISOString()
            }));
            
            // 合并所有照片并去重 - 优化版本
            const allPhotos = [...pagePhotos, ...photos];
            
            // 使用Map进行高效去重，保留最新的数据
            const photoMap = new Map();
            allPhotos.forEach(photo => {
                if (!photoMap.has(photo.id) || 
                    new Date(photo.uploadTime) > new Date(photoMap.get(photo.id).uploadTime)) {
                    photoMap.set(photo.id, photo);
                }
            });
            
            const uniquePhotos = Array.from(photoMap.values());
            
            // 开发环境下的调试信息
            if (console.debug) {
                console.debug('照片去重结果:', {
                    pagePhotos: pagePhotos.length,
                    localPhotos: photos.length,
                    totalPhotos: allPhotos.length,
                    uniquePhotos: uniquePhotos.length
                });
            }
            
            if (uniquePhotos.length === 0) {
                listContainer.innerHTML = '<div style="grid-column: 1/-1; color: #666; padding: 2rem; text-align: center;">📷 暂无照片</div>';
                return;
            }
            
            // 生成照片列表 - 手机端优化
            listContainer.innerHTML = uniquePhotos.map(photo => `
                <div data-photo-id="${photo.id}" data-img="${photo.url || photo.filename}" style="
                    background: white;
                    border-radius: 12px;
                    padding: 0.8rem;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                    border: 1px solid #e0e6ff;
                    text-align: center;
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                    <div style="
                        width: 120px;
                        height: 120px;
                        background: #f8f9ff;
                        border-radius: 8px;
                        margin: 0 auto 0.8rem;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.5rem;
                        color: #666;
                        overflow: hidden;
                        border: 2px solid #e0e6ff;
                    ">
                        ${(photo.url && photo.url !== 'undefined' && photo.url !== 'null') ? 
                            `<img src="${photo.url}" alt="${photo.filename}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px;" onerror="this.style.display='none'; this.nextSibling.style.display='flex';">` : 
                            ''
                        }
                        <div style="display: ${(photo.url && photo.url !== 'undefined' && photo.url !== 'null') ? 'none' : 'flex'}; align-items: center; justify-content: center; width: 100%; height: 100%;">
                            🖼️
                        </div>
                    </div>
                    
                    <div style="font-size: 0.85rem; color: #333; margin-bottom: 0.4rem; font-weight: 600; word-break: break-word;">
                        ${photo.filename.length > 15 ? photo.filename.substring(0, 15) + '...' : photo.filename}
                    </div>
                    
                    <div style="font-size: 0.75rem; color: #666; margin-bottom: 0.4rem; word-break: break-word;">
                        ${photo.description.length > 20 ? photo.description.substring(0, 20) + '...' : photo.description}
                    </div>
                    
                    <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.8rem;">
                        ${photo.date}
                    </div>
                </div>
            `).join('');
            
        } catch (error) {
            console.error('加载照片管理列表失败:', error);
            listContainer.innerHTML = '<div style="grid-column: 1/-1; color: #ff4757; padding: 2rem; text-align: center;">❌ 加载失败，请重试</div>';
        }
            }
        
        // 图片预览和删除确认相关变量
        let currentPreviewImage = null;
        
        // 预览图片
        function previewImage(id, filename, description, date) {
            currentPreviewImage = { id, filename, description, date };
            
            // 显示预览模态框
            const previewModal = document.getElementById('image-preview-modal');
            if (previewModal) {
                previewModal.style.display = 'flex';
                
                // 设置图片源 - 尝试多种方式获取真实图片
                const previewImg = document.getElementById('preview-image');
                if (previewImg) {
                    let imageSrc = null;
                    
                    // 方法1: 尝试从页面中找到对应的图片元素
                    const pageElement = document.querySelector(`[data-photo-id="${id}"]`);
                    if (pageElement) {
                        const pageImg = pageElement.querySelector('img');
                    if (pageImg && pageImg.src) {
                            imageSrc = pageImg.src;
                    } else {
                            // 如果没有img标签，尝试获取data-img属性
                            const dataImg = pageElement.getAttribute('data-img');
                            if (dataImg) {
                                imageSrc = dataImg;
                            }
                        }
                    }
                    
                    // 方法2: 尝试从本地存储的照片中获取
                    if (!imageSrc) {
                        try {
                            const photos = JSON.parse(localStorage.getItem('sweetPhotos') || '[]');
                            const photo = photos.find(p => p.id === id);
                            if (photo && photo.url) {
                                imageSrc = photo.url;
                            }
                        } catch (error) {
                            console.error('获取本地照片失败:', error);
                        }
                    }
                    
                    // 如果找到了图片源，显示图片；否则显示占位符
                    if (imageSrc) {
                        previewImg.src = imageSrc;
                        previewImg.style.display = 'block';
                    } else {
                        // 显示占位符
                        previewImg.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y4ZjlmZiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7wn5GNPC90ZXh0Pjwvc3ZnPg==';
                        previewImg.style.display = 'block';
                    }
                }
                
                // 设置图片信息
                const previewInfo = document.getElementById('preview-info');
                if (previewInfo) {
                    previewInfo.innerHTML = `
                        <strong>文件名:</strong> ${filename}<br>
                        <strong>描述:</strong> ${description}<br>
                        <strong>日期:</strong> ${date}
                    `;
                }
            }
        }
        
        // 关闭图片预览
        function closeImagePreview() {
            const previewModal = document.getElementById('image-preview-modal');
            if (previewModal) {
                previewModal.style.display = 'none';
            }
            currentPreviewImage = null;
        }
        
        // 确认删除图片
        function confirmDeleteImage() {
            if (currentPreviewImage) {
                // 调用原来的删除函数
                deletePhoto(currentPreviewImage.id, currentPreviewImage.filename);
                // 关闭预览
                closeImagePreview();
            }
        }
        
        // 腾讯云人脸识别变量
    let cameraStream = null;
    let isCapturing = false;
    let isRecognizing = false;
    let knownPersonId = null;
    let isServiceReady = false;
    
    // 多用户管理变量
    let currentUser = null;
    let userManagementMode = false;
    
    // 页面加载时检查用户登录状态
    function checkUserLoginStatus() {
        try {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                console.log('✅ 已恢复用户登录状态:', currentUser.name);
                
                // 根据用户角色启用相应功能
                if (currentUser.role === 'admin') {
                    enableDeveloperMode();
                } else if (currentUser.role === 'partner') {
                    enablePartnerMode();
                }
            } else {
                console.log('ℹ️ 未找到用户登录状态');
            }
        } catch (error) {
            console.error('检查用户登录状态失败:', error);
            localStorage.removeItem('currentUser'); // 清除损坏的数据
        }
    }
    
    // 检查腾讯云服务状态
    function checkTencentAIService() {
        if (typeof window.tencentAIServiceEnhanced !== 'undefined') {
            isServiceReady = true;
            console.log('✅ 腾讯云AI人脸识别服务已就绪');
            
            // 获取服务状态
            const status = window.tencentAIServiceEnhanced.getServiceStatus();
            console.log('服务状态:', status);
            
            // 测试连接
            testServiceConnection();
            
            loadKnownPerson();
        } else {
            console.error('❌ 腾讯云AI人脸识别服务未加载');
            showAlert('❌ 腾讯云AI服务未加载\n\n请检查：\n• 配置文件是否正确\n• 网络连接是否正常');
        }
    }
    
    // 测试服务连接
    async function testServiceConnection() {
        try {
            const testResult = await window.tencentAIServiceEnhanced.testConnection();
            console.log('服务连接测试结果:', testResult);
            
            if (testResult.success) {
                console.log('✅ 服务连接测试成功');
            } else {
                console.warn('⚠️ 服务连接测试失败:', testResult.error);
            }
        } catch (error) {
            console.error('服务连接测试异常:', error);
        }
    }
    
    // 加载已知人员信息
    function loadKnownPerson() {
        try {
            const savedPerson = localStorage.getItem('developerPerson');
            if (savedPerson) {
                const personData = JSON.parse(savedPerson);
                knownPersonId = personData.personId;
                console.log('✅ 已加载开发者身份信息:', personData.personName);
            } else {
                console.log('ℹ️ 未找到身份信息，将进行首次注册');
            }
        } catch (error) {
            console.error('加载身份信息失败:', error);
        }
    }
    
    // 开始腾讯云人脸识别
    async function startFaceRecognition() {
        console.log('📷 开始腾讯云人脸识别...');
        
        // 检查服务状态
        if (!isServiceReady) {
            checkTencentAIService();
            if (!isServiceReady) {
                showAlert('❌ 腾讯云AI服务未就绪\n\n请检查配置后重试');
                return;
            }
        }
        
        try {
            // 请求摄像头权限
            const stream = await navigator.mediaDevices.getUserMedia({
                video: {
                    width: { ideal: 640 },
                    height: { ideal: 480 },
                    facingMode: 'user' // 前置摄像头
                }
            });
            
            cameraStream = stream;
            const video = document.getElementById('camera-video');
            video.srcObject = stream;
            
            // 显示模态框
            const modal = document.getElementById('faceRecognitionModal');
            modal.style.display = 'block';
            
            // 等待视频加载完成后显示
            video.onloadedmetadata = () => {
                setTimeout(() => {
                    modal.classList.add('show');
                    updateRecognitionStatus('摄像头已启动，请拍照进行人脸识别', 0);
                }, 100);
            };
            
        } catch (error) {
            console.error('摄像头访问失败:', error);
            showAlert('❌ 无法访问摄像头\n\n请确保：\n• 允许浏览器访问摄像头\n• 设备有前置摄像头\n• 摄像头未被其他应用占用');
        }
    }
    
    // 腾讯云人脸识别验证
    async function captureFace() {
        if (isCapturing) return;
        isCapturing = true;
        
        try {
            updateRecognitionStatus('正在拍照...', 0.3);
            
            const video = document.getElementById('camera-video');
            const canvas = document.getElementById('camera-canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            // 转换为Base64格式（去掉data:image/jpeg;base64,前缀）
            const photoData = canvas.toDataURL('image/jpeg', 0.8).split(',')[1];
            
            updateRecognitionStatus('正在分析人脸...', 0.5);
            
            if (knownPersonId) {
                // 与已知人员进行人脸比对
                try {
                    const result = await window.tencentAIServiceEnhanced.compareFace(
                        photoData, 
                        localStorage.getItem('developerPhotoData')
                    );
                    
                    if (result.Response && result.Response.Score) {
                        const score = result.Response.Score;
                        const confidence = score / 100;
                        
                        // 获取服务状态
                        const status = window.tencentAIServiceEnhanced.getServiceStatus();
                        const modeText = status.mode === 'online' ? '腾讯云API' : '本地模拟';
                        
                        updateRecognitionStatus(`识别完成，相似度: ${score}% (${modeText})`, confidence);
                        
                        if (score >= 90) { // 90%以上相似度
                            setTimeout(() => {
                                showAlert(`✅ 人脸识别成功！\n\n相似度: ${score}%\n识别方式: ${modeText}\n欢迎回来，开发者！`);
                                enableDeveloperMode();
                                closeFaceRecognition();
                            }, 1000);
                        } else {
                            updateRecognitionStatus(`识别失败，相似度: ${score}%`, confidence);
                            // 显示重试按钮
                            document.getElementById('retry-btn').style.display = 'inline-block';
                            document.getElementById('capture-btn').style.display = 'none';
                        }
                    } else {
                        throw new Error('API返回数据格式错误');
                    }
                } catch (error) {
                    console.error('人脸比对失败:', error);
                    updateRecognitionStatus('识别失败，请重试', 0);
                    // 显示重试按钮
                    document.getElementById('retry-btn').style.display = 'inline-block';
                    document.getElementById('capture-btn').style.display = 'none';
                }
            } else {
                // 首次使用，注册当前人脸
                const personName = prompt('请输入你的姓名（用于身份识别）：');
                if (personName && personName.trim()) {
                    try {
                        updateRecognitionStatus('正在注册人脸...', 0.7);
                        
                        // 保存照片数据用于后续比对
                        localStorage.setItem('developerPhotoData', photoData);
                        
                        // 创建人员（这里简化处理，实际应该调用腾讯云API）
                        const personData = {
                            personId: 'dev_' + Date.now(),
                            personName: personName.trim(),
                            createTime: new Date().toISOString()
                        };
                        
                        localStorage.setItem('developerPerson', JSON.stringify(personData));
                        knownPersonId = personData.personId;
                        
                        updateRecognitionStatus('人脸注册成功！', 1.0);
                        
                        setTimeout(() => {
                            showAlert('✅ 人脸注册成功！\n\n现在你可以使用人脸识别登录了！');
                            enableDeveloperMode();
                            closeFaceRecognition();
                        }, 1500);
                    } catch (error) {
                        console.error('人脸注册失败:', error);
                        showAlert('❌ 人脸注册失败，请重试');
                    }
                } else {
                    updateRecognitionStatus('注册已取消', 0);
                    // 显示重试按钮
                    document.getElementById('retry-btn').style.display = 'inline-block';
                    document.getElementById('capture-btn').style.display = 'none';
                }
            }
        } catch (error) {
            console.error('拍照识别失败:', error);
            showAlert('❌ 拍照识别失败，请重试');
        } finally {
            isCapturing = false;
        }
    }
    
    // 页面加载时初始化腾讯云AI服务
    window.addEventListener('load', function() {
        // 延迟检查，确保脚本加载完成
        setTimeout(() => {
            // 初始化DOM缓存
            if (typeof initDOMCache === 'function') {
                initDOMCache();
            }
            
            // 检查隐私遮罩层状态
            if (typeof checkPrivacyMaskState === 'function') {
                checkPrivacyMaskState();
            }
            
            checkTencentAIService();
            // 检查用户登录状态
            checkUserLoginStatus();
            // 更新权限UI
            if (typeof updatePermissionUI === 'function') {
                updatePermissionUI();
            }
        }, 1000);
    });
    
    // 重新识别 - 应用防抖优化
    const retryRecognition = PerformanceUtils.debounce(function() {
        document.getElementById('retry-btn').style.display = 'none';
        document.getElementById('capture-btn').style.display = 'inline-block';
        updateRecognitionStatus('请将脸部对准框内，点击拍照进行识别', 0);
    }, 300);
    
    // 更新识别状态
    function updateRecognitionStatus(text, confidence) {
        document.getElementById('status-text').textContent = text;
        
        // 处理置信度值（可能是0-1的小数或0-100的百分比）
        let confidencePercent = confidence;
        if (confidence <= 1) {
            confidencePercent = Math.round(confidence * 100);
        }
        
        document.getElementById('confidence-fill').style.width = confidencePercent + '%';
        document.getElementById('confidence-text').textContent = `识别置信度: ${confidencePercent}%`;
    }
    
    // 启用开发者模式
    function enableDeveloperMode() {
        const sessionInfo = {
            timestamp: Date.now(),
            userAgent: navigator.userAgent,
            method: 'face-recognition'
        };
        
        // 同时存储两个会话，确保兼容性
        sessionStorage.setItem('developerSession', JSON.stringify(sessionInfo));
        sessionStorage.setItem('permissionSession', JSON.stringify(sessionInfo));
        updatePermissionUI();
        
        Logger.success('通过人脸识别启用开发者模式');
    }
    
    // 关闭人脸识别
    function closeFaceRecognition() {
        const modal = document.getElementById('faceRecognitionModal');
        modal.classList.remove('show');
        
        setTimeout(() => {
            modal.style.display = 'none';
            
            // 停止摄像头
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            
            // 重置状态
            isCapturing = false;
            
            // 重置UI
            document.getElementById('retry-btn').style.display = 'none';
            document.getElementById('capture-btn').style.display = 'inline-block';
            updateRecognitionStatus('请将脸部对准框内，系统将自动识别', 0);
            
            Logger.info('人脸识别已关闭');
        }, 300);
    }
    
    // 隐私保护遮罩层控制函数
    function togglePrivacyMask() {
        const mask = document.getElementById('privacy-mask');
        if (mask) {
            if (mask.style.display === 'none' || mask.style.display === '') {
                showPrivacyMask();
            } else {
                hidePrivacyMask();
            }
        }
    }
    
    // 显示隐私保护遮罩层
    function showPrivacyMask() {
        const mask = document.getElementById('privacy-mask');
        if (mask) {
            mask.style.display = 'block';
            // 使用setTimeout确保display:block生效后再添加show类
            setTimeout(() => {
                mask.classList.add('show');
            }, 10);
            
            // 记录遮罩层状态到localStorage
            localStorage.setItem('privacyMaskEnabled', 'true');
            
            Logger.info('隐私保护遮罩层已开启');
        }
    }
    
    // 隐藏隐私保护遮罩层
    function hidePrivacyMask() {
        const mask = document.getElementById('privacy-mask');
        if (mask) {
            mask.classList.remove('show');
            setTimeout(() => {
                mask.style.display = 'none';
            }, 500);
            
            // 记录遮罩层状态到localStorage
            localStorage.setItem('privacyMaskEnabled', 'false');
            
            Logger.info('隐私保护遮罩层已关闭');
        }
    }
    
    // 检查并恢复遮罩层状态
    function checkPrivacyMaskState() {
        const isEnabled = localStorage.getItem('privacyMaskEnabled') === 'true';
        if (isEnabled) {
            showPrivacyMask();
        }
    }
    
    // 添加键盘快捷键支持
    document.addEventListener('keydown', function(event) {
        // Ctrl + Shift + P 快速切换隐私遮罩层
        if (event.ctrlKey && event.shiftKey && event.key === 'P') {
            event.preventDefault();
            togglePrivacyMask();
        }
        
        // ESC键关闭隐私遮罩层
        if (event.key === 'Escape') {
            const mask = document.getElementById('privacy-mask');
            if (mask && mask.style.display !== 'none') {
                hidePrivacyMask();
            }
        }
    });
    
    // 清除已注册的人脸（开发者功能）
    function clearRegisteredFaces() {
        showConfirm('⚠️ 确认清除已注册的人脸？\n\n清除后需要重新注册！', function(confirmed) {
            if (confirmed) {
                localStorage.removeItem('developerPerson');
                localStorage.removeItem('developerPhotoData');
                knownPersonId = null;
                showAlert('✅ 已注册人脸已清除\n\n下次使用需要重新注册');
            }
        });
    }
    
    // 注册新用户
    async function registerNewUser(photoData) {
        try {
            showPrompt('请输入新用户姓名：', function(personName) {
                if (!personName || !personName.trim()) {
                    updateRecognitionStatus('注册已取消', 0);
                    return;
                }
                
                showPrompt('请选择用户角色：\n1. 管理员 (完全权限)\n2. 伴侣 (添加内容权限)\n3. 访客 (只读权限)\n\n请输入数字 1-3：', function(role) {
                    let userRole = 'partner';
                    
                    switch (role) {
                        case '1': userRole = 'admin'; break;
                        case '2': userRole = 'partner'; break;
                        case '3': userRole = 'guest'; break;
                        default: userRole = 'partner';
                    }
                    
                    // 执行用户注册
                    executeUserRegistration(personName.trim(), userRole, photoData);
                });
            });
        } catch (error) {
            console.error('用户注册失败:', error);
            showAlert('❌ 用户注册失败，请重试');
        }
    }
    
    // 执行用户注册
    async function executeUserRegistration(personName, userRole, photoData) {
        try {
            updateRecognitionStatus('正在注册用户...', 0.7);
            
            const userInfo = {
                name: personName,
                role: userRole
            };
            
            const newUser = await window.tencentAIServiceEnhanced.registerUser(userInfo, photoData);
            
            updateRecognitionStatus('用户注册成功！', 1.0);
            
            setTimeout(() => {
                showAlert(`✅ 用户 ${newUser.name} 注册成功！\n\n角色: ${TENCENT_AI_CONFIG.userRoles[userRole].name}\n权限: ${TENCENT_AI_CONFIG.userRoles[userRole].description}`);
                closeFaceRecognition();
            }, 1500);
            
        } catch (error) {
            console.error('用户注册失败:', error);
            showAlert('❌ 用户注册失败，请重试');
        }
    }
    
    // 识别或登录用户
    async function identifyOrLoginUser(photoData) {
        try {
            // 尝试通过人脸识别登录
            const loginResult = await window.tencentAIServiceEnhanced.loginUserByFace(photoData);
            
            if (loginResult.success) {
                const user = loginResult.user;
                const score = loginResult.score;
                
                // 获取服务状态
                const status = window.tencentAIServiceEnhanced.getServiceStatus();
                const modeText = status.mode === 'online' ? '腾讯云API' : '本地模拟';
                
                updateRecognitionStatus(`识别完成，相似度: ${score}% (${modeText})`, score / 100);
                
                // 设置当前用户
                currentUser = user;
                
                // 保存用户登录状态到本地存储
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                setTimeout(() => {
                    showAlert(`✅ 人脸识别成功！\n\n欢迎回来，${user.name}！\n相似度: ${score}%\n识别方式: ${modeText}\n角色: ${TENCENT_AI_CONFIG.userRoles[user.role].name}`);
                    
                    // 根据用户角色启用相应功能
                    if (user.role === 'admin') {
                        enableDeveloperMode();
                    } else if (user.role === 'partner') {
                        enablePartnerMode();
                    }
                    
                    closeFaceRecognition();
                }, 1000);
                
            } else {
                // 未找到匹配用户
                updateRecognitionStatus('未找到匹配用户', 0);
                
                // 使用自定义确认弹窗
                showConfirm('❓ 未找到匹配的用户\n\n是否要注册新用户？\n\n选择"确定"进入用户注册模式', function(confirmed) {
                    if (confirmed) {
                        userManagementMode = true;
                        updateRecognitionStatus('已切换到用户注册模式，请重新拍照', 0);
                    } else {
                        setTimeout(() => {
                            updateRecognitionStatus('摄像头已启动，请拍照进行人脸识别', 0);
                        }, 2000);
                    }
                });
            }
        } catch (error) {
            console.error('用户识别失败:', error);
            updateRecognitionStatus('识别失败，请重试', 0);
            setTimeout(() => {
                updateRecognitionStatus('摄像头已启动，请拍照进行人脸识别', 0);
            }, 2000);
        }
    }
    
    // 启用伴侣模式
    function enablePartnerMode() {
        const sessionInfo = {
            timestamp: Date.now(),
            userAgent: navigator.userAgent,
            method: 'face-recognition',
            role: 'partner'
        };
        
        sessionStorage.setItem('partnerSession', JSON.stringify(sessionInfo));
        updatePartnerModeUI();
        
        console.log('✅ 通过人脸识别启用伴侣模式');
    }
    
    // 更新伴侣模式UI
    function updatePartnerModeUI() {
        // 显示伴侣模式标识
        const partnerIndicator = document.createElement('div');
        partnerIndicator.id = 'partner-indicator';
        partnerIndicator.innerHTML = `
            <div style="position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #ff6b9d, #c44569); 
                        color: white; padding: 10px 15px; border-radius: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
                        z-index: 1000; font-size: 14px;">
                💕 伴侣模式 - ${currentUser ? currentUser.name : '未知用户'}
            </div>
        `;
        
        // 移除旧的指示器
        const oldIndicator = document.getElementById('partner-indicator');
        if (oldIndicator) oldIndicator.remove();
        
        document.body.appendChild(partnerIndicator);
        
        // 启用相关功能按钮
        enablePartnerFeatures();
    }
    
    // 启用伴侣功能
    function enablePartnerFeatures() {
        // 启用添加恋爱动态
        const addLoveFeedBtn = document.querySelector('button[onclick="showLoveFeedForm()"]');
        if (addLoveFeedBtn) {
            addLoveFeedBtn.disabled = false;
            addLoveFeedBtn.style.opacity = '1';
        }
        
        // 启用添加甜蜜相册
        const addPhotoBtn = document.querySelector('button[onclick="addPhoto()"]');
        if (addPhotoBtn) {
            addPhotoBtn.disabled = false;
            addPhotoBtn.style.opacity = '1';
        }
        
        console.log('✅ 伴侣功能已启用');
    }
    
    // 用户管理功能
    function showUserManagement() {
        const users = window.tencentAIServiceEnhanced.getAllUsers();
        let userList = '';
        
        users.forEach(user => {
            const roleInfo = TENCENT_AI_CONFIG.userRoles[user.role];
            const lastLogin = user.lastLogin ? new Date(user.lastLogin).toLocaleString() : '从未登录';
            
            userList += `
                <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px;">
                    <h4>👤 ${user.name}</h4>
                    <p><strong>角色:</strong> ${roleInfo.name}</p>
                    <p><strong>权限:</strong> ${roleInfo.description}</p>
                    <p><strong>注册时间:</strong> ${new Date(user.createTime).toLocaleString()}</p>
                    <p><strong>最后登录:</strong> ${lastLogin}</p>
                    <button onclick="deleteUser('${user.id}')" style="background: #ff4757; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                        🗑️ 删除用户
                    </button>
                </div>
            `;
        });
        
        if (users.length === 0) {
            userList = '<p>暂无注册用户</p>';
        }
        
        showAlert(`👥 用户管理\n\n${userList}\n\n💡 提示：\n• 管理员可以删除任何用户\n• 伴侣可以添加内容但不能删除\n• 访客只能查看内容`);
    }
    
    // 删除用户
    function deleteUser(userId) {
        showConfirm('⚠️ 确认删除此用户？\n\n删除后该用户需要重新注册！', function(confirmed) {
            if (confirmed) {
                const success = window.tencentAIServiceEnhanced.deleteUser(userId);
                if (success) {
                    showAlert('✅ 用户删除成功');
                    showUserManagement(); // 刷新用户列表
                } else {
                    showAlert('❌ 用户删除失败');
                }
            }
        });
    }
    
    // 切换用户管理模式
    function toggleUserManagementMode() {
        userManagementMode = !userManagementMode;
        const modeText = userManagementMode ? '用户注册模式' : '用户识别模式';
        showAlert(`🔄 已切换到${modeText}\n\n${userManagementMode ? '📝 现在可以注册新用户' : '🔍 现在可以识别已注册用户'}`);
    }
    
    // 查看当前用户信息
    function showCurrentUserInfo() {
        // 先检查本地存储中的用户状态
        if (!currentUser) {
            try {
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                }
            } catch (error) {
                console.error('恢复用户状态失败:', error);
            }
        }
        
        if (currentUser) {
            const roleInfo = TENCENT_AI_CONFIG.userRoles[currentUser.role];
            showAlert(`👤 当前用户信息\n\n姓名: ${currentUser.name}\n角色: ${roleInfo.name}\n权限: ${roleInfo.description}\n注册时间: ${new Date(currentUser.createTime).toLocaleString()}`);
        } else {
            showAlert('❌ 当前未登录任何用户\n\n请先进行人脸识别登录');
        }
    }
    
    // 登出当前用户
    function logoutCurrentUser() {
        if (currentUser) {
            const userName = currentUser.name;
            window.tencentAIServiceEnhanced.logout();
            currentUser = null;
            
            // 移除伴侣模式指示器
            const partnerIndicator = document.getElementById('partner-indicator');
            if (partnerIndicator) partnerIndicator.remove();
            
            // 禁用伴侣功能
            disablePartnerFeatures();
            
            showAlert(`✅ 用户 ${userName} 已登出\n\n需要重新进行人脸识别登录`);
        } else {
            showAlert('❌ 当前未登录任何用户');
        }
    }
    
    // 禁用伴侣功能
    function disablePartnerFeatures() {
        // 禁用添加恋爱动态
        const addLoveFeedBtn = document.querySelector('button[onclick="showLoveFeedForm()"]');
        if (addLoveFeedBtn) {
            addLoveFeedBtn.disabled = true;
            addLoveFeedBtn.style.opacity = '0.5';
        }
        
        // 禁用添加甜蜜相册
        const addPhotoBtn = document.querySelector('button[onclick="addPhoto()"]');
        if (addPhotoBtn) {
            addPhotoBtn.disabled = true;
            addPhotoBtn.style.opacity = '0.5';
        }
        
        console.log('✅ 伴侣功能已禁用');
    }
    
    // 显示自定义对话框
    function showCustomDialog(title, content) {
        // 创建模态框背景
        const modalOverlay = document.createElement('div');
        modalOverlay.id = 'custom-dialog-overlay';
        modalOverlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: modalFadeIn 0.3s ease-out;
        `;
        
        // 创建对话框内容
        const modalContent = document.createElement('div');
        modalContent.style.cssText = `
            background: white;
            border-radius: 15px;
            padding: 24px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.25);
            position: relative;
            animation: modalFadeIn 0.3s ease-out;
        `;
        
        // 添加关闭按钮
        const closeButton = document.createElement('button');
        closeButton.innerHTML = '×';
        closeButton.style.cssText = `
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            background: #f0f0f0;
            border: none;
            color: #666;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            line-height: 1;
            font-weight: bold;
            z-index: 1000;
        `;
        closeButton.onmouseover = function() {
            this.style.background = '#e0e0e0';
            this.style.color = '#333';
        };
        closeButton.onmouseout = function() {
            this.style.background = '#f0f0f0';
            this.style.color = '#666';
        };
        closeButton.onclick = function() {
            closeCustomDialog();
        };
        
        // 添加标题
        const titleElement = document.createElement('h3');
        titleElement.textContent = title;
        titleElement.style.cssText = `
            color: #ff6b9e;
            margin: 0 0 20px 0;
            text-align: center;
            font-size: 1.2rem;
        `;
        
        // 添加内容
        const contentElement = document.createElement('div');
        contentElement.innerHTML = content;
        
        // 组装对话框
        modalContent.appendChild(closeButton);
        modalContent.appendChild(titleElement);
        modalContent.appendChild(contentElement);
        modalOverlay.appendChild(modalContent);
        
        // 添加到页面
        document.body.appendChild(modalOverlay);
        
        // 点击背景关闭
        modalOverlay.onclick = function(e) {
            if (e.target === modalOverlay) {
                closeCustomDialog();
            }
        };
        
        // 添加ESC键关闭功能
        const handleKeyDown = function(e) {
            if (e.key === 'Escape') {
                closeCustomDialog();
                document.removeEventListener('keydown', handleKeyDown);
            }
        };
        document.addEventListener('keydown', handleKeyDown);
    }
    
    // 关闭自定义对话框
    function closeCustomDialog() {
        const modalOverlay = document.getElementById('custom-dialog-overlay');
        if (modalOverlay) {
            modalOverlay.remove();
        }
    }
    </script>
    
    <!-- 图片放大模态框 -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="closeImageModal()">&times;</span>
        <div class="image-modal-content" onclick="event.stopPropagation()">
            <img id="modalImage" src="" alt="放大图片">
        </div>
    </div>
    
    <!-- 隐私保护模糊遮罩层 -->
    <div id="privacy-mask" class="privacy-mask" onclick="togglePrivacyMask()">
        <div class="privacy-mask-content">
            <div class="privacy-mask-icon">🔒</div>
            <div class="privacy-mask-text">隐私保护模式已开启</div>
            <div class="privacy-mask-hint">点击关闭遮罩层</div>
        </div>
    </div>
    
    <!-- 人脸识别模态框 -->
    <div id="faceRecognitionModal" class="face-recognition-modal" onclick="closeFaceRecognition()">
        <div class="face-recognition-content" onclick="event.stopPropagation()">
            <div class="face-recognition-header">
                <h3>📷 人脸识别验证</h3>
                <button class="face-modal-close" onclick="closeFaceRecognition()">&times;</button>
            </div>
            
            <div class="face-recognition-body">
                <div class="camera-container">
                    <video id="camera-video" autoplay muted playsinline></video>
                    <canvas id="camera-canvas" style="display: none;"></canvas>
                    <div id="camera-overlay" class="camera-overlay">
                        <div class="face-frame"></div>
                        <div class="scan-line"></div>
                    </div>
                </div>
                
                <div class="recognition-status">
                    <div id="status-text">请将脸部对准框内，系统将自动识别</div>
                    <div id="confidence-bar" class="confidence-bar">
                        <div id="confidence-fill" class="confidence-fill"></div>
                    </div>
                    <div id="confidence-text">识别置信度: 0%</div>
                </div>
                
                <div class="recognition-controls">
                    <button id="capture-btn" onclick="captureFace()" class="capture-btn">
                        📸 拍照识别
                    </button>
                    <button id="retry-btn" onclick="retryRecognition()" class="retry-btn" style="display: none;">
                        🔄 重新识别
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>